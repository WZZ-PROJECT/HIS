{"remainingRequest":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-web\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\XM\\his-shopping-web\\src\\store\\modules\\user.js","dependencies":[{"path":"E:\\XM\\his-shopping-web\\src\\store\\modules\\user.js","mtime":1606183812529},{"path":"E:\\XM\\his-shopping-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireWildcard = require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/asyncToGenerator\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _login = require(\"@/api/login\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _router = _interopRequireWildcard(require(\"@/router\"));\n\nvar user = {\n  state: {\n    user: '',\n    token: (0, _auth.getToken)(),\n    name: '',\n    avatar: '',\n    roles: [],\n    perms: []\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, name) {\n      state.name = name;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_PERMS: function SET_PERMS(state, perms) {\n      state.perms = perms;\n    }\n  },\n  actions: {\n    // 用户名登录\n    LoginByUsername: function LoginByUsername(_ref, userInfo) {\n      var commit = _ref.commit;\n      var username = userInfo.username.trim();\n      return new Promise(function (resolve, reject) {\n        (0, _login.loginByUsername)(username, userInfo.password).then(function (response) {\n          var token = response.data.data.token;\n          commit('SET_TOKEN', token);\n          (0, _auth.setToken)(token);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetUserInfo: function GetUserInfo(_ref2) {\n      var commit = _ref2.commit,\n          state = _ref2.state;\n      return new Promise(function (resolve, reject) {\n        (0, _login.getUserInfo)(state.token).then(function (response) {\n          var data = response.data.data;\n\n          if (data.perms && data.perms.length > 0) {\n            // 验证返回的perms是否是一个非空数组\n            commit('SET_PERMS', data.perms);\n          } else {\n            reject('getInfo: perms must be a non-null array !');\n          }\n\n          commit('SET_ROLES', data.roles);\n          commit('SET_NAME', data.name);\n          commit('SET_AVATAR', data.avatar);\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref3) {\n      var commit = _ref3.commit,\n          state = _ref3.state,\n          dispatch = _ref3.dispatch;\n      return new Promise(function (resolve, reject) {\n        (0, _login.logout)(state.token).then(function () {\n          commit('SET_TOKEN', '');\n          commit('SET_ROLES', []);\n          commit('SET_PERMS', []);\n          (0, _auth.removeToken)();\n          (0, _router.resetRouter)(); // reset visited views and cached views\n          // to fixed https://github.com/PanJiaChen/vue-element-admin/issues/2485\n\n          dispatch('tagsView/delAllViews', null, {\n            root: true\n          });\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 前端 登出\n    FedLogOut: function FedLogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        (0, _auth.removeToken)();\n        resolve();\n      });\n    },\n    // 动态修改权限\n    ChangeRoles: function ChangeRoles(_ref5, role) {\n      var commit = _ref5.commit,\n          dispatch = _ref5.dispatch;\n      return new Promise( /*#__PURE__*/function () {\n        var _ref6 = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee(resolve) {\n          var _yield$dispatch, roles, accessRoutes;\n\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  commit('SET_TOKEN', role);\n                  (0, _auth.setToken)(role);\n                  _context.next = 4;\n                  return dispatch('GetUserInfo');\n\n                case 4:\n                  _yield$dispatch = _context.sent;\n                  roles = _yield$dispatch.roles;\n                  (0, _router.resetRouter)();\n                  _context.next = 9;\n                  return dispatch('permission/generateRoutes', roles, {\n                    root: true\n                  });\n\n                case 9:\n                  accessRoutes = _context.sent;\n\n                  // dynamically add accessible routes\n                  _router.default.addRoutes(accessRoutes); // reset visited views and cached views\n\n\n                  dispatch('tagsView/delAllViews', null, {\n                    root: true\n                  });\n                  resolve();\n\n                case 13:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref6.apply(this, arguments);\n        };\n      }());\n    }\n  }\n};\nvar _default = user;\nexports.default = _default;",{"version":3,"sources":["E:/XM/his-shopping-web/src/store/modules/user.js"],"names":["user","state","token","name","avatar","roles","perms","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_PERMS","actions","LoginByUsername","userInfo","commit","username","trim","Promise","resolve","reject","password","then","response","data","catch","error","GetUserInfo","length","LogOut","dispatch","root","FedLogOut","ChangeRoles","role","accessRoutes","router","addRoutes"],"mappings":"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","sourcesContent":["import { loginByUsername, logout, getUserInfo } from '@/api/login'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\nimport router, { resetRouter } from '@/router'\r\n\r\nconst user = {\r\n  state: {\r\n    user: '',\r\n    token: getToken(),\r\n    name: '',\r\n    avatar: '',\r\n    roles: [],\r\n    perms: []\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, name) => {\r\n      state.name = name\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles\r\n    },\r\n    SET_PERMS: (state, perms) => {\r\n      state.perms = perms\r\n    }\r\n  },\r\n\r\n  actions: {\r\n    // 用户名登录\r\n    LoginByUsername({ commit }, userInfo) {\r\n      const username = userInfo.username.trim()\r\n      return new Promise((resolve, reject) => {\r\n        loginByUsername(username, userInfo.password).then(response => {\r\n          const token = response.data.data.token\r\n          commit('SET_TOKEN', token)\r\n          setToken(token)\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 获取用户信息\r\n    GetUserInfo({ commit, state }) {\r\n      return new Promise((resolve, reject) => {\r\n        getUserInfo(state.token).then(response => {\r\n          const data = response.data.data\r\n\r\n          if (data.perms && data.perms.length > 0) { // 验证返回的perms是否是一个非空数组\r\n            commit('SET_PERMS', data.perms)\r\n          } else {\r\n            reject('getInfo: perms must be a non-null array !')\r\n          }\r\n\r\n          commit('SET_ROLES', data.roles)\r\n          commit('SET_NAME', data.name)\r\n          commit('SET_AVATAR', data.avatar)\r\n          resolve(response)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 登出\r\n    LogOut({ commit, state, dispatch }) {\r\n      return new Promise((resolve, reject) => {\r\n        logout(state.token).then(() => {\r\n          commit('SET_TOKEN', '')\r\n          commit('SET_ROLES', [])\r\n          commit('SET_PERMS', [])\r\n          removeToken()\r\n          resetRouter()\r\n\r\n          // reset visited views and cached views\r\n          // to fixed https://github.com/PanJiaChen/vue-element-admin/issues/2485\r\n          dispatch('tagsView/delAllViews', null, { root: true })\r\n\r\n          resolve()\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 前端 登出\r\n    FedLogOut({ commit }) {\r\n      return new Promise(resolve => {\r\n        commit('SET_TOKEN', '')\r\n        commit('SET_ROLES', [])\r\n        removeToken()\r\n        resolve()\r\n      })\r\n    },\r\n\r\n    // 动态修改权限\r\n    ChangeRoles({ commit, dispatch }, role) {\r\n      return new Promise(async resolve => {\r\n        commit('SET_TOKEN', role)\r\n        setToken(role)\r\n\r\n        const { roles } = await dispatch('GetUserInfo')\r\n\r\n        resetRouter()\r\n\r\n        const accessRoutes = await dispatch('permission/generateRoutes', roles, { root: true })\r\n\r\n        // dynamically add accessible routes\r\n        router.addRoutes(accessRoutes)\r\n\r\n        // reset visited views and cached views\r\n        dispatch('tagsView/delAllViews', null, { root: true })\r\n\r\n        resolve()\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default user\r\n"]}]}