{"remainingRequest":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\XM\\his-shopping-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-web\\src\\views\\goods\\create.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\XM\\his-shopping-web\\src\\views\\goods\\create.vue","mtime":1606183812543},{"path":"E:\\XM\\his-shopping-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.to-string\");\n\nvar _goods = require(\"@/api/goods\");\n\nvar _storage = require(\"@/api/storage\");\n\nvar _tinymceVue = _interopRequireDefault(require(\"@tinymce/tinymce-vue\"));\n\nvar _elementUi = require(\"element-ui\");\n\nvar _auth = require(\"@/utils/auth\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'GoodsCreate',\n  components: {\n    Editor: _tinymceVue.default\n  },\n  data: function data() {\n    return {\n      uploadPath: _storage.uploadPath,\n      newKeywordVisible: false,\n      newKeyword: '',\n      keywords: [],\n      categoryList: [],\n      brandList: [],\n      goods: {\n        picUrl: '',\n        gallery: [],\n        isHot: false,\n        isNew: true,\n        isOnSale: true\n      },\n      specVisiable: false,\n      specForm: {\n        specification: '',\n        value: '',\n        picUrl: ''\n      },\n      multipleSpec: false,\n      specifications: [{\n        specification: '规格',\n        value: '标准',\n        picUrl: ''\n      }],\n      productVisiable: false,\n      productForm: {\n        id: 0,\n        specifications: [],\n        price: 0.00,\n        number: 0,\n        url: ''\n      },\n      products: [{\n        id: 0,\n        specifications: ['标准'],\n        price: 0.00,\n        number: 0,\n        url: ''\n      }],\n      attributeVisiable: false,\n      attributeForm: {\n        attribute: '',\n        value: ''\n      },\n      attributes: [],\n      rules: {\n        goodsSn: [{\n          required: true,\n          message: '商品编号不能为空',\n          trigger: 'blur'\n        }],\n        name: [{\n          required: true,\n          message: '商品名称不能为空',\n          trigger: 'blur'\n        }]\n      },\n      editorInit: {\n        language: 'zh_CN',\n        height: 500,\n        convert_urls: false,\n        plugins: ['advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools importcss insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount'],\n        toolbar: ['searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample', 'hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen'],\n        images_upload_handler: function images_upload_handler(blobInfo, success, failure) {\n          var formData = new FormData();\n          formData.append('file', blobInfo.blob());\n          (0, _storage.createStorage)(formData).then(function (res) {\n            success(res.data.data.url);\n          }).catch(function () {\n            failure('上传失败，请重新上传');\n          });\n        }\n      }\n    };\n  },\n  computed: {\n    headers: function headers() {\n      return {\n        'X-Litemall-Admin-Token': (0, _auth.getToken)()\n      };\n    }\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      (0, _goods.listCatAndBrand)().then(function (response) {\n        _this.categoryList = response.data.data.categoryList;\n        _this.brandList = response.data.data.brandList;\n      });\n    },\n    handleCategoryChange: function handleCategoryChange(value) {\n      this.goods.categoryId = value[value.length - 1];\n    },\n    handleCancel: function handleCancel() {\n      this.$store.dispatch('tagsView/delView', this.$route);\n      this.$router.push({\n        path: '/goods/list'\n      });\n    },\n    handlePublish: function handlePublish() {\n      var _this2 = this;\n\n      var finalGoods = {\n        goods: this.goods,\n        specifications: this.specifications,\n        products: this.products,\n        attributes: this.attributes\n      };\n      (0, _goods.publishGoods)(finalGoods).then(function (response) {\n        _this2.$notify.success({\n          title: '成功',\n          message: '创建成功'\n        });\n\n        _this2.$store.dispatch('tagsView/delView', _this2.$route);\n\n        _this2.$router.push({\n          path: '/goods/list'\n        });\n      }).catch(function (response) {\n        _elementUi.MessageBox.alert('业务错误：' + response.data.errmsg, '警告', {\n          confirmButtonText: '确定',\n          type: 'error'\n        });\n      });\n    },\n    handleClose: function handleClose(tag) {\n      this.keywords.splice(this.keywords.indexOf(tag), 1);\n      this.goods.keywords = this.keywords.toString();\n    },\n    showInput: function showInput() {\n      var _this3 = this;\n\n      this.newKeywordVisible = true;\n      this.$nextTick(function (_) {\n        _this3.$refs.newKeywordInput.$refs.input.focus();\n      });\n    },\n    handleInputConfirm: function handleInputConfirm() {\n      var newKeyword = this.newKeyword;\n\n      if (newKeyword) {\n        this.keywords.push(newKeyword);\n        this.goods.keywords = this.keywords.toString();\n      }\n\n      this.newKeywordVisible = false;\n      this.newKeyword = '';\n    },\n    uploadPicUrl: function uploadPicUrl(response) {\n      this.goods.picUrl = response.data.url;\n    },\n    uploadOverrun: function uploadOverrun() {\n      this.$message({\n        type: 'error',\n        message: '上传文件个数超出限制!最多上传5张图片!'\n      });\n    },\n    handleGalleryUrl: function handleGalleryUrl(response, file, fileList) {\n      if (response.errno === 0) {\n        this.goods.gallery.push(response.data.url);\n      }\n    },\n    handleRemove: function handleRemove(file, fileList) {\n      for (var i = 0; i < this.goods.gallery.length; i++) {\n        // 这里存在两种情况\n        // 1. 如果所删除图片是刚刚上传的图片，那么图片地址是file.response.data.url\n        //    此时的file.url虽然存在，但是是本机地址，而不是远程地址。\n        // 2. 如果所删除图片是后台返回的已有图片，那么图片地址是file.url\n        var url;\n\n        if (file.response === undefined) {\n          url = file.url;\n        } else {\n          url = file.response.data.url;\n        }\n\n        if (this.goods.gallery[i] === url) {\n          this.goods.gallery.splice(i, 1);\n        }\n      }\n    },\n    specChanged: function specChanged(label) {\n      if (label === false) {\n        this.specifications = [{\n          specification: '规格',\n          value: '标准',\n          picUrl: ''\n        }];\n        this.products = [{\n          id: 0,\n          specifications: ['标准'],\n          price: 0.00,\n          number: 0,\n          url: ''\n        }];\n      } else {\n        this.specifications = [];\n        this.products = [];\n      }\n    },\n    uploadSpecPicUrl: function uploadSpecPicUrl(response) {\n      this.specForm.picUrl = response.data.url;\n    },\n    handleSpecificationShow: function handleSpecificationShow() {\n      this.specForm = {\n        specification: '',\n        value: '',\n        picUrl: ''\n      };\n      this.specVisiable = true;\n    },\n    handleSpecificationAdd: function handleSpecificationAdd() {\n      var index = this.specifications.length - 1;\n\n      for (var i = 0; i < this.specifications.length; i++) {\n        var v = this.specifications[i];\n\n        if (v.specification === this.specForm.specification) {\n          if (v.value === this.specForm.value) {\n            this.$message({\n              type: 'warning',\n              message: '已经存在规格值:' + v.value\n            });\n            this.specForm = {};\n            this.specVisiable = false;\n            return;\n          } else {\n            index = i;\n          }\n        }\n      }\n\n      this.specifications.splice(index + 1, 0, this.specForm);\n      this.specVisiable = false;\n      this.specToProduct();\n    },\n    handleSpecificationDelete: function handleSpecificationDelete(row) {\n      var index = this.specifications.indexOf(row);\n      this.specifications.splice(index, 1);\n      this.specToProduct();\n    },\n    specToProduct: function specToProduct() {\n      if (this.specifications.length === 0) {\n        return;\n      } // 根据specifications创建临时规格列表\n\n\n      var specValues = [];\n      var spec = this.specifications[0].specification;\n      var values = [];\n      values.push(0);\n\n      for (var i = 1; i < this.specifications.length; i++) {\n        var aspec = this.specifications[i].specification;\n\n        if (aspec === spec) {\n          values.push(i);\n        } else {\n          specValues.push(values);\n          spec = aspec;\n          values = [];\n          values.push(i);\n        }\n      }\n\n      specValues.push(values); // 根据临时规格列表生产货品规格\n      // 算法基于 https://blog.csdn.net/tyhj_sf/article/details/53893125\n\n      var productsIndex = 0;\n      var products = [];\n      var combination = [];\n      var n = specValues.length;\n\n      for (var s = 0; s < n; s++) {\n        combination[s] = 0;\n      }\n\n      var index = 0;\n      var isContinue = false;\n\n      do {\n        var specifications = [];\n\n        for (var x = 0; x < n; x++) {\n          var z = specValues[x][combination[x]];\n          specifications.push(this.specifications[z].value);\n        }\n\n        products[productsIndex] = {\n          id: productsIndex,\n          specifications: specifications,\n          price: 0.00,\n          number: 0,\n          url: ''\n        };\n        productsIndex++;\n        index++;\n        combination[n - 1] = index;\n\n        for (var j = n - 1; j >= 0; j--) {\n          if (combination[j] >= specValues[j].length) {\n            combination[j] = 0;\n            index = 0;\n\n            if (j - 1 >= 0) {\n              combination[j - 1] = combination[j - 1] + 1;\n            }\n          }\n        }\n\n        isContinue = false;\n\n        for (var p = 0; p < n; p++) {\n          if (combination[p] !== 0) {\n            isContinue = true;\n          }\n        }\n      } while (isContinue);\n\n      this.products = products;\n    },\n    handleProductShow: function handleProductShow(row) {\n      this.productForm = Object.assign({}, row);\n      this.productVisiable = true;\n    },\n    uploadProductUrl: function uploadProductUrl(response) {\n      this.productForm.url = response.data.url;\n    },\n    handleProductEdit: function handleProductEdit() {\n      for (var i = 0; i < this.products.length; i++) {\n        var v = this.products[i];\n\n        if (v.id === this.productForm.id) {\n          this.products.splice(i, 1, this.productForm);\n          break;\n        }\n      }\n\n      this.productVisiable = false;\n    },\n    handleAttributeShow: function handleAttributeShow() {\n      this.attributeForm = {};\n      this.attributeVisiable = true;\n    },\n    handleAttributeAdd: function handleAttributeAdd() {\n      this.attributes.unshift(this.attributeForm);\n      this.attributeVisiable = false;\n    },\n    handleAttributeDelete: function handleAttributeDelete(row) {\n      var index = this.attributes.indexOf(row);\n      this.attributes.splice(index, 1);\n    }\n  }\n};\nexports.default = _default;",{"version":3,"sources":["create.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n\r\n    <el-card class=\"box-card\">\r\n      <h3>商品介绍</h3>\r\n      <el-form ref=\"goods\" :rules=\"rules\" :model=\"goods\" label-width=\"150px\">\r\n        <el-form-item label=\"商品编号\" prop=\"goodsSn\">\r\n          <el-input v-model=\"goods.goodsSn\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"商品名称\" prop=\"name\">\r\n          <el-input v-model=\"goods.name\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"市场售价\" prop=\"counterPrice\">\r\n          <el-input v-model=\"goods.counterPrice\" placeholder=\"0.00\">\r\n            <template slot=\"append\">元</template>\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"是否新品\" prop=\"isNew\">\r\n          <el-radio-group v-model=\"goods.isNew\">\r\n            <el-radio :label=\"true\">新品</el-radio>\r\n            <el-radio :label=\"false\">非新品</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"是否热卖\" prop=\"isHot\">\r\n          <el-radio-group v-model=\"goods.isHot\">\r\n            <el-radio :label=\"false\">普通</el-radio>\r\n            <el-radio :label=\"true\">热卖</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"是否在售\" prop=\"isOnSale\">\r\n          <el-radio-group v-model=\"goods.isOnSale\">\r\n            <el-radio :label=\"true\">在售</el-radio>\r\n            <el-radio :label=\"false\">未售</el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"商品图片\">\r\n          <el-upload\r\n            :action=\"uploadPath\"\r\n            :show-file-list=\"false\"\r\n            :headers=\"headers\"\r\n            :on-success=\"uploadPicUrl\"\r\n            class=\"avatar-uploader\"\r\n            accept=\".jpg,.jpeg,.png,.gif\"\r\n          >\r\n            <img v-if=\"goods.picUrl\" :src=\"goods.picUrl\" class=\"avatar\">\r\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\" />\r\n          </el-upload>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"宣传画廊\">\r\n          <el-upload\r\n            :action=\"uploadPath\"\r\n            :limit=\"5\"\r\n            :headers=\"headers\"\r\n            :on-exceed=\"uploadOverrun\"\r\n            :on-success=\"handleGalleryUrl\"\r\n            :on-remove=\"handleRemove\"\r\n            multiple\r\n            accept=\".jpg,.jpeg,.png,.gif\"\r\n            list-type=\"picture-card\"\r\n          >\r\n            <i class=\"el-icon-plus\" />\r\n          </el-upload>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"商品单位\">\r\n          <el-input v-model=\"goods.unit\" placeholder=\"件 / 个 / 盒\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"关键字\">\r\n          <el-tag v-for=\"tag in keywords\" :key=\"tag\" closable type=\"primary\" @close=\"handleClose(tag)\">\r\n            {{ tag }}\r\n          </el-tag>\r\n          <el-input\r\n            v-if=\"newKeywordVisible\"\r\n            ref=\"newKeywordInput\"\r\n            v-model=\"newKeyword\"\r\n            class=\"input-new-keyword\"\r\n\r\n            @keyup.enter.native=\"handleInputConfirm\"\r\n            @blur=\"handleInputConfirm\"\r\n          />\r\n          <el-button v-else class=\"button-new-keyword\" type=\"primary\" @click=\"showInput\">+ 增加</el-button>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"所属分类\">\r\n          <el-cascader :options=\"categoryList\" expand-trigger=\"hover\" clearable @change=\"handleCategoryChange\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"所属品牌商\">\r\n          <el-select v-model=\"goods.brandId\" clearable>\r\n            <el-option v-for=\"item in brandList\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"商品简介\">\r\n          <el-input v-model=\"goods.brief\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"商品详细介绍\">\r\n          <editor v-model=\"goods.detail\" :init=\"editorInit\" />\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n\r\n    <el-card class=\"box-card\">\r\n      <h3>商品规格</h3>\r\n      <el-row :gutter=\"20\" type=\"flex\" align=\"middle\" style=\"padding:20px 0;\">\r\n        <el-col :span=\"10\">\r\n          <el-radio-group v-model=\"multipleSpec\" @change=\"specChanged\">\r\n            <el-radio-button :label=\"false\">默认标准规格</el-radio-button>\r\n            <el-radio-button :label=\"true\">多规格支持</el-radio-button>\r\n          </el-radio-group>\r\n        </el-col>\r\n        <el-col v-if=\"multipleSpec\" :span=\"10\">\r\n          <el-button :plain=\"true\" type=\"primary\" @click=\"handleSpecificationShow\">添加</el-button>\r\n        </el-col>\r\n      </el-row>\r\n\r\n      <el-table :data=\"specifications\">\r\n        <el-table-column property=\"specification\" label=\"规格名\" />\r\n        <el-table-column property=\"value\" label=\"规格值\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag type=\"primary\">\r\n              {{ scope.row.value }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column property=\"picUrl\" label=\"规格图片\">\r\n          <template slot-scope=\"scope\">\r\n            <img v-if=\"scope.row.picUrl\" :src=\"scope.row.picUrl\" width=\"40\">\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          v-if=\"multipleSpec\"\r\n          align=\"center\"\r\n          label=\"操作\"\r\n          width=\"250\"\r\n          class-name=\"small-padding fixed-width\"\r\n        >\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"handleSpecificationDelete(scope.row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <el-dialog :visible.sync=\"specVisiable\" title=\"设置规格\">\r\n        <el-form\r\n          ref=\"specForm\"\r\n          :rules=\"rules\"\r\n          :model=\"specForm\"\r\n          status-icon\r\n          label-position=\"left\"\r\n          label-width=\"100px\"\r\n          style=\"width: 400px; margin-left:50px;\"\r\n        >\r\n          <el-form-item label=\"规格名\" prop=\"specification\">\r\n            <el-input v-model=\"specForm.specification\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"规格值\" prop=\"value\">\r\n            <el-input v-model=\"specForm.value\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"规格图片\" prop=\"picUrl\">\r\n            <el-upload\r\n              :action=\"uploadPath\"\r\n              :show-file-list=\"false\"\r\n              :headers=\"headers\"\r\n              :on-success=\"uploadSpecPicUrl\"\r\n              class=\"avatar-uploader\"\r\n              accept=\".jpg,.jpeg,.png,.gif\"\r\n            >\r\n              <img v-if=\"specForm.picUrl\" :src=\"specForm.picUrl\" class=\"avatar\">\r\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\" />\r\n            </el-upload>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"specVisiable = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handleSpecificationAdd\">确定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </el-card>\r\n\r\n    <el-card class=\"box-card\">\r\n      <h3>商品库存</h3>\r\n      <el-table :data=\"products\">\r\n        <el-table-column property=\"value\" label=\"货品规格\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag v-for=\"tag in scope.row.specifications\" :key=\"tag\">\r\n              {{ tag }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column property=\"price\" width=\"100\" label=\"货品售价\" />\r\n        <el-table-column property=\"number\" width=\"100\" label=\"货品数量\" />\r\n        <el-table-column property=\"url\" width=\"100\" label=\"货品图片\">\r\n          <template slot-scope=\"scope\">\r\n            <img v-if=\"scope.row.url\" :src=\"scope.row.url\" width=\"40\">\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column align=\"center\" label=\"操作\" width=\"100\" class-name=\"small-padding fixed-width\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"primary\" size=\"mini\" @click=\"handleProductShow(scope.row)\">设置</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <el-dialog :visible.sync=\"productVisiable\" title=\"添加货品\">\r\n        <el-form\r\n          ref=\"productForm\"\r\n          :model=\"productForm\"\r\n          status-icon\r\n          label-position=\"left\"\r\n          label-width=\"100px\"\r\n          style=\"width: 400px; margin-left:50px;\"\r\n        >\r\n          <el-form-item label=\"货品规格列\" prop=\"specifications\">\r\n            <el-tag v-for=\"tag in productForm.specifications\" :key=\"tag\">\r\n              {{ tag }}\r\n            </el-tag>\r\n          </el-form-item>\r\n          <el-form-item label=\"货品售价\" prop=\"price\">\r\n            <el-input v-model=\"productForm.price\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"货品数量\" prop=\"number\">\r\n            <el-input v-model=\"productForm.number\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"货品图片\" prop=\"url\">\r\n            <el-upload\r\n              :action=\"uploadPath\"\r\n              :show-file-list=\"false\"\r\n              :headers=\"headers\"\r\n              :on-success=\"uploadProductUrl\"\r\n              class=\"avatar-uploader\"\r\n              accept=\".jpg,.jpeg,.png,.gif\"\r\n            >\r\n              <img v-if=\"productForm.url\" :src=\"productForm.url\" class=\"avatar\">\r\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\" />\r\n            </el-upload>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"productVisiable = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handleProductEdit\">确定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </el-card>\r\n\r\n    <el-card class=\"box-card\">\r\n      <h3>商品参数</h3>\r\n      <el-button type=\"primary\" @click=\"handleAttributeShow\">添加</el-button>\r\n      <el-table :data=\"attributes\">\r\n        <el-table-column property=\"attribute\" label=\"商品参数名称\" />\r\n        <el-table-column property=\"value\" label=\"商品参数值\" />\r\n        <el-table-column align=\"center\" label=\"操作\" width=\"100\" class-name=\"small-padding fixed-width\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"handleAttributeDelete(scope.row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <el-dialog :visible.sync=\"attributeVisiable\" title=\"添加商品参数\">\r\n        <el-form\r\n          ref=\"attributeForm\"\r\n          :model=\"attributeForm\"\r\n          status-icon\r\n          label-position=\"left\"\r\n          label-width=\"100px\"\r\n          style=\"width: 400px; margin-left:50px;\"\r\n        >\r\n          <el-form-item label=\"商品参数名称\" prop=\"attribute\">\r\n            <el-input v-model=\"attributeForm.attribute\" />\r\n          </el-form-item>\r\n          <el-form-item label=\"商品参数值\" prop=\"value\">\r\n            <el-input v-model=\"attributeForm.value\" />\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button @click=\"attributeVisiable = false\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handleAttributeAdd\">确定</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </el-card>\r\n\r\n    <div class=\"op-container\">\r\n      <el-button @click=\"handleCancel\">取消</el-button>\r\n      <el-button type=\"primary\" @click=\"handlePublish\">上架</el-button>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<style>\r\n  .el-card {\r\n    margin-bottom: 10px;\r\n  }\r\n\r\n  .el-tag + .el-tag {\r\n    margin-left: 10px;\r\n  }\r\n\r\n  .input-new-keyword {\r\n    width: 90px;\r\n    margin-left: 10px;\r\n    vertical-align: bottom;\r\n  }\r\n\r\n  .avatar-uploader .el-upload {\r\n    width: 145px;\r\n    height: 145px;\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .avatar-uploader .el-upload:hover {\r\n    border-color: #20a0ff;\r\n  }\r\n\r\n  .avatar-uploader-icon {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 120px;\r\n    height: 120px;\r\n    line-height: 120px;\r\n    text-align: center;\r\n  }\r\n\r\n  .avatar {\r\n    width: 145px;\r\n    height: 145px;\r\n    display: block;\r\n  }\r\n</style>\r\n\r\n<script>\r\nimport { publishGoods, listCatAndBrand } from '@/api/goods'\r\nimport { createStorage, uploadPath } from '@/api/storage'\r\nimport Editor from '@tinymce/tinymce-vue'\r\nimport { MessageBox } from 'element-ui'\r\nimport { getToken } from '@/utils/auth'\r\n\r\nexport default {\r\n  name: 'GoodsCreate',\r\n  components: { Editor },\r\n\r\n  data() {\r\n    return {\r\n      uploadPath,\r\n      newKeywordVisible: false,\r\n      newKeyword: '',\r\n      keywords: [],\r\n      categoryList: [],\r\n      brandList: [],\r\n      goods: { picUrl: '', gallery: [], isHot: false, isNew: true, isOnSale: true },\r\n      specVisiable: false,\r\n      specForm: { specification: '', value: '', picUrl: '' },\r\n      multipleSpec: false,\r\n      specifications: [{ specification: '规格', value: '标准', picUrl: '' }],\r\n      productVisiable: false,\r\n      productForm: { id: 0, specifications: [], price: 0.00, number: 0, url: '' },\r\n      products: [{ id: 0, specifications: ['标准'], price: 0.00, number: 0, url: '' }],\r\n      attributeVisiable: false,\r\n      attributeForm: { attribute: '', value: '' },\r\n      attributes: [],\r\n      rules: {\r\n        goodsSn: [{ required: true, message: '商品编号不能为空', trigger: 'blur' }],\r\n        name: [{ required: true, message: '商品名称不能为空', trigger: 'blur' }]\r\n      },\r\n      editorInit: {\r\n        language: 'zh_CN',\r\n        height: 500,\r\n        convert_urls: false,\r\n        plugins: ['advlist anchor autolink autosave code codesample colorpicker colorpicker contextmenu directionality emoticons fullscreen hr image imagetools importcss insertdatetime link lists media nonbreaking noneditable pagebreak paste preview print save searchreplace spellchecker tabfocus table template textcolor textpattern visualblocks visualchars wordcount'],\r\n        toolbar: ['searchreplace bold italic underline strikethrough alignleft aligncenter alignright outdent indent  blockquote undo redo removeformat subscript superscript code codesample', 'hr bullist numlist link image charmap preview anchor pagebreak insertdatetime media table emoticons forecolor backcolor fullscreen'],\r\n        images_upload_handler: function(blobInfo, success, failure) {\r\n          const formData = new FormData()\r\n          formData.append('file', blobInfo.blob())\r\n          createStorage(formData).then(res => {\r\n            success(res.data.data.url)\r\n          }).catch(() => {\r\n            failure('上传失败，请重新上传')\r\n          })\r\n        }\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    headers() {\r\n      return {\r\n        'X-Litemall-Admin-Token': getToken()\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.init()\r\n  },\r\n\r\n  methods: {\r\n    init: function() {\r\n      listCatAndBrand().then(response => {\r\n        this.categoryList = response.data.data.categoryList\r\n        this.brandList = response.data.data.brandList\r\n      })\r\n    },\r\n    handleCategoryChange(value) {\r\n      this.goods.categoryId = value[value.length - 1]\r\n    },\r\n    handleCancel: function() {\r\n      this.$store.dispatch('tagsView/delView', this.$route)\r\n      this.$router.push({ path: '/goods/list' })\r\n    },\r\n    handlePublish: function() {\r\n      const finalGoods = {\r\n        goods: this.goods,\r\n        specifications: this.specifications,\r\n        products: this.products,\r\n        attributes: this.attributes\r\n      }\r\n      publishGoods(finalGoods).then(response => {\r\n        this.$notify.success({\r\n          title: '成功',\r\n          message: '创建成功'\r\n        })\r\n        this.$store.dispatch('tagsView/delView', this.$route)\r\n        this.$router.push({ path: '/goods/list' })\r\n      }).catch(response => {\r\n        MessageBox.alert('业务错误：' + response.data.errmsg, '警告', {\r\n          confirmButtonText: '确定',\r\n          type: 'error'\r\n        })\r\n      })\r\n    },\r\n    handleClose(tag) {\r\n      this.keywords.splice(this.keywords.indexOf(tag), 1)\r\n      this.goods.keywords = this.keywords.toString()\r\n    },\r\n    showInput() {\r\n      this.newKeywordVisible = true\r\n      this.$nextTick(_ => {\r\n        this.$refs.newKeywordInput.$refs.input.focus()\r\n      })\r\n    },\r\n    handleInputConfirm() {\r\n      const newKeyword = this.newKeyword\r\n      if (newKeyword) {\r\n        this.keywords.push(newKeyword)\r\n        this.goods.keywords = this.keywords.toString()\r\n      }\r\n      this.newKeywordVisible = false\r\n      this.newKeyword = ''\r\n    },\r\n    uploadPicUrl: function(response) {\r\n      this.goods.picUrl = response.data.url\r\n    },\r\n    uploadOverrun: function() {\r\n      this.$message({\r\n        type: 'error',\r\n        message: '上传文件个数超出限制!最多上传5张图片!'\r\n      })\r\n    },\r\n    handleGalleryUrl(response, file, fileList) {\r\n      if (response.errno === 0) {\r\n        this.goods.gallery.push(response.data.url)\r\n      }\r\n    },\r\n    handleRemove: function(file, fileList) {\r\n      for (var i = 0; i < this.goods.gallery.length; i++) {\r\n        // 这里存在两种情况\r\n        // 1. 如果所删除图片是刚刚上传的图片，那么图片地址是file.response.data.url\r\n        //    此时的file.url虽然存在，但是是本机地址，而不是远程地址。\r\n        // 2. 如果所删除图片是后台返回的已有图片，那么图片地址是file.url\r\n        var url\r\n        if (file.response === undefined) {\r\n          url = file.url\r\n        } else {\r\n          url = file.response.data.url\r\n        }\r\n\r\n        if (this.goods.gallery[i] === url) {\r\n          this.goods.gallery.splice(i, 1)\r\n        }\r\n      }\r\n    },\r\n    specChanged: function(label) {\r\n      if (label === false) {\r\n        this.specifications = [{ specification: '规格', value: '标准', picUrl: '' }]\r\n        this.products = [{ id: 0, specifications: ['标准'], price: 0.00, number: 0, url: '' }]\r\n      } else {\r\n        this.specifications = []\r\n        this.products = []\r\n      }\r\n    },\r\n    uploadSpecPicUrl: function(response) {\r\n      this.specForm.picUrl = response.data.url\r\n    },\r\n    handleSpecificationShow() {\r\n      this.specForm = { specification: '', value: '', picUrl: '' }\r\n      this.specVisiable = true\r\n    },\r\n    handleSpecificationAdd() {\r\n      var index = this.specifications.length - 1\r\n      for (var i = 0; i < this.specifications.length; i++) {\r\n        const v = this.specifications[i]\r\n        if (v.specification === this.specForm.specification) {\r\n          if (v.value === this.specForm.value) {\r\n            this.$message({\r\n              type: 'warning',\r\n              message: '已经存在规格值:' + v.value\r\n            })\r\n            this.specForm = {}\r\n            this.specVisiable = false\r\n            return\r\n          } else {\r\n            index = i\r\n          }\r\n        }\r\n      }\r\n\r\n      this.specifications.splice(index + 1, 0, this.specForm)\r\n      this.specVisiable = false\r\n\r\n      this.specToProduct()\r\n    },\r\n    handleSpecificationDelete(row) {\r\n      const index = this.specifications.indexOf(row)\r\n      this.specifications.splice(index, 1)\r\n      this.specToProduct()\r\n    },\r\n    specToProduct() {\r\n      if (this.specifications.length === 0) {\r\n        return\r\n      }\r\n      // 根据specifications创建临时规格列表\r\n      var specValues = []\r\n      var spec = this.specifications[0].specification\r\n      var values = []\r\n      values.push(0)\r\n\r\n      for (var i = 1; i < this.specifications.length; i++) {\r\n        const aspec = this.specifications[i].specification\r\n\r\n        if (aspec === spec) {\r\n          values.push(i)\r\n        } else {\r\n          specValues.push(values)\r\n          spec = aspec\r\n          values = []\r\n          values.push(i)\r\n        }\r\n      }\r\n      specValues.push(values)\r\n\r\n      // 根据临时规格列表生产货品规格\r\n      // 算法基于 https://blog.csdn.net/tyhj_sf/article/details/53893125\r\n      var productsIndex = 0\r\n      var products = []\r\n      var combination = []\r\n      var n = specValues.length\r\n      for (var s = 0; s < n; s++) {\r\n        combination[s] = 0\r\n      }\r\n      var index = 0\r\n      var isContinue = false\r\n      do {\r\n        var specifications = []\r\n        for (var x = 0; x < n; x++) {\r\n          var z = specValues[x][combination[x]]\r\n          specifications.push(this.specifications[z].value)\r\n        }\r\n        products[productsIndex] = { id: productsIndex, specifications: specifications, price: 0.00, number: 0, url: '' }\r\n        productsIndex++\r\n\r\n        index++\r\n        combination[n - 1] = index\r\n        for (var j = n - 1; j >= 0; j--) {\r\n          if (combination[j] >= specValues[j].length) {\r\n            combination[j] = 0\r\n            index = 0\r\n            if (j - 1 >= 0) {\r\n              combination[j - 1] = combination[j - 1] + 1\r\n            }\r\n          }\r\n        }\r\n        isContinue = false\r\n        for (var p = 0; p < n; p++) {\r\n          if (combination[p] !== 0) {\r\n            isContinue = true\r\n          }\r\n        }\r\n      } while (isContinue)\r\n\r\n      this.products = products\r\n    },\r\n    handleProductShow(row) {\r\n      this.productForm = Object.assign({}, row)\r\n      this.productVisiable = true\r\n    },\r\n    uploadProductUrl: function(response) {\r\n      this.productForm.url = response.data.url\r\n    },\r\n    handleProductEdit() {\r\n      for (var i = 0; i < this.products.length; i++) {\r\n        const v = this.products[i]\r\n        if (v.id === this.productForm.id) {\r\n          this.products.splice(i, 1, this.productForm)\r\n          break\r\n        }\r\n      }\r\n      this.productVisiable = false\r\n    },\r\n    handleAttributeShow() {\r\n      this.attributeForm = {}\r\n      this.attributeVisiable = true\r\n    },\r\n    handleAttributeAdd() {\r\n      this.attributes.unshift(this.attributeForm)\r\n      this.attributeVisiable = false\r\n    },\r\n    handleAttributeDelete(row) {\r\n      const index = this.attributes.indexOf(row)\r\n      this.attributes.splice(index, 1)\r\n    }\r\n  }\r\n}\r\n</script>\r\n"],"sourceRoot":"src/views/goods"}]}