{"remainingRequest":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-web\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\XM\\his-shopping-web\\src\\store\\modules\\permission.js","dependencies":[{"path":"E:\\XM\\his-shopping-web\\src\\store\\modules\\permission.js","mtime":1606183812529},{"path":"E:\\XM\\his-shopping-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\XM\\his-shopping-web\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _objectSpread2 = _interopRequireDefault(require(\"E:/XM/his-shopping-web/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nvar _router = require(\"@/router\");\n\n/**\r\n * 通过meta.perms判断是否与当前用户权限匹配\r\n * @param perms\r\n * @param route\r\n */\nfunction hasPermission(perms, route) {\n  if (route.meta && route.meta.perms) {\n    return perms.some(function (perm) {\n      return route.meta.perms.includes(perm);\n    });\n  } else {\n    return true;\n  }\n}\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param routes asyncRoutes\r\n * @param perms\r\n */\n\n\nfunction filterAsyncRoutes(routes, perms) {\n  var res = [];\n  routes.forEach(function (route) {\n    var tmp = (0, _objectSpread2.default)({}, route);\n\n    if (tmp.children) {\n      tmp.children = filterAsyncRoutes(tmp.children, perms);\n\n      if (tmp.children && tmp.children.length > 0) {\n        res.push(tmp);\n      }\n    } else {\n      if (hasPermission(perms, tmp)) {\n        res.push(tmp);\n      }\n    }\n  });\n  return res;\n}\n\nvar permission = {\n  state: {\n    routes: _router.constantRoutes,\n    addRoutes: []\n  },\n  mutations: {\n    SET_ROUTES: function SET_ROUTES(state, routes) {\n      state.addRoutes = routes;\n      state.routes = _router.constantRoutes.concat(routes);\n    }\n  },\n  actions: {\n    GenerateRoutes: function GenerateRoutes(_ref, data) {\n      var commit = _ref.commit;\n      return new Promise(function (resolve) {\n        var perms = data.perms;\n        var accessedRoutes;\n\n        if (perms.includes('*')) {\n          accessedRoutes = _router.asyncRoutes;\n        } else {\n          accessedRoutes = filterAsyncRoutes(_router.asyncRoutes, perms);\n        }\n\n        commit('SET_ROUTES', accessedRoutes);\n        resolve();\n      });\n    }\n  }\n};\nvar _default = permission;\nexports.default = _default;",{"version":3,"sources":["E:/XM/his-shopping-web/src/store/modules/permission.js"],"names":["hasPermission","perms","route","meta","some","perm","includes","filterAsyncRoutes","routes","res","forEach","tmp","children","length","push","permission","state","constantRoutes","addRoutes","mutations","SET_ROUTES","concat","actions","GenerateRoutes","data","commit","Promise","resolve","accessedRoutes","asyncRoutes"],"mappings":";;;;;;;;;;;;;;;;;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASA,aAAT,CAAuBC,KAAvB,EAA8BC,KAA9B,EAAqC;AACnC,MAAIA,KAAK,CAACC,IAAN,IAAcD,KAAK,CAACC,IAAN,CAAWF,KAA7B,EAAoC;AAClC,WAAOA,KAAK,CAACG,IAAN,CAAW,UAAAC,IAAI;AAAA,aAAIH,KAAK,CAACC,IAAN,CAAWF,KAAX,CAAiBK,QAAjB,CAA0BD,IAA1B,CAAJ;AAAA,KAAf,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAP;AACD;AACF;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASE,iBAAT,CAA2BC,MAA3B,EAAmCP,KAAnC,EAA0C;AACxC,MAAMQ,GAAG,GAAG,EAAZ;AAEAD,EAAAA,MAAM,CAACE,OAAP,CAAe,UAAAR,KAAK,EAAI;AACtB,QAAMS,GAAG,mCAAQT,KAAR,CAAT;;AACA,QAAIS,GAAG,CAACC,QAAR,EAAkB;AAChBD,MAAAA,GAAG,CAACC,QAAJ,GAAeL,iBAAiB,CAACI,GAAG,CAACC,QAAL,EAAeX,KAAf,CAAhC;;AACA,UAAIU,GAAG,CAACC,QAAJ,IAAgBD,GAAG,CAACC,QAAJ,CAAaC,MAAb,GAAsB,CAA1C,EAA6C;AAC3CJ,QAAAA,GAAG,CAACK,IAAJ,CAASH,GAAT;AACD;AACF,KALD,MAKO;AACL,UAAIX,aAAa,CAACC,KAAD,EAAQU,GAAR,CAAjB,EAA+B;AAC7BF,QAAAA,GAAG,CAACK,IAAJ,CAASH,GAAT;AACD;AACF;AACF,GAZD;AAcA,SAAOF,GAAP;AACD;;AAED,IAAMM,UAAU,GAAG;AACjBC,EAAAA,KAAK,EAAE;AACLR,IAAAA,MAAM,EAAES,sBADH;AAELC,IAAAA,SAAS,EAAE;AAFN,GADU;AAKjBC,EAAAA,SAAS,EAAE;AACTC,IAAAA,UAAU,EAAE,oBAACJ,KAAD,EAAQR,MAAR,EAAmB;AAC7BQ,MAAAA,KAAK,CAACE,SAAN,GAAkBV,MAAlB;AACAQ,MAAAA,KAAK,CAACR,MAAN,GAAeS,uBAAeI,MAAf,CAAsBb,MAAtB,CAAf;AACD;AAJQ,GALM;AAWjBc,EAAAA,OAAO,EAAE;AACPC,IAAAA,cADO,gCACoBC,IADpB,EAC0B;AAAA,UAAhBC,MAAgB,QAAhBA,MAAgB;AAC/B,aAAO,IAAIC,OAAJ,CAAY,UAAAC,OAAO,EAAI;AAAA,YACpB1B,KADoB,GACVuB,IADU,CACpBvB,KADoB;AAE5B,YAAI2B,cAAJ;;AACA,YAAI3B,KAAK,CAACK,QAAN,CAAe,GAAf,CAAJ,EAAyB;AACvBsB,UAAAA,cAAc,GAAGC,mBAAjB;AACD,SAFD,MAEO;AACLD,UAAAA,cAAc,GAAGrB,iBAAiB,CAACsB,mBAAD,EAAc5B,KAAd,CAAlC;AACD;;AACDwB,QAAAA,MAAM,CAAC,YAAD,EAAeG,cAAf,CAAN;AACAD,QAAAA,OAAO;AACR,OAVM,CAAP;AAWD;AAbM;AAXQ,CAAnB;eA4BeZ,U","sourcesContent":["import { asyncRoutes, constantRoutes } from '@/router'\r\n\r\n/**\r\n * 通过meta.perms判断是否与当前用户权限匹配\r\n * @param perms\r\n * @param route\r\n */\r\nfunction hasPermission(perms, route) {\r\n  if (route.meta && route.meta.perms) {\r\n    return perms.some(perm => route.meta.perms.includes(perm))\r\n  } else {\r\n    return true\r\n  }\r\n}\r\n\r\n/**\r\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\r\n * @param routes asyncRoutes\r\n * @param perms\r\n */\r\nfunction filterAsyncRoutes(routes, perms) {\r\n  const res = []\r\n\r\n  routes.forEach(route => {\r\n    const tmp = { ...route }\r\n    if (tmp.children) {\r\n      tmp.children = filterAsyncRoutes(tmp.children, perms)\r\n      if (tmp.children && tmp.children.length > 0) {\r\n        res.push(tmp)\r\n      }\r\n    } else {\r\n      if (hasPermission(perms, tmp)) {\r\n        res.push(tmp)\r\n      }\r\n    }\r\n  })\r\n\r\n  return res\r\n}\r\n\r\nconst permission = {\r\n  state: {\r\n    routes: constantRoutes,\r\n    addRoutes: []\r\n  },\r\n  mutations: {\r\n    SET_ROUTES: (state, routes) => {\r\n      state.addRoutes = routes\r\n      state.routes = constantRoutes.concat(routes)\r\n    }\r\n  },\r\n  actions: {\r\n    GenerateRoutes({ commit }, data) {\r\n      return new Promise(resolve => {\r\n        const { perms } = data\r\n        let accessedRoutes\r\n        if (perms.includes('*')) {\r\n          accessedRoutes = asyncRoutes\r\n        } else {\r\n          accessedRoutes = filterAsyncRoutes(asyncRoutes, perms)\r\n        }\r\n        commit('SET_ROUTES', accessedRoutes)\r\n        resolve()\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default permission\r\n"]}]}