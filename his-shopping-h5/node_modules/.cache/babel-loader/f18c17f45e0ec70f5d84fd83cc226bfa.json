{"remainingRequest":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-h5\\src\\views\\order\\checkout.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\XM\\his-shopping-h5\\src\\views\\order\\checkout.vue","mtime":1606186248939},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nrequire(\"vant/es/popup/style\");\n\nvar _popup = _interopRequireDefault(require(\"vant/es/popup\"));\n\nrequire(\"vant/es/coupon-list/style\");\n\nvar _couponList = _interopRequireDefault(require(\"vant/es/coupon-list\"));\n\nrequire(\"vant/es/coupon-cell/style\");\n\nvar _couponCell = _interopRequireDefault(require(\"vant/es/coupon-cell\"));\n\nrequire(\"vant/es/tag/style\");\n\nvar _tag = _interopRequireDefault(require(\"vant/es/tag\"));\n\nrequire(\"vant/es/field/style\");\n\nvar _field = _interopRequireDefault(require(\"vant/es/field\"));\n\nrequire(\"vant/es/card/style\");\n\nvar _card = _interopRequireDefault(require(\"vant/es/card\"));\n\nrequire(\"vant/es/submit-bar/style\");\n\nvar _submitBar = _interopRequireDefault(require(\"vant/es/submit-bar\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"vant/es/toast/style\");\n\nvar _toast = _interopRequireDefault(require(\"vant/es/toast\"));\n\nvar _api = require(\"@/api/api\");\n\nvar _localStorage = require(\"@/utils/local-storage\");\n\nvar _dayjs = _interopRequireDefault(require(\"dayjs\"));\n\nvar _components;\n\nvar _default = {\n  data: function data() {\n    return {\n      checkedGoodsList: [],\n      checkedAddress: {},\n      availableCouponLength: 0,\n      // 可用的优惠券数量\n      goodsTotalPrice: 0,\n      //商品总价\n      freightPrice: 0,\n      //快递费\n      couponPrice: 0,\n      //优惠券的价格\n      grouponPrice: 0,\n      //团购优惠价格\n      orderTotalPrice: 0,\n      //订单总价\n      actualPrice: 0,\n      //实际需要支付的总价\n      message: '',\n      isDisabled: false,\n      showList: false,\n      chosenCoupon: -1,\n      coupons: [],\n      disabledCoupons: []\n    };\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    onSubmit: function onSubmit() {\n      var _this = this;\n\n      var _getLocalStorage = (0, _localStorage.getLocalStorage)('AddressId', 'CartId', 'CouponId', 'UserCouponId'),\n          AddressId = _getLocalStorage.AddressId,\n          CartId = _getLocalStorage.CartId,\n          CouponId = _getLocalStorage.CouponId,\n          UserCouponId = _getLocalStorage.UserCouponId;\n\n      if (AddressId === null) {\n        _toast.default.fail('请设置收货地址');\n\n        return;\n      }\n\n      this.isDisabled = true;\n      (0, _api.orderSubmit)({\n        addressId: AddressId,\n        cartId: CartId,\n        couponId: CouponId,\n        userCouponId: UserCouponId,\n        grouponLinkId: 0,\n        grouponRulesId: 0,\n        message: this.message\n      }).then(function (res) {\n        // 下单成功，重置下单参数。\n        (0, _localStorage.setLocalStorage)({\n          AddressId: 0,\n          CartId: 0,\n          CouponId: 0\n        });\n        var orderId = res.data.data.orderId;\n\n        _this.$router.push({\n          name: 'payment',\n          params: {\n            orderId: orderId\n          }\n        });\n      }).catch(function (error) {\n        _this.isDisabled = false;\n\n        _this.$toast(\"下单失败\");\n      });\n    },\n    goAddressList: function goAddressList() {\n      this.$router.push({\n        path: '/user/address',\n        query: {\n          from: 'shopcar'\n        }\n      });\n    },\n    getCouponValue: function getCouponValue() {\n      if (this.couponPrice !== 0) {\n        return \"-¥\" + this.couponPrice + \".00元\";\n      }\n\n      if (this.availableCouponLength !== 0) {\n        return this.availableCouponLength + \"张可用\";\n      }\n\n      return '没有可用优惠券';\n    },\n    getCoupons: function getCoupons() {\n      var _this2 = this;\n\n      var _getLocalStorage2 = (0, _localStorage.getLocalStorage)('AddressId', 'CartId', 'CouponId'),\n          AddressId = _getLocalStorage2.AddressId,\n          CartId = _getLocalStorage2.CartId,\n          CouponId = _getLocalStorage2.CouponId;\n\n      (0, _api.couponSelectList)({\n        cartId: CartId,\n        grouponRulesId: 0\n      }).then(function (res) {\n        var cList = res.data.data.list;\n        _this2.coupons = [];\n        _this2.disabledCoupons = [];\n\n        for (var i = 0; i < cList.length; i++) {\n          var c = cList[i];\n          var coupon = {\n            id: c.id,\n            cid: c.cid,\n            name: c.name,\n            condition: '满' + c.min + '元可用',\n            value: c.discount * 100,\n            description: c.desc,\n            startAt: new Date(c.startTime).getTime() / 1000,\n            endAt: new Date(c.endTime).getTime() / 1000,\n            valueDesc: c.discount,\n            unitDesc: '元'\n          };\n\n          if (c.available) {\n            _this2.coupons.push(coupon);\n          } else {\n            _this2.disabledCoupons.push(coupon);\n          }\n        }\n\n        _this2.showList = true;\n      });\n    },\n    init: function init() {\n      var _this3 = this;\n\n      var _getLocalStorage3 = (0, _localStorage.getLocalStorage)('AddressId', 'CartId', 'CouponId', 'UserCouponId'),\n          AddressId = _getLocalStorage3.AddressId,\n          CartId = _getLocalStorage3.CartId,\n          CouponId = _getLocalStorage3.CouponId,\n          UserCouponId = _getLocalStorage3.UserCouponId;\n\n      (0, _api.cartCheckout)({\n        cartId: CartId,\n        addressId: AddressId,\n        couponId: CouponId,\n        userCouponId: UserCouponId,\n        grouponRulesId: 0\n      }).then(function (res) {\n        var data = res.data.data;\n        _this3.checkedGoodsList = data.checkedGoodsList;\n        _this3.checkedAddress = data.checkedAddress;\n        _this3.availableCouponLength = data.availableCouponLength;\n        _this3.actualPrice = data.actualPrice;\n        _this3.couponPrice = data.couponPrice;\n        _this3.grouponPrice = data.grouponPrice;\n        _this3.freightPrice = data.freightPrice;\n        _this3.goodsTotalPrice = data.goodsTotalPrice;\n        _this3.orderTotalPrice = data.orderTotalPrice;\n        (0, _localStorage.setLocalStorage)({\n          AddressId: data.addressId,\n          CartId: data.cartId,\n          CouponId: data.couponId,\n          UserCouponId: data.userCouponId\n        });\n      });\n    },\n    onChange: function onChange(index) {\n      this.showList = false;\n      this.chosenCoupon = index;\n\n      if (index === -1) {\n        (0, _localStorage.setLocalStorage)({\n          CouponId: -1,\n          UserCouponId: -1\n        });\n      } else {\n        var couponId = this.coupons[index].cid;\n        var userCouponId = this.coupons[index].id;\n        (0, _localStorage.setLocalStorage)({\n          CouponId: couponId,\n          UserCouponId: userCouponId\n        });\n      }\n\n      this.init();\n    },\n    onExchange: function onExchange() {\n      this.$toast(\"兑换暂不支持\");\n    }\n  },\n  components: (_components = {}, (0, _defineProperty2.default)(_components, _toast.default.name, _toast.default), (0, _defineProperty2.default)(_components, _submitBar.default.name, _submitBar.default), (0, _defineProperty2.default)(_components, _card.default.name, _card.default), (0, _defineProperty2.default)(_components, _field.default.name, _field.default), (0, _defineProperty2.default)(_components, _tag.default.name, _tag.default), (0, _defineProperty2.default)(_components, _couponCell.default.name, _couponCell.default), (0, _defineProperty2.default)(_components, _couponList.default.name, _couponList.default), (0, _defineProperty2.default)(_components, _popup.default.name, _popup.default), _components)\n};\nexports.default = _default;",{"version":3,"sources":["checkout.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4EA;;AACA;;AACA;;;;eAEA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,gBAAA,EAAA,EADA;AAEA,MAAA,cAAA,EAAA,EAFA;AAGA,MAAA,qBAAA,EAAA,CAHA;AAGA;AACA,MAAA,eAAA,EAAA,CAJA;AAIA;AACA,MAAA,YAAA,EAAA,CALA;AAKA;AACA,MAAA,WAAA,EAAA,CANA;AAMA;AACA,MAAA,YAAA,EAAA,CAPA;AAOA;AACA,MAAA,eAAA,EAAA,CARA;AAQA;AACA,MAAA,WAAA,EAAA,CATA;AASA;AACA,MAAA,OAAA,EAAA,EAVA;AAYA,MAAA,UAAA,EAAA,KAZA;AAaA,MAAA,QAAA,EAAA,KAbA;AAcA,MAAA,YAAA,EAAA,CAAA,CAdA;AAeA,MAAA,OAAA,EAAA,EAfA;AAgBA,MAAA,eAAA,EAAA;AAhBA,KAAA;AAkBA,GApBA;AAqBA,EAAA,OArBA,qBAqBA;AACA,SAAA,IAAA;AACA,GAvBA;AAyBA,EAAA,OAAA,EAAA;AACA,IAAA,QADA,sBACA;AAAA;;AAAA,6BACA,mCAAA,WAAA,EAAA,QAAA,EAAA,UAAA,EAAA,cAAA,CADA;AAAA,UACA,SADA,oBACA,SADA;AAAA,UACA,MADA,oBACA,MADA;AAAA,UACA,QADA,oBACA,QADA;AAAA,UACA,YADA,oBACA,YADA;;AAGA,UAAA,SAAA,KAAA,IAAA,EAAA;AACA,uBAAA,IAAA,CAAA,SAAA;;AACA;AACA;;AAGA,WAAA,UAAA,GAAA,IAAA;AAEA,4BAAA;AACA,QAAA,SAAA,EAAA,SADA;AAEA,QAAA,MAAA,EAAA,MAFA;AAGA,QAAA,QAAA,EAAA,QAHA;AAIA,QAAA,YAAA,EAAA,YAJA;AAKA,QAAA,aAAA,EAAA,CALA;AAMA,QAAA,cAAA,EAAA,CANA;AAOA,QAAA,OAAA,EAAA,KAAA;AAPA,OAAA,EAQA,IARA,CAQA,UAAA,GAAA,EAAA;AAEA;AACA,2CAAA;AAAA,UAAA,SAAA,EAAA,CAAA;AAAA,UAAA,MAAA,EAAA,CAAA;AAAA,UAAA,QAAA,EAAA;AAAA,SAAA;AAEA,YAAA,OAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA,CAAA,OAAA;;AACA,QAAA,KAAA,CAAA,OAAA,CAAA,IAAA,CAAA;AACA,UAAA,IAAA,EAAA,SADA;AAEA,UAAA,MAAA,EAAA;AAAA,YAAA,OAAA,EAAA;AAAA;AAFA,SAAA;AAIA,OAlBA,EAkBA,KAlBA,CAkBA,UAAA,KAAA,EAAA;AACA,QAAA,KAAA,CAAA,UAAA,GAAA,KAAA;;AACA,QAAA,KAAA,CAAA,MAAA,CAAA,MAAA;AACA,OArBA;AAuBA,KAnCA;AAoCA,IAAA,aApCA,2BAoCA;AACA,WAAA,OAAA,CAAA,IAAA,CAAA;AACA,QAAA,IAAA,EAAA,eADA;AAEA,QAAA,KAAA,EAAA;AACA,UAAA,IAAA,EAAA;AADA;AAFA,OAAA;AAMA,KA3CA;AA4CA,IAAA,cA5CA,4BA4CA;AACA,UAAA,KAAA,WAAA,KAAA,CAAA,EAAA;AACA,eAAA,OAAA,KAAA,WAAA,GAAA,MAAA;AACA;;AACA,UAAA,KAAA,qBAAA,KAAA,CAAA,EAAA;AACA,eAAA,KAAA,qBAAA,GAAA,KAAA;AACA;;AACA,aAAA,SAAA;AACA,KApDA;AAqDA,IAAA,UArDA,wBAqDA;AAAA;;AAAA,8BACA,mCAAA,WAAA,EAAA,QAAA,EAAA,UAAA,CADA;AAAA,UACA,SADA,qBACA,SADA;AAAA,UACA,MADA,qBACA,MADA;AAAA,UACA,QADA,qBACA,QADA;;AAEA,iCAAA;AAAA,QAAA,MAAA,EAAA,MAAA;AAAA,QAAA,cAAA,EAAA;AAAA,OAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,KAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA,CAAA,IAAA;AACA,QAAA,MAAA,CAAA,OAAA,GAAA,EAAA;AACA,QAAA,MAAA,CAAA,eAAA,GAAA,EAAA;;AACA,aAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,KAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,cAAA,CAAA,GAAA,KAAA,CAAA,CAAA,CAAA;AAEA,cAAA,MAAA,GAAA;AACA,YAAA,EAAA,EAAA,CAAA,CAAA,EADA;AAEA,YAAA,GAAA,EAAA,CAAA,CAAA,GAFA;AAGA,YAAA,IAAA,EAAA,CAAA,CAAA,IAHA;AAIA,YAAA,SAAA,EAAA,MAAA,CAAA,CAAA,GAAA,GAAA,KAJA;AAKA,YAAA,KAAA,EAAA,CAAA,CAAA,QAAA,GAAA,GALA;AAMA,YAAA,WAAA,EAAA,CAAA,CAAA,IANA;AAOA,YAAA,OAAA,EAAA,IAAA,IAAA,CAAA,CAAA,CAAA,SAAA,EAAA,OAAA,KAAA,IAPA;AAQA,YAAA,KAAA,EAAA,IAAA,IAAA,CAAA,CAAA,CAAA,OAAA,EAAA,OAAA,KAAA,IARA;AASA,YAAA,SAAA,EAAA,CAAA,CAAA,QATA;AAUA,YAAA,QAAA,EAAA;AAVA,WAAA;;AAYA,cAAA,CAAA,CAAA,SAAA,EAAA;AACA,YAAA,MAAA,CAAA,OAAA,CAAA,IAAA,CAAA,MAAA;AACA,WAFA,MAEA;AACA,YAAA,MAAA,CAAA,eAAA,CAAA,IAAA,CAAA,MAAA;AACA;AACA;;AAEA,QAAA,MAAA,CAAA,QAAA,GAAA,IAAA;AACA,OA3BA;AA4BA,KAnFA;AAoFA,IAAA,IApFA,kBAoFA;AAAA;;AAAA,8BACA,mCAAA,WAAA,EAAA,QAAA,EAAA,UAAA,EAAA,cAAA,CADA;AAAA,UACA,SADA,qBACA,SADA;AAAA,UACA,MADA,qBACA,MADA;AAAA,UACA,QADA,qBACA,QADA;AAAA,UACA,YADA,qBACA,YADA;;AAGA,6BAAA;AAAA,QAAA,MAAA,EAAA,MAAA;AAAA,QAAA,SAAA,EAAA,SAAA;AAAA,QAAA,QAAA,EAAA,QAAA;AAAA,QAAA,YAAA,EAAA,YAAA;AAAA,QAAA,cAAA,EAAA;AAAA,OAAA,EAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA;AAEA,QAAA,MAAA,CAAA,gBAAA,GAAA,IAAA,CAAA,gBAAA;AACA,QAAA,MAAA,CAAA,cAAA,GAAA,IAAA,CAAA,cAAA;AACA,QAAA,MAAA,CAAA,qBAAA,GAAA,IAAA,CAAA,qBAAA;AACA,QAAA,MAAA,CAAA,WAAA,GAAA,IAAA,CAAA,WAAA;AACA,QAAA,MAAA,CAAA,WAAA,GAAA,IAAA,CAAA,WAAA;AACA,QAAA,MAAA,CAAA,YAAA,GAAA,IAAA,CAAA,YAAA;AACA,QAAA,MAAA,CAAA,YAAA,GAAA,IAAA,CAAA,YAAA;AACA,QAAA,MAAA,CAAA,eAAA,GAAA,IAAA,CAAA,eAAA;AACA,QAAA,MAAA,CAAA,eAAA,GAAA,IAAA,CAAA,eAAA;AAEA,2CAAA;AAAA,UAAA,SAAA,EAAA,IAAA,CAAA,SAAA;AAAA,UAAA,MAAA,EAAA,IAAA,CAAA,MAAA;AAAA,UAAA,QAAA,EAAA,IAAA,CAAA,QAAA;AAAA,UAAA,YAAA,EAAA,IAAA,CAAA;AAAA,SAAA;AACA,OAdA;AAgBA,KAvGA;AAwGA,IAAA,QAxGA,oBAwGA,KAxGA,EAwGA;AACA,WAAA,QAAA,GAAA,KAAA;AACA,WAAA,YAAA,GAAA,KAAA;;AAEA,UAAA,KAAA,KAAA,CAAA,CAAA,EAAA;AACA,2CAAA;AAAA,UAAA,QAAA,EAAA,CAAA,CAAA;AAAA,UAAA,YAAA,EAAA,CAAA;AAAA,SAAA;AACA,OAFA,MAGA;AACA,YAAA,QAAA,GAAA,KAAA,OAAA,CAAA,KAAA,EAAA,GAAA;AACA,YAAA,YAAA,GAAA,KAAA,OAAA,CAAA,KAAA,EAAA,EAAA;AACA,2CAAA;AAAA,UAAA,QAAA,EAAA,QAAA;AAAA,UAAA,YAAA,EAAA;AAAA,SAAA;AACA;;AAEA,WAAA,IAAA;AACA,KAtHA;AAuHA,IAAA,UAvHA,wBAuHA;AACA,WAAA,MAAA,CAAA,QAAA;AACA;AAzHA,GAzBA;AAqJA,EAAA,UAAA,gEACA,eAAA,IADA,8DAEA,mBAAA,IAFA,kEAGA,cAAA,IAHA,6DAIA,eAAA,IAJA,8DAKA,aAAA,IALA,4DAMA,oBAAA,IANA,mEAOA,oBAAA,IAPA,mEAQA,eAAA,IARA;AArJA,C","sourcesContent":["<template>\r\n<div class=\"order\">\r\n  <van-cell-group>\r\n      <van-cell v-if=\"checkedAddress\" isLink @click=\"goAddressList()\" title=\"收货地址\">\r\n      <div slot=\"label\">\r\n        <div>\r\n         <span>{{ checkedAddress.name }} </span>\r\n         <span>{{ checkedAddress.tel }} </span>\r\n      </div>\r\n      <div>\r\n        {{ checkedAddress.addressDetail }}\r\n      </div>\r\n      </div>\r\n    </van-cell>\r\n  </van-cell-group>\r\n\r\n  <van-cell-group>\r\n    <van-cell class=\"order-coupon\" title=\"优惠券\" is-link :value=\"getCouponValue()\" @click=\"getCoupons\" />\r\n  </van-cell-group>\r\n\r\n<!-- 优惠券列表 -->\r\n<van-popup v-model=\"showList\" position=\"bottom\">\r\n  <van-coupon-list\r\n    :coupons=\"coupons\"\r\n    :chosen-coupon=\"chosenCoupon\"\r\n    :disabled-coupons=\"disabledCoupons\"\r\n    @change=\"onChange\"\r\n    @exchange=\"onExchange\"\r\n  />\r\n</van-popup>\r\n\r\n    <van-card\r\n      v-for=\"item in checkedGoodsList\"\r\n      :key=\"item.id\"\r\n      :title=\"item.goodsName\"\r\n      :num=\"item.number\"\r\n      :price=\"item.price +'.00'\"\r\n      :thumb=\"item.picUrl\"\r\n    >\r\n      <div slot=\"desc\">\r\n        <div class=\"van-card__desc\">\r\n          <van-tag plain style=\"margin-right:6px;\" v-for=\"(spec, index) in item.specifications\" :key=\"index\">\r\n            {{spec}}\r\n          </van-tag>\r\n        </div>\r\n      </div>\r\n    </van-card>\r\n\r\n    <van-cell-group>\r\n      <van-cell title=\"商品金额\">\r\n        <span class=\"red\">{{goodsTotalPrice * 100 | yuan}}</span>\r\n      </van-cell>\r\n      <van-cell title=\"邮费\">\r\n        <span class=\"red\">{{ freightPrice * 100| yuan}}</span>\r\n      </van-cell>\r\n      <van-cell title=\"优惠券\">\r\n        <span class=\"red\">-{{ couponPrice * 100| yuan}}</span>\r\n      </van-cell>\r\n      <van-field v-model=\"message\" placeholder=\"请输入备注\" label=\"订单备注\">\r\n      <template slot=\"icon\">{{message.length}}/50</template>\r\n      </van-field>      \r\n    </van-cell-group>\r\n\r\n    <van-submit-bar\r\n      :price=\"actualPrice*100\"\r\n      label=\"总计：\"\r\n      buttonText=\"提交订单\"\r\n      :disabled=\"isDisabled\"\r\n      @submit=\"onSubmit\"\r\n    />\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport { Card, Tag, ard, Field, SubmitBar, Toast  } from 'vant';\r\nimport { CouponCell, CouponList, Popup } from 'vant';\r\nimport { cartCheckout, orderSubmit, couponSelectList} from '@/api/api';\r\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\r\nimport dayjs from 'dayjs';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      checkedGoodsList: [],\r\n      checkedAddress: {},\r\n      availableCouponLength: 0, // 可用的优惠券数量\r\n      goodsTotalPrice: 0, //商品总价\r\n      freightPrice: 0, //快递费\r\n      couponPrice: 0, //优惠券的价格\r\n      grouponPrice: 0, //团购优惠价格\r\n      orderTotalPrice: 0, //订单总价\r\n      actualPrice: 0, //实际需要支付的总价\r\n      message: '',\r\n\r\n      isDisabled: false,\r\n      showList: false,\r\n      chosenCoupon: -1,\r\n      coupons: [],\r\n      disabledCoupons: [] \r\n    };\r\n  },\r\n  created() {\r\n    this.init();\r\n  },\r\n\r\n  methods: {\r\n    onSubmit() {     \r\n      const {AddressId, CartId, CouponId, UserCouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId', 'UserCouponId');\r\n\r\n      if (AddressId === null) {\r\n        Toast.fail('请设置收货地址');\r\n        return;\r\n      }\r\n\r\n\r\n      this.isDisabled = true;\r\n\r\n      orderSubmit({\r\n        addressId: AddressId,\r\n        cartId: CartId,\r\n        couponId: CouponId,\r\n        userCouponId: UserCouponId,\r\n        grouponLinkId: 0,\r\n        grouponRulesId: 0,\r\n        message: this.message\r\n      }).then(res => {\r\n        \r\n        // 下单成功，重置下单参数。\r\n        setLocalStorage({AddressId: 0, CartId: 0, CouponId: 0});\r\n\r\n        let orderId = res.data.data.orderId;\r\n        this.$router.push({\r\n          name: 'payment',\r\n          params: { orderId: orderId }\r\n        });\r\n      }).catch(error => {\r\n        this.isDisabled = false;\r\n        this.$toast(\"下单失败\");\r\n      })\r\n\r\n    },\r\n    goAddressList() {\r\n      this.$router.push({\r\n        path: '/user/address',\r\n        query: {\r\n          from: 'shopcar'\r\n        }\r\n      });\r\n    },\r\n    getCouponValue() {\r\n      if(this.couponPrice !== 0 ){\r\n        return \"-¥\" + this.couponPrice + \".00元\"\r\n      }\r\n      if(this.availableCouponLength !== 0){\r\n        return this.availableCouponLength + \"张可用\"\r\n      }\r\n      return '没有可用优惠券'\r\n    },\r\n    getCoupons() {\r\n      const {AddressId, CartId, CouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId');\r\n      couponSelectList({cartId: CartId, grouponRulesId: 0}).then(res => {\r\n        var cList = res.data.data.list;\r\n        this.coupons = []\r\n        this.disabledCoupons = [];\r\n        for(var i = 0; i < cList.length; i++){\r\n          var c = cList[i]\r\n\r\n          var coupon = {\r\n            id: c.id,\r\n            cid: c.cid,\r\n            name: c.name,\r\n            condition: '满' + c.min + '元可用',\r\n            value: c.discount * 100,\r\n            description: c.desc,\r\n            startAt: new Date(c.startTime).getTime()/1000,\r\n            endAt: new Date(c.endTime).getTime()/1000,\r\n            valueDesc: c.discount,\r\n            unitDesc: '元'            \r\n          }\r\n          if (c.available) {\r\n            this.coupons.push(coupon);\r\n          } else {\r\n            this.disabledCoupons.push(coupon);\r\n          }\r\n        }\r\n        \r\n        this.showList = true\r\n      })\r\n    },\r\n    init() {\r\n      const {AddressId, CartId, CouponId, UserCouponId} = getLocalStorage('AddressId', 'CartId', 'CouponId', 'UserCouponId');\r\n\r\n      cartCheckout({cartId: CartId, addressId: AddressId, couponId: CouponId, userCouponId: UserCouponId, grouponRulesId: 0}).then(res => {\r\n          var data = res.data.data\r\n\r\n          this.checkedGoodsList = data.checkedGoodsList;\r\n          this.checkedAddress= data.checkedAddress;\r\n          this.availableCouponLength= data.availableCouponLength;\r\n          this.actualPrice= data.actualPrice;\r\n          this.couponPrice= data.couponPrice;\r\n          this.grouponPrice= data.grouponPrice;\r\n          this.freightPrice= data.freightPrice;\r\n          this.goodsTotalPrice= data.goodsTotalPrice;\r\n          this.orderTotalPrice= data.orderTotalPrice;\r\n\r\n          setLocalStorage({AddressId: data.addressId, CartId: data.cartId, CouponId: data.couponId, UserCouponId: data.userCouponId});\r\n      });\r\n\r\n    },\r\n    onChange(index) {\r\n      this.showList = false;\r\n      this.chosenCoupon = index;\r\n      \r\n      if(index === -1 ){\r\n        setLocalStorage({CouponId: -1, UserCouponId: -1});\r\n      }\r\n      else{\r\n        const couponId = this.coupons[index].cid;\r\n        const userCouponId = this.coupons[index].id;\r\n        setLocalStorage({CouponId: couponId, UserCouponId: userCouponId});\r\n      }\r\n\r\n      this.init()\r\n    },\r\n    onExchange() {\r\n      this.$toast(\"兑换暂不支持\");\r\n    }    \r\n  },\r\n\r\n  components: {\r\n    [Toast.name]: Toast ,\r\n    [SubmitBar.name]: SubmitBar,\r\n    [Card.name]: Card,\r\n    [Field.name]: Field,\r\n    [Tag.name]: Tag,\r\n    [CouponCell.name]: CouponCell,\r\n    [CouponList.name]: CouponList,\r\n    [Popup.name]: Popup\r\n  }\r\n};\r\n</script>\r\n\r\n\r\n<style lang=\"scss\" scoped>\r\n.order-coupon {\r\n  margin-top: 10px;\r\n}\r\n</style>"],"sourceRoot":"src/views/order"}]}