{"remainingRequest":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-h5\\src\\views\\items\\detail\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\XM\\his-shopping-h5\\src\\views\\items\\detail\\index.vue","mtime":1606186248930},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"vant/es/goods-action-icon/style\");\n\nvar _goodsActionIcon = _interopRequireDefault(require(\"vant/es/goods-action-icon\"));\n\nrequire(\"vant/es/goods-action-button/style\");\n\nvar _goodsActionButton = _interopRequireDefault(require(\"vant/es/goods-action-button\"));\n\nrequire(\"vant/es/goods-action/style\");\n\nvar _goodsAction = _interopRequireDefault(require(\"vant/es/goods-action\"));\n\nrequire(\"vant/es/sku/style\");\n\nvar _sku = _interopRequireDefault(require(\"vant/es/sku\"));\n\nrequire(\"vant/es/swipe-item/style\");\n\nvar _swipeItem = _interopRequireDefault(require(\"vant/es/swipe-item\"));\n\nrequire(\"vant/es/swipe/style\");\n\nvar _swipe = _interopRequireDefault(require(\"vant/es/swipe\"));\n\nrequire(\"vant/es/popup/style\");\n\nvar _popup = _interopRequireDefault(require(\"vant/es/popup\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nvar _has2 = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _without2 = _interopRequireDefault(require(\"lodash/without\"));\n\nvar _each2 = _interopRequireDefault(require(\"lodash/each\"));\n\nvar _api = require(\"@/api/api\");\n\nvar _localStorage = require(\"@/utils/local-storage\");\n\nvar _popupProps = _interopRequireDefault(require(\"./popup-props\"));\n\nvar _components;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar _default = {\n  props: {\n    itemId: [String, Number]\n  },\n  data: function data() {\n    var isLogin = !!localStorage.getItem('Authorization');\n    return {\n      isLogin: isLogin,\n      goods: {\n        userHasCollect: 0,\n        info: {\n          gallery: []\n        }\n      },\n      sku: {\n        tree: [],\n        list: [],\n        price: '1.00' // 默认价格（单位元）\n\n      },\n      skuGoods: {\n        // 商品标题\n        title: '',\n        // 默认商品 sku 缩略图\n        picture: ''\n      },\n      cartInfo: 0,\n      selectSku: {\n        selectedNum: 1,\n        selectedSkuComb: {\n          sku_str: 'aa'\n        }\n      },\n      propsPopup: false,\n      showSku: false\n    };\n  },\n  computed: {\n    props_str: function props_str() {\n      var props_arr = [];\n      (0, _each2.default)(this.goods.attribute, function (json) {\n        props_arr.push([json['attribute'], json['value']]);\n      });\n      return props_arr || [];\n    }\n  },\n  created: function created() {\n    this.initData();\n  },\n  methods: {\n    skuClick: function skuClick() {\n      this.showSku = true;\n    },\n    initData: function initData() {\n      var _this = this;\n\n      (0, _api.goodsDetail)({\n        id: this.itemId\n      }).then(function (res) {\n        _this.goods = res.data.data;\n\n        _this.skuAdapter();\n      });\n      (0, _api.cartGoodsCount)().then(function (res) {\n        _this.cartInfo = res.data.data;\n      });\n    },\n    toCart: function toCart() {\n      this.$router.push({\n        name: 'cart'\n      });\n    },\n    addCollect: function addCollect() {\n      var _this2 = this;\n\n      (0, _api.collectAddOrDelete)({\n        valueId: this.itemId,\n        type: 0\n      }).then(function (res) {\n        if (_this2.goods.userHasCollect === 1) {\n          _this2.goods.userHasCollect = 0;\n        } else {\n          _this2.goods.userHasCollect = 1;\n\n          _this2.$toast({\n            message: '收藏成功',\n            duration: 1500\n          });\n        }\n      });\n    },\n    getProductId: function getProductId(s1, s2) {\n      var productId;\n      var s1_name;\n      var s2_name;\n      (0, _each2.default)(this.goods.specificationList, function (specification) {\n        (0, _each2.default)(specification.valueList, function (specValue) {\n          if (specValue.id === s1) {\n            s1_name = specValue.value;\n          } else if (specValue.id === s2) {\n            s2_name = specValue.value;\n          }\n        });\n      });\n      (0, _each2.default)(this.goods.productList, function (v) {\n        var result = (0, _without2.default)(v.specifications, s1_name, s2_name);\n\n        if (result.length === 0) {\n          productId = v.id;\n        }\n      });\n      return productId;\n    },\n    getProductIdByOne: function getProductIdByOne(s1) {\n      var productId;\n      var s1_name;\n      (0, _each2.default)(this.goods.specificationList, function (specification) {\n        (0, _each2.default)(specification.valueList, function (specValue) {\n          if (specValue.id === s1) {\n            s1_name = specValue.value;\n            return;\n          }\n        });\n      });\n      (0, _each2.default)(this.goods.productList, function (v) {\n        var result = (0, _without2.default)(v.specifications, s1_name);\n\n        if (result.length === 0) {\n          productId = v.id;\n        }\n      });\n      return productId;\n    },\n    addCart: function addCart(data) {\n      var _this3 = this;\n\n      var that = this;\n      var params = {\n        goodsId: data.goodsId,\n        number: data.selectedNum,\n        productId: 0\n      };\n\n      if ((0, _has2.default)(data.selectedSkuComb, 's3')) {\n        this.$toast({\n          message: '目前仅支持两规格',\n          duration: 1500\n        });\n        return;\n      } else if ((0, _has2.default)(data.selectedSkuComb, 's2')) {\n        params.productId = this.getProductId(data.selectedSkuComb.s1, data.selectedSkuComb.s2);\n      } else {\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\n      }\n\n      (0, _api.cartAdd)(params).then(function () {\n        _this3.cartInfo = _this3.cartInfo + data.selectedNum;\n\n        _this3.$toast({\n          message: '已添加至购物车',\n          duration: 1500\n        });\n\n        that.showSku = false;\n      });\n    },\n    buyGoods: function buyGoods(data) {\n      var _this4 = this;\n\n      var that = this;\n      var params = {\n        goodsId: data.goodsId,\n        number: data.selectedNum,\n        productId: 0\n      };\n\n      if ((0, _has2.default)(data.selectedSkuComb, 's3')) {\n        this.$toast({\n          message: '目前仅支持两规格',\n          duration: 1500\n        });\n        return;\n      } else if ((0, _has2.default)(data.selectedSkuComb, 's2')) {\n        params.productId = this.getProductId(data.selectedSkuComb.s1, data.selectedSkuComb.s2);\n      } else {\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\n      }\n\n      (0, _api.cartFastAdd)(params).then(function (res) {\n        var cartId = res.data.data;\n        (0, _localStorage.setLocalStorage)({\n          CartId: cartId\n        });\n        that.showSku = false;\n\n        _this4.$router.push('/order/checkout');\n      });\n    },\n    skuAdapter: function skuAdapter() {\n      var tree = this.setSkuTree();\n      var list = this.setSkuList();\n      var skuInfo = {\n        price: parseInt(this.goods.info.retailPrice),\n        // 未选择规格时的价格\n        stock_num: 0,\n        // TODO 总库存\n        collection_id: '',\n        // 无规格商品skuId取collection_id，否则取所选sku组合对应的id\n        none_sku: false,\n        // 是否无规格商品\n        hide_stock: true\n      };\n      this.sku = _objectSpread({\n        tree: tree,\n        list: list\n      }, skuInfo);\n      this.skuGoods = {\n        title: this.goods.info.name,\n        picture: this.goods.info.picUrl\n      };\n    },\n    setSkuList: function setSkuList() {\n      var _this5 = this;\n\n      var sku_list = [];\n      (0, _each2.default)(this.goods.productList, function (v) {\n        var sku_list_obj = {};\n        (0, _each2.default)(v.specifications, function (specificationName, index) {\n          sku_list_obj['s' + (~~index + 1)] = _this5.findSpecValueIdByName(specificationName);\n        });\n        sku_list_obj.price = v.price * 100;\n        sku_list_obj.stock_num = v.number;\n        sku_list.push(sku_list_obj);\n      });\n      return sku_list;\n    },\n    findSpecValueIdByName: function findSpecValueIdByName(name) {\n      var id = 0;\n      (0, _each2.default)(this.goods.specificationList, function (specification) {\n        (0, _each2.default)(specification.valueList, function (specValue) {\n          if (specValue.value === name) {\n            id = specValue.id;\n            return;\n          }\n        });\n\n        if (id !== 0) {\n          return;\n        }\n      });\n      return id;\n    },\n    setSkuTree: function setSkuTree() {\n      var that = this;\n      var specifications = [];\n      (0, _each2.default)(this.goods.specificationList, function (v, k) {\n        var values = [];\n        (0, _each2.default)(v.valueList, function (vv) {\n          vv.name = vv.value;\n          values.push({\n            id: vv.id,\n            name: vv.value,\n            imUrl: vv.picUrl\n          });\n        });\n        specifications.push({\n          k: v.name,\n          v: values,\n          k_s: 's' + (~~k + 1)\n        });\n      });\n      return specifications;\n    }\n  },\n  components: (_components = {}, (0, _defineProperty2.default)(_components, _popup.default.name, _popup.default), (0, _defineProperty2.default)(_components, _swipe.default.name, _swipe.default), (0, _defineProperty2.default)(_components, _swipeItem.default.name, _swipeItem.default), (0, _defineProperty2.default)(_components, _sku.default.name, _sku.default), (0, _defineProperty2.default)(_components, _goodsAction.default.name, _goodsAction.default), (0, _defineProperty2.default)(_components, _goodsActionButton.default.name, _goodsActionButton.default), (0, _defineProperty2.default)(_components, _goodsActionIcon.default.name, _goodsActionIcon.default), (0, _defineProperty2.default)(_components, _popupProps.default.name, _popupProps.default), _components)\n};\nexports.default = _default;",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"item_detail\">\r\n    <van-swipe :autoplay=\"3000\">\r\n      <van-swipe-item v-for=\"(image, index) in goods.info.gallery\" :key=\"index\">\r\n        <img v-lazy=\"image\" width=\"100%\">\r\n      </van-swipe-item>\r\n    </van-swipe>\r\n    <van-cell-group class=\"item_cell_group\" v-if=\"goods\">\r\n      <van-cell class=\"item_info\">\r\n        <div>\r\n          <span class=\"item_price\">{{ goods.info.retailPrice*100 | yuan }}</span>\r\n          <span class=\"item_market_price\">{{goods.info.counterPrice*100 | yuan}}</span>\r\n        </div>\r\n        <div class=\"item-title\">\r\n          {{ goods.info.name }}\r\n        </div>\r\n        <div class=\"item_intro\">{{goods.info.brief}}</div>\r\n      </van-cell>\r\n    </van-cell-group>\r\n\r\n  <div class=\"item_cell_group\">\r\n    <van-cell-group>\r\n      <van-cell\r\n        title=\"规格\"\r\n        isLink\r\n        value=\"请选择\"\r\n        @click.native=\"skuClick\"\r\n      />\r\n      <van-cell title=\"属性\" isLink @click.native=\"propsPopup = true\"/>\r\n      <van-cell title=\"运费\" value=\"满88免邮费\"/>\r\n    </van-cell-group>\r\n    <van-sku\r\n      v-model=\"showSku\"\r\n      :sku=\"sku\"\r\n      :hide-stock=\"true\"\r\n      :goods=\"skuGoods\"\r\n      :goodsId=\"goods.info.id\"\r\n      @buy-clicked=\"buyGoods\"\r\n      @add-cart=\"addCart\"\r\n    />\r\n    <van-popup v-model=\"propsPopup\" position=\"bottom\">\r\n      <popup-props :propsStr=\"props_str\"></popup-props>\r\n    </van-popup>\r\n  </div>\r\n\r\n    <div class=\"item_desc\">\r\n      <div class=\"item_desc_title\">商品详情</div>\r\n      <div class=\"item_desc_wrap\" v-if=\"goods.info.detail\" v-html=\"goods.info.detail\"></div>\r\n      <div class=\"item_desc_wrap\" v-else style=\"text-align: center;\">\r\n        <p>无详情</p>\r\n      </div>\r\n    </div>\r\n\r\n    <van-goods-action>\r\n      <van-goods-action-icon @click=\"toCart\" icon=\"cart-o\" :info=\"(cartInfo > 0) ? cartInfo : ''\"/>\r\n      <van-goods-action-icon @click=\"addCollect\" icon=\"star-o\" :style=\"(goods.userHasCollect !== 0) ? 'color: #f7b444;':''\"/>\r\n      <van-goods-action-button type=\"warning\" @click=\"skuClick\" text=\"加入购物车\"/>\r\n      <van-goods-action-button type=\"danger\" @click=\"skuClick\" text=\"立即购买\"/>\r\n    </van-goods-action>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport { goodsDetail, cartGoodsCount, collectAddOrDelete, cartAdd, cartFastAdd } from '@/api/api';\r\n\r\nimport { Sku, Swipe, SwipeItem, GoodsAction, GoodsActionButton, GoodsActionIcon, Popup } from 'vant';\r\nimport { setLocalStorage } from '@/utils/local-storage';\r\nimport popupProps from './popup-props';\r\nimport _ from 'lodash';\r\n\r\nexport default {\r\n  props: {\r\n    itemId: [String, Number]\r\n  },\r\n\r\n  data() {\r\n    const isLogin = !!localStorage.getItem('Authorization');\r\n\r\n    return {\r\n      isLogin,\r\n      goods: {\r\n        userHasCollect: 0,\r\n        info: {\r\n          gallery: []\r\n        }\r\n      },\r\n      sku: {\r\n        tree: [],\r\n        list: [],\r\n        price: '1.00' // 默认价格（单位元）\r\n      },\r\n      skuGoods: {\r\n        // 商品标题\r\n        title: '',\r\n        // 默认商品 sku 缩略图\r\n        picture: ''\r\n      },\r\n      cartInfo: 0,\r\n      selectSku: {\r\n        selectedNum: 1,\r\n        selectedSkuComb: {\r\n          sku_str: 'aa'\r\n        }\r\n      },\r\n      propsPopup: false,\r\n      showSku: false\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    props_str() {\r\n      let props_arr = [];\r\n      _.each(this.goods.attribute, json => {\r\n        props_arr.push([json['attribute'], json['value']]);\r\n      });\r\n      return props_arr || [];\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.initData();\r\n  },\r\n\r\n  methods: {\r\n    skuClick() {\r\n      this.showSku = true;\r\n    },\r\n    initData() {\r\n      goodsDetail({ id: this.itemId }).then(res => {\r\n        this.goods = res.data.data;\r\n        this.skuAdapter();\r\n      });\r\n\r\n      cartGoodsCount().then(res => {\r\n        this.cartInfo = res.data.data;\r\n      });\r\n    },\r\n    toCart() {\r\n      this.$router.push({\r\n        name: 'cart'\r\n      });\r\n    },\r\n    addCollect() {\r\n      collectAddOrDelete({ valueId: this.itemId, type: 0 }).then(res => {\r\n        if (this.goods.userHasCollect === 1) {\r\n          this.goods.userHasCollect = 0;\r\n        } else {\r\n          this.goods.userHasCollect = 1;\r\n          this.$toast({\r\n            message: '收藏成功',\r\n            duration: 1500\r\n          });\r\n        }\r\n      });\r\n    },\r\n    getProductId(s1, s2) {\r\n      var productId;\r\n      var s1_name;\r\n      var s2_name;\r\n      _.each(this.goods.specificationList, specification => {\r\n        _.each(specification.valueList, specValue => {\r\n          if (specValue.id === s1) {\r\n            s1_name = specValue.value;\r\n          } else if (specValue.id === s2) {\r\n            s2_name = specValue.value;\r\n          }\r\n        });\r\n      });\r\n\r\n      _.each(this.goods.productList, v => {\r\n        let result = _.without(v.specifications, s1_name, s2_name);\r\n        if (result.length === 0) {\r\n          productId = v.id;\r\n        }\r\n      });\r\n      return productId;\r\n    },\r\n    getProductIdByOne(s1) {\r\n      var productId;\r\n      var s1_name;\r\n      _.each(this.goods.specificationList, specification => {\r\n        _.each(specification.valueList, specValue => {\r\n          if (specValue.id === s1) {\r\n            s1_name = specValue.value;\r\n            return;\r\n          }\r\n        });\r\n      });\r\n\r\n      _.each(this.goods.productList, v => {\r\n        let result = _.without(v.specifications, s1_name);\r\n        if (result.length === 0) {\r\n          productId = v.id;\r\n        }\r\n      });\r\n      return productId;\r\n    },\r\n    addCart(data) {\r\n      let that = this;\r\n      let params = {\r\n        goodsId: data.goodsId,\r\n        number: data.selectedNum,\r\n        productId: 0\r\n      };\r\n      if (_.has(data.selectedSkuComb, 's3')) {\r\n        this.$toast({\r\n          message: '目前仅支持两规格',\r\n          duration: 1500\r\n        });\r\n        return;\r\n      } else if (_.has(data.selectedSkuComb, 's2')) {\r\n        params.productId = this.getProductId(\r\n          data.selectedSkuComb.s1,\r\n          data.selectedSkuComb.s2\r\n        );\r\n      } else {\r\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\r\n      }\r\n      cartAdd(params).then(() => {\r\n        this.cartInfo = this.cartInfo + data.selectedNum;\r\n        this.$toast({\r\n          message: '已添加至购物车',\r\n          duration: 1500\r\n        });\r\n        that.showSku = false;\r\n      });\r\n    },\r\n    buyGoods(data) {\r\n      let that = this;\r\n      let params = {\r\n        goodsId: data.goodsId,\r\n        number: data.selectedNum,\r\n        productId: 0\r\n      };\r\n      if (_.has(data.selectedSkuComb, 's3')) {\r\n        this.$toast({\r\n          message: '目前仅支持两规格',\r\n          duration: 1500\r\n        });\r\n        return;\r\n      } else if (_.has(data.selectedSkuComb, 's2')) {\r\n        params.productId = this.getProductId(\r\n          data.selectedSkuComb.s1,\r\n          data.selectedSkuComb.s2\r\n        );\r\n      } else {\r\n        params.productId = this.getProductIdByOne(data.selectedSkuComb.s1);\r\n      }\r\n      cartFastAdd(params).then(res => {\r\n        let cartId = res.data.data;\r\n        setLocalStorage({ CartId: cartId });\r\n        that.showSku = false;\r\n        this.$router.push('/order/checkout');\r\n      });\r\n    },\r\n    skuAdapter() {\r\n      const tree = this.setSkuTree();\r\n      const list = this.setSkuList();\r\n      const skuInfo = {\r\n        price: parseInt(this.goods.info.retailPrice), // 未选择规格时的价格\r\n        stock_num: 0, // TODO 总库存\r\n        collection_id: '', // 无规格商品skuId取collection_id，否则取所选sku组合对应的id\r\n        none_sku: false, // 是否无规格商品\r\n        hide_stock: true\r\n      };\r\n      this.sku = {\r\n        tree,\r\n        list,\r\n        ...skuInfo\r\n      };\r\n      this.skuGoods = {\r\n        title: this.goods.info.name,\r\n        picture: this.goods.info.picUrl\r\n      };\r\n    },\r\n    setSkuList() {\r\n      var sku_list = [];\r\n      _.each(this.goods.productList, v => {\r\n        var sku_list_obj = {};\r\n        _.each(v.specifications, (specificationName, index) => {\r\n          sku_list_obj['s' + (~~index + 1)] = this.findSpecValueIdByName(\r\n            specificationName\r\n          );\r\n        });\r\n\r\n        sku_list_obj.price = v.price * 100;\r\n        sku_list_obj.stock_num = v.number;\r\n        sku_list.push(sku_list_obj);\r\n      });\r\n\r\n      return sku_list;\r\n    },\r\n    findSpecValueIdByName(name) {\r\n      let id = 0;\r\n      _.each(this.goods.specificationList, specification => {\r\n        _.each(specification.valueList, specValue => {\r\n          if (specValue.value === name) {\r\n            id = specValue.id;\r\n            return;\r\n          }\r\n        });\r\n        if (id !== 0) {\r\n          return;\r\n        }\r\n      });\r\n      return id;\r\n    },\r\n    setSkuTree() {\r\n      let that = this;\r\n      let specifications = [];\r\n      _.each(this.goods.specificationList, (v, k) => {\r\n        let values = [];\r\n        _.each(v.valueList, vv => {\r\n          vv.name = vv.value;\r\n          values.push({\r\n            id: vv.id,\r\n            name: vv.value,\r\n            imUrl: vv.picUrl\r\n          });\r\n        });\r\n\r\n        specifications.push({\r\n          k: v.name,\r\n          v: values,\r\n          k_s: 's' + (~~k + 1)\r\n        });\r\n      });\r\n\r\n      return specifications;\r\n    }\r\n  },\r\n\r\n  components: {\r\n    [Popup.name]: Popup,\r\n    [Swipe.name]: Swipe,\r\n    [SwipeItem.name]: SwipeItem,\r\n    [Sku.name]: Sku,\r\n    [GoodsAction.name]: GoodsAction,\r\n    [GoodsActionButton.name]: GoodsActionButton,\r\n    [GoodsActionIcon.name]: GoodsActionIcon,\r\n    [popupProps.name]: popupProps\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.item_detail {\r\n  img {\r\n    max-width: 100%;\r\n  }\r\n}\r\n\r\n.item_cell_group {\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.item_price {\r\n  font-size: 20px;\r\n  color: $red;\r\n  margin-right: 10px;\r\n}\r\n\r\n.item_market_price {\r\n  color: $font-color-gray;\r\n  text-decoration: line-through;\r\n  font-size: $font-size-small;\r\n}\r\n\r\n.item-title {\r\n  line-height: 1.4;\r\n}\r\n\r\n.item_dispatch {\r\n  font-size: $font-size-small;\r\n  color: $font-color-gray;\r\n}\r\n\r\n.item_intro {\r\n  line-height: 18px;\r\n  margin: 5px 0;\r\n  font-size: $font-size-small;\r\n  color: $font-color-gray;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 3;\r\n}\r\n\r\n.item_desc {\r\n  background-color: #fff;\r\n  /deep/ p {\r\n    padding: 0 10px;\r\n    margin-block-start: 0 !important;\r\n    margin-block-end: 0 !important;\r\n  }\r\n  /deep/ img {\r\n    max-width: 100%;\r\n    display: block;\r\n  }\r\n}\r\n\r\n.item_desc_title {\r\n  @include one-border;\r\n  padding: 10px 0;\r\n  text-align: center;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/items/detail"}]}