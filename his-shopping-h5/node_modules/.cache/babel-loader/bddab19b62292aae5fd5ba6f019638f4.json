{"remainingRequest":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js!E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-h5\\src\\views\\order\\payment\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\XM\\his-shopping-h5\\src\\views\\order\\payment\\index.vue","mtime":1606186248941},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"E:/XM/his-shopping-h5/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nrequire(\"vant/es/radio-group/style\");\n\nvar _radioGroup = _interopRequireDefault(require(\"vant/es/radio-group\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"vant/es/radio/style\");\n\nvar _radio = _interopRequireDefault(require(\"vant/es/radio\"));\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"vant/es/dialog/style\");\n\nvar _dialog = _interopRequireDefault(require(\"vant/es/dialog\"));\n\nvar _has2 = _interopRequireDefault(require(\"lodash/has\"));\n\nvar _api = require(\"@/api/api\");\n\nvar _localStorage = require(\"@/utils/local-storage\");\n\nvar _components;\n\nvar _default = {\n  name: 'payment',\n  data: function data() {\n    return {\n      payWay: 'wx',\n      order: {\n        orderInfo: {},\n        orderGoods: []\n      },\n      orderId: 0\n    };\n  },\n  created: function created() {\n    if ((0, _has2.default)(this.$route.params, 'orderId')) {\n      this.orderId = this.$route.params.orderId;\n      this.getOrder(this.orderId);\n    }\n  },\n  methods: {\n    getOrder: function getOrder(orderId) {\n      var _this = this;\n\n      (0, _api.orderDetail)({\n        orderId: orderId\n      }).then(function (res) {\n        _this.order = res.data.data;\n      });\n    },\n    pay: function pay() {\n      var _this2 = this;\n\n      _dialog.default.alert({\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\n      }).then(function () {\n        if (_this2.payWay === 'wx') {\n          var ua = navigator.userAgent.toLowerCase();\n          var isWeixin = ua.indexOf('micromessenger') != -1;\n\n          if (isWeixin) {\n            (0, _api.orderPrepay)({\n              orderId: _this2.orderId\n            }).then(function (res) {\n              var data = res.data.data;\n              var prepay_data = JSON.stringify({\n                appId: data.appId,\n                timeStamp: data.timeStamp,\n                nonceStr: data.nonceStr,\n                package: data.packageValue,\n                signType: 'MD5',\n                paySign: data.paySign\n              });\n              (0, _localStorage.setLocalStorage)({\n                prepay_data: prepay_data\n              });\n\n              if (typeof WeixinJSBridge == 'undefined') {\n                if (document.addEventListener) {\n                  document.addEventListener('WeixinJSBridgeReady', _this2.onBridgeReady, false);\n                } else if (document.attachEvent) {\n                  document.attachEvent('WeixinJSBridgeReady', _this2.onBridgeReady);\n                  document.attachEvent('onWeixinJSBridgeReady', _this2.onBridgeReady);\n                }\n              } else {\n                _this2.onBridgeReady();\n              }\n            }).catch(function (err) {\n              _dialog.default.alert({\n                message: err.data.errmsg\n              });\n\n              that.$router.replace({\n                name: 'paymentStatus',\n                params: {\n                  status: 'failed'\n                }\n              });\n            });\n          } else {\n            (0, _api.orderH5pay)({\n              orderId: _this2.orderId\n            }).then(function (res) {\n              var data = res.data.data;\n              window.location.replace(data.mwebUrl + '&redirect_url=' + encodeURIComponent(window.location.origin + '/#/?orderId=' + _this2.orderId + '&tip=yes'));\n            }).catch(function (err) {\n              _dialog.default.alert({\n                message: err.data.errmsg\n              });\n            });\n          }\n        } else {//todo : alipay\n        }\n      });\n    },\n    onBridgeReady: function onBridgeReady() {\n      var that = this;\n      var data = (0, _localStorage.getLocalStorage)('prepay_data'); // eslint-disable-next-line no-undef\n\n      WeixinJSBridge.invoke('getBrandWCPayRequest', JSON.parse(data.prepay_data), function (res) {\n        if (res.err_msg == 'get_brand_wcpay_request:ok') {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'success'\n            }\n          });\n        } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'cancel'\n            }\n          });\n        } else {\n          that.$router.replace({\n            name: 'paymentStatus',\n            params: {\n              status: 'failed'\n            }\n          });\n        }\n      });\n    }\n  },\n  components: (_components = {}, (0, _defineProperty2.default)(_components, _radio.default.name, _radio.default), (0, _defineProperty2.default)(_components, _radioGroup.default.name, _radioGroup.default), (0, _defineProperty2.default)(_components, _dialog.default.name, _dialog.default), _components)\n};\nexports.default = _default;",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"payment\">\r\n    <div class=\"time_down payment_group\">\r\n      请在\r\n      <span class=\"red\">半小时内</span>\r\n      完成付款，否则系统自动取消订单\r\n    </div>\r\n\r\n    <van-cell-group class=\"payment_group\">\r\n      <van-cell title=\"订单编号\" :value=\"order.orderInfo.orderSn\"/>\r\n      <van-cell title=\"实付金额\">\r\n        <span class=\"red\">{{order.orderInfo.actualPrice *100 | yuan}}</span>\r\n      </van-cell>\r\n    </van-cell-group>\r\n\r\n    <div class=\"pay_way_group\">\r\n      <div class=\"pay_way_title\">选择支付方式</div>\r\n      <van-radio-group v-model=\"payWay\">\r\n        <van-cell-group>\r\n          <van-cell>\r\n            <template slot=\"title\">\r\n              <img src=\"../../../assets/images/ali_pay.png\" alt=\"支付宝\" width=\"82\" height=\"29\">\r\n            </template>\r\n            <van-radio name=\"ali\"/>\r\n          </van-cell>\r\n          <van-cell>\r\n            <template slot=\"title\">\r\n              <img src=\"../../../assets/images/wx_pay.png\" alt=\"微信支付\" width=\"113\" height=\"23\">\r\n            </template>            \r\n            <van-radio name=\"wx\"/>\r\n          </van-cell>\r\n        </van-cell-group>\r\n      </van-radio-group>\r\n    </div>\r\n\r\n    <van-button class=\"pay_submit\" @click=\"pay\" type=\"primary\" bottomAction>去支付</van-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Radio, RadioGroup, Dialog } from 'vant';\r\nimport { orderDetail, orderPrepay, orderH5pay } from '@/api/api';\r\nimport _ from 'lodash';\r\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\r\n\r\nexport default {\r\n  name: 'payment',\r\n\r\n  data() {\r\n    return {\r\n      payWay: 'wx',\r\n      order: {\r\n        orderInfo: {},\r\n        orderGoods: []\r\n      },\r\n      orderId: 0\r\n    };\r\n  },\r\n  created() {\r\n    if (_.has(this.$route.params, 'orderId')) {\r\n      this.orderId = this.$route.params.orderId;\r\n      this.getOrder(this.orderId);\r\n    }\r\n  },\r\n  methods: {\r\n    getOrder(orderId) {\r\n      orderDetail({orderId: orderId}).then(res => {\r\n        this.order = res.data.data;\r\n      });\r\n    },\r\n    pay() {\r\n      \r\n      Dialog.alert({\r\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\r\n      }).then(() => {\r\n        if (this.payWay === 'wx') {\r\n          let ua = navigator.userAgent.toLowerCase();\r\n          let isWeixin = ua.indexOf('micromessenger') != -1;\r\n          if (isWeixin) {\r\n            orderPrepay({ orderId: this.orderId })\r\n              .then(res => {\r\n                let data = res.data.data;\r\n                let prepay_data = JSON.stringify({\r\n                  appId: data.appId,\r\n                  timeStamp: data.timeStamp,\r\n                  nonceStr: data.nonceStr,\r\n                  package: data.packageValue,\r\n                  signType: 'MD5',\r\n                  paySign: data.paySign\r\n                });\r\n                setLocalStorage({ prepay_data: prepay_data });\r\n\r\n                if (typeof WeixinJSBridge == 'undefined') {\r\n                  if (document.addEventListener) {\r\n                    document.addEventListener(\r\n                      'WeixinJSBridgeReady',\r\n                      this.onBridgeReady,\r\n                      false\r\n                    );\r\n                  } else if (document.attachEvent) {\r\n                    document.attachEvent(\r\n                      'WeixinJSBridgeReady',\r\n                      this.onBridgeReady\r\n                    );\r\n                    document.attachEvent(\r\n                      'onWeixinJSBridgeReady',\r\n                      this.onBridgeReady\r\n                    );\r\n                  }\r\n                } else {\r\n                  this.onBridgeReady();\r\n                }\r\n              })\r\n              .catch(err => {\r\n                Dialog.alert({ message: err.data.errmsg });\r\n                that.$router.replace({\r\n                  name: 'paymentStatus',\r\n                  params: {\r\n                    status: 'failed'\r\n                  }\r\n                });\r\n              });\r\n          } else {\r\n            orderH5pay({ orderId: this.orderId })\r\n              .then(res => {\r\n                let data = res.data.data;\r\n                window.location.replace(\r\n                  data.mwebUrl +\r\n                  '&redirect_url=' +\r\n                  encodeURIComponent(\r\n                    window.location.origin +\r\n                    '/#/?orderId=' +\r\n                    this.orderId +\r\n                    '&tip=yes'\r\n                  )\r\n                );\r\n              })\r\n              .catch(err => {\r\n                Dialog.alert({ message: err.data.errmsg });\r\n              });\r\n          }\r\n        } else {\r\n          //todo : alipay\r\n        }\r\n      });\r\n    },\r\n    onBridgeReady() {\r\n      let that = this;\r\n      let data = getLocalStorage('prepay_data');\r\n      // eslint-disable-next-line no-undef\r\n      WeixinJSBridge.invoke(\r\n        'getBrandWCPayRequest',\r\n        JSON.parse(data.prepay_data),\r\n        function(res) {\r\n          if (res.err_msg == 'get_brand_wcpay_request:ok') {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'success'\r\n              }\r\n            });\r\n          } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'cancel'\r\n              }\r\n            });\r\n          } else {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'failed'\r\n              }\r\n            });\r\n          }\r\n        }\r\n      );\r\n    }\r\n  },\r\n\r\n  components: {\r\n    [Radio.name]: Radio,\r\n    [RadioGroup.name]: RadioGroup,\r\n    [Dialog.name]: Dialog\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.payment_group {\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.time_down {\r\n  background-color: #fffeec;\r\n  padding: 10px 15px;\r\n}\r\n\r\n.pay_submit {\r\n  position: fixed;\r\n  bottom: 0;\r\n  width: 100%;\r\n}\r\n\r\n.pay_way_group img {\r\n  vertical-align: middle;\r\n}\r\n\r\n.pay_way_title {\r\n  padding: 15px;\r\n  background-color: #fff;\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/order/payment"}]}