{"remainingRequest":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-h5\\src\\views\\order\\payment\\index.vue?vue&type=style&index=0&id=1dc36c5e&lang=scss&scoped=true&","dependencies":[{"path":"E:\\XM\\his-shopping-h5\\src\\views\\order\\payment\\index.vue","mtime":1606186248941},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.payment_group {\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.time_down {\r\n  background-color: #fffeec;\r\n  padding: 10px 15px;\r\n}\r\n\r\n.pay_submit {\r\n  position: fixed;\r\n  bottom: 0;\r\n  width: 100%;\r\n}\r\n\r\n.pay_way_group img {\r\n  vertical-align: middle;\r\n}\r\n\r\n.pay_way_title {\r\n  padding: 15px;\r\n  background-color: #fff;\r\n}\r\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8LA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/order/payment","sourcesContent":["<template>\r\n  <div class=\"payment\">\r\n    <div class=\"time_down payment_group\">\r\n      请在\r\n      <span class=\"red\">半小时内</span>\r\n      完成付款，否则系统自动取消订单\r\n    </div>\r\n\r\n    <van-cell-group class=\"payment_group\">\r\n      <van-cell title=\"订单编号\" :value=\"order.orderInfo.orderSn\"/>\r\n      <van-cell title=\"实付金额\">\r\n        <span class=\"red\">{{order.orderInfo.actualPrice *100 | yuan}}</span>\r\n      </van-cell>\r\n    </van-cell-group>\r\n\r\n    <div class=\"pay_way_group\">\r\n      <div class=\"pay_way_title\">选择支付方式</div>\r\n      <van-radio-group v-model=\"payWay\">\r\n        <van-cell-group>\r\n          <van-cell>\r\n            <template slot=\"title\">\r\n              <img src=\"../../../assets/images/ali_pay.png\" alt=\"支付宝\" width=\"82\" height=\"29\">\r\n            </template>\r\n            <van-radio name=\"ali\"/>\r\n          </van-cell>\r\n          <van-cell>\r\n            <template slot=\"title\">\r\n              <img src=\"../../../assets/images/wx_pay.png\" alt=\"微信支付\" width=\"113\" height=\"23\">\r\n            </template>            \r\n            <van-radio name=\"wx\"/>\r\n          </van-cell>\r\n        </van-cell-group>\r\n      </van-radio-group>\r\n    </div>\r\n\r\n    <van-button class=\"pay_submit\" @click=\"pay\" type=\"primary\" bottomAction>去支付</van-button>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Radio, RadioGroup, Dialog } from 'vant';\r\nimport { orderDetail, orderPrepay, orderH5pay } from '@/api/api';\r\nimport _ from 'lodash';\r\nimport { getLocalStorage, setLocalStorage } from '@/utils/local-storage';\r\n\r\nexport default {\r\n  name: 'payment',\r\n\r\n  data() {\r\n    return {\r\n      payWay: 'wx',\r\n      order: {\r\n        orderInfo: {},\r\n        orderGoods: []\r\n      },\r\n      orderId: 0\r\n    };\r\n  },\r\n  created() {\r\n    if (_.has(this.$route.params, 'orderId')) {\r\n      this.orderId = this.$route.params.orderId;\r\n      this.getOrder(this.orderId);\r\n    }\r\n  },\r\n  methods: {\r\n    getOrder(orderId) {\r\n      orderDetail({orderId: orderId}).then(res => {\r\n        this.order = res.data.data;\r\n      });\r\n    },\r\n    pay() {\r\n      \r\n      Dialog.alert({\r\n        message: '你选择了' + (this.payWay === 'wx' ? '微信支付' : '支付宝支付')\r\n      }).then(() => {\r\n        if (this.payWay === 'wx') {\r\n          let ua = navigator.userAgent.toLowerCase();\r\n          let isWeixin = ua.indexOf('micromessenger') != -1;\r\n          if (isWeixin) {\r\n            orderPrepay({ orderId: this.orderId })\r\n              .then(res => {\r\n                let data = res.data.data;\r\n                let prepay_data = JSON.stringify({\r\n                  appId: data.appId,\r\n                  timeStamp: data.timeStamp,\r\n                  nonceStr: data.nonceStr,\r\n                  package: data.packageValue,\r\n                  signType: 'MD5',\r\n                  paySign: data.paySign\r\n                });\r\n                setLocalStorage({ prepay_data: prepay_data });\r\n\r\n                if (typeof WeixinJSBridge == 'undefined') {\r\n                  if (document.addEventListener) {\r\n                    document.addEventListener(\r\n                      'WeixinJSBridgeReady',\r\n                      this.onBridgeReady,\r\n                      false\r\n                    );\r\n                  } else if (document.attachEvent) {\r\n                    document.attachEvent(\r\n                      'WeixinJSBridgeReady',\r\n                      this.onBridgeReady\r\n                    );\r\n                    document.attachEvent(\r\n                      'onWeixinJSBridgeReady',\r\n                      this.onBridgeReady\r\n                    );\r\n                  }\r\n                } else {\r\n                  this.onBridgeReady();\r\n                }\r\n              })\r\n              .catch(err => {\r\n                Dialog.alert({ message: err.data.errmsg });\r\n                that.$router.replace({\r\n                  name: 'paymentStatus',\r\n                  params: {\r\n                    status: 'failed'\r\n                  }\r\n                });\r\n              });\r\n          } else {\r\n            orderH5pay({ orderId: this.orderId })\r\n              .then(res => {\r\n                let data = res.data.data;\r\n                window.location.replace(\r\n                  data.mwebUrl +\r\n                  '&redirect_url=' +\r\n                  encodeURIComponent(\r\n                    window.location.origin +\r\n                    '/#/?orderId=' +\r\n                    this.orderId +\r\n                    '&tip=yes'\r\n                  )\r\n                );\r\n              })\r\n              .catch(err => {\r\n                Dialog.alert({ message: err.data.errmsg });\r\n              });\r\n          }\r\n        } else {\r\n          //todo : alipay\r\n        }\r\n      });\r\n    },\r\n    onBridgeReady() {\r\n      let that = this;\r\n      let data = getLocalStorage('prepay_data');\r\n      // eslint-disable-next-line no-undef\r\n      WeixinJSBridge.invoke(\r\n        'getBrandWCPayRequest',\r\n        JSON.parse(data.prepay_data),\r\n        function(res) {\r\n          if (res.err_msg == 'get_brand_wcpay_request:ok') {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'success'\r\n              }\r\n            });\r\n          } else if (res.err_msg == 'get_brand_wcpay_request:cancel') {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'cancel'\r\n              }\r\n            });\r\n          } else {\r\n            that.$router.replace({\r\n              name: 'paymentStatus',\r\n              params: {\r\n                status: 'failed'\r\n              }\r\n            });\r\n          }\r\n        }\r\n      );\r\n    }\r\n  },\r\n\r\n  components: {\r\n    [Radio.name]: Radio,\r\n    [RadioGroup.name]: RadioGroup,\r\n    [Dialog.name]: Dialog\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.payment_group {\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.time_down {\r\n  background-color: #fffeec;\r\n  padding: 10px 15px;\r\n}\r\n\r\n.pay_submit {\r\n  position: fixed;\r\n  bottom: 0;\r\n  width: 100%;\r\n}\r\n\r\n.pay_way_group img {\r\n  vertical-align: middle;\r\n}\r\n\r\n.pay_way_title {\r\n  padding: 15px;\r\n  background-color: #fff;\r\n}\r\n</style>\r\n"]}]}