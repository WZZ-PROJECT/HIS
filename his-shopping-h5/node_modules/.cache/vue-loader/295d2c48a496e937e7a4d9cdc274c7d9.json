{"remainingRequest":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\XM\\his-shopping-h5\\src\\views\\order\\tabbar-cart.vue?vue&type=style&index=0&id=68c1c044&lang=scss&scoped=true&","dependencies":[{"path":"E:\\XM\\his-shopping-h5\\src\\views\\order\\tabbar-cart.vue","mtime":1606186248941},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\XM\\his-shopping-h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n@import '../../assets/scss/mixin';\r\n\r\n.tab-cart {\r\n  padding-bottom: 50px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.editor_head {\r\n  @include one-border;\r\n  text-align: right;\r\n  padding: 10px;\r\n  font-size: $font-size-normal;\r\n  background-color: #fff;\r\n}\r\n\r\n.card-goods {\r\n  background-color: $bg-color;\r\n  .card-goods__item {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 10px;\r\n    background-color: #fff;\r\n  }\r\n  .cart_delete {\r\n    line-height: 100px;\r\n    padding: 0 10px;\r\n    color: #fff;\r\n    background-color: $red;\r\n  }\r\n  .card-goods__footer {\r\n    font-size: $font-size-normal;\r\n    color: $font-color-gray;\r\n  }\r\n}\r\n\r\n.clear_invalid {\r\n  width: 120px;\r\n  color: $font-color-gray;\r\n  border: 1px solid $font-color-gray;\r\n  margin: 0 auto;\r\n  text-align: center;\r\n  padding: 5px 3px;\r\n  margin-top: 20px;\r\n  border-radius: 3px;\r\n}\r\n",{"version":3,"sources":["tabbar-cart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyNA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tabbar-cart.vue","sourceRoot":"src/views/order","sourcesContent":["<template>\r\n  <div class=\"tab-cart\">\r\n    <div class=\"editor_head\" v-show=\"goods.length\">\r\n      <van-icon :name=\"isEditor ? 'success' : 'editor'\"/>\r\n      <span @click=\"isEditor = !isEditor\">{{isEditor ? '完成' : '编辑'}}</span>\r\n    </div>\r\n    <van-checkbox-group @change=\"toggle\" class=\"card-goods\" v-model=\"checkedGoods\">\r\n      <div v-for=\"(item, i) in goods\" :key=\"i\" class=\"card-goods__item\">\r\n        <van-checkbox :key=\"item.id\" :name=\"item.id\" v-model=\"item.checked\"></van-checkbox>\r\n\r\n        <van-card :title=\"item.goodsName\" :price=\"item.price\" :num=\"item.number\" :thumb=\"item.picUrl\">\r\n          <div slot=\"desc\">\r\n            <div class=\"van-card__desc\">\r\n              <van-tag plain style=\"margin-right:6px;\" v-for=\"(spec, index) in item.specifications\" :key=\"index\">\r\n                {{spec}}\r\n              </van-tag>\r\n            </div>\r\n          </div>\r\n          <div slot=\"footer\" v-if=\"isEditor\">\r\n            <van-stepper v-model=\"item.number\" @change=\"stepperEvent(item,arguments)\" disableInput/>\r\n          </div>\r\n          <div slot=\"footer\" v-else>添加日期 {{item.addTime}}</div>\r\n        </van-card>\r\n\r\n        <div class=\"cart_delete\" v-if=\"isEditor\" @click=\"deleteCart(i)\">删除</div>\r\n      </div>\r\n    </van-checkbox-group>\r\n\r\n    <is-empty v-if=\"!goods.length\">您的购物车空空如也~</is-empty>\r\n\r\n    <van-submit-bar\r\n      style=\"bottom: 50px\"\r\n      :price=\"totalPrice\"\r\n      :disabled=\"!checkedGoods.length\"\r\n      :buttonText=\"submitBarText\"\r\n      :loading=\"isSubmit\"\r\n      label=\"总计\"\r\n      @submit=\"cartSubmit\"\r\n    >\r\n      <van-checkbox v-model=\"checkedAll\" @click=\"setCheckAll\" style=\"padding: 0 10px;\">全选</van-checkbox>\r\n    </van-submit-bar>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Checkbox, CheckboxGroup, Card, SubmitBar, Stepper, Tag } from 'vant';\r\nimport { cartList, cartUpdate, cartChecked, cartDelete} from '@/api/api';\r\nimport { setLocalStorage } from '@/utils/local-storage';\r\n\r\nimport isEmpty from '@/components/is-empty/';\r\nimport _ from 'lodash';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      isEditor: false,\r\n      checkedAll: false,\r\n      isSubmit: false,\r\n      checkedGoods: [],\r\n      allGoods: [],\r\n      goods: []\r\n    };\r\n  },\r\n  created() {\r\n    this.init();\r\n  },\r\n  computed: {\r\n    submitBarText() {\r\n      return this.isEditor ? '删除' : '结算';\r\n    },\r\n    totalPrice() {\r\n      return this.goods.reduce(\r\n        (total, item) =>\r\n          total +\r\n          (this.checkedGoods.indexOf(item.id) !== -1\r\n            ? item.price * item.number * 100\r\n            : 0),\r\n        0\r\n      );\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    stepperEvent(item, arg) {\r\n      let number = arg[0];\r\n      cartUpdate({\r\n        number: number,\r\n        goodsId: item.goodsId,\r\n        id: item.id,\r\n        productId: item.productId\r\n      });\r\n    },\r\n    init() {\r\n      cartList().then(res => {\r\n        this.goods = res.data.data.cartList;\r\n        this.allGoods = this.getAllList();\r\n        this.checkedGoods = this.getCheckedList(this.goods);\r\n      });\r\n    },\r\n    getAllList() {\r\n      let result = [];\r\n      _.each(this.goods, v => {\r\n        result.push(v.id);\r\n      });\r\n      return result;\r\n    },\r\n    getCheckedList(goods) {\r\n      let result = [];\r\n      _.each(goods, v => {\r\n        if (v.checked) {\r\n          result.push(v.id);\r\n        }\r\n      });\r\n      return result;\r\n    },\r\n    cartSubmit(data) {\r\n      let productIds = [];\r\n      let checkedGoods = this.checkedGoods;\r\n      _.each(checkedGoods, id => {\r\n        productIds.push(\r\n          _.find(this.goods, vv => {\r\n            return id === vv.id;\r\n          }).productId\r\n        );\r\n      });\r\n      if (this.isEditor) {\r\n        this.$dialog\r\n          .confirm({\r\n            message: '确定删除所选商品吗?',\r\n            cancelButtonText: '再想想'\r\n          })\r\n          .then(() => {\r\n            this.deleteNext(productIds);\r\n          });\r\n      } else {\r\n        this.isSubmit = true;\r\n        setLocalStorage({AddressId: 0, CartId: 0, CouponId: 0});\r\n        this.$router.push('/order/checkout');\r\n      }\r\n    },\r\n    setCheckAll(val) {\r\n      if (this.checkedGoods.length === this.allGoods.length) {\r\n        this.checkedGoods = [];\r\n      } else {\r\n        this.checkedGoods = this.allGoods;\r\n      }\r\n    },\r\n    deleteCart(o) {\r\n      let productId = this.goods[o].productId;\r\n      this.$dialog\r\n        .confirm({ message: '确定删除所选商品吗', cancelButtonText: '再想想' })\r\n        .then(() => {\r\n          this.$nextTick(() => {\r\n            this.deleteNext(productId);\r\n          });\r\n        });\r\n    },\r\n    toggle(index) {\r\n      let addProductIds = [];\r\n      _.each(index, v => {\r\n        let productId = _.find(this.goods, result => {\r\n          return result.id === v;\r\n        }).productId;\r\n        addProductIds.push(productId);\r\n      });\r\n\r\n      let delProductIds = [];\r\n      _.each(_.difference(this.allGoods, index), v => {\r\n        let productId = _.find(this.goods, result => {\r\n          return result.id === v;\r\n        }).productId;\r\n        delProductIds.push(productId);\r\n      });\r\n      if (delProductIds.length > 0) {\r\n        cartChecked({productIds: delProductIds, isChecked: 0});\r\n      }\r\n      if (addProductIds.length > 0) {\r\n        cartChecked({productIds: addProductIds, isChecked: 1});\r\n      }\r\n\r\n      if(index.length === this.allGoods.length){\r\n        this.checkedAll = true\r\n      }\r\n      else{\r\n        this.checkedAll = false\r\n      }\r\n    },\r\n    deleteNext(o) {\r\n      let productIds = [];\r\n      if (o instanceof Array) {\r\n        productIds = o;\r\n      } else {\r\n        productIds.push(o);\r\n      }\r\n\r\n      cartDelete({productIds: productIds}).then(res => {\r\n        this.goods = res.data.data.cartList;\r\n        this.allGoods = this.getAllList();\r\n        this.checkedGoods = this.getCheckedList(this.goods);\r\n      });\r\n    }\r\n  },\r\n\r\n  components: {\r\n    [Card.name]: Card,\r\n    [Tag.name]: Tag,\r\n    [Stepper.name]: Stepper,\r\n    [isEmpty.name]: isEmpty,\r\n    [Checkbox.name]: Checkbox,\r\n    [SubmitBar.name]: SubmitBar,\r\n    [CheckboxGroup.name]: CheckboxGroup\r\n  }\r\n};\r\n</script>\r\n\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '../../assets/scss/mixin';\r\n\r\n.tab-cart {\r\n  padding-bottom: 50px;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.editor_head {\r\n  @include one-border;\r\n  text-align: right;\r\n  padding: 10px;\r\n  font-size: $font-size-normal;\r\n  background-color: #fff;\r\n}\r\n\r\n.card-goods {\r\n  background-color: $bg-color;\r\n  .card-goods__item {\r\n    display: flex;\r\n    align-items: center;\r\n    margin-bottom: 10px;\r\n    background-color: #fff;\r\n  }\r\n  .cart_delete {\r\n    line-height: 100px;\r\n    padding: 0 10px;\r\n    color: #fff;\r\n    background-color: $red;\r\n  }\r\n  .card-goods__footer {\r\n    font-size: $font-size-normal;\r\n    color: $font-color-gray;\r\n  }\r\n}\r\n\r\n.clear_invalid {\r\n  width: 120px;\r\n  color: $font-color-gray;\r\n  border: 1px solid $font-color-gray;\r\n  margin: 0 auto;\r\n  text-align: center;\r\n  padding: 5px 3px;\r\n  margin-top: 20px;\r\n  border-radius: 3px;\r\n}\r\n</style>\r\n"]}]}