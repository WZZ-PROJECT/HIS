{"remainingRequest":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\permission\\role.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\permission\\role.vue","mtime":1601255915657},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1600936436646},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport {create,select,update,uploadFileAli} from '@/api/user'\nimport {parseTime,deepClone} from '@/utils'\nimport {getRulelist} from '@/api/schedule'\nimport {getAllDep} from '@/api/department'\nimport Pagination from '@/components/Pagination'\nimport {policy,uploadResult} from '@/api/upload'\nimport { Promise } from 'q';\nexport default {\n  components: {Pagination},\n  props:['uploadpatient'],\n  name: 'Upload',\n  data(){\n    return{\n\n      img: '',\n\n      alldepart:[],\n      user:{\n        id:'',\n        username:'',\n        name:'',\n        role:'',\n        dept:'',\n        deptname:'',\n        picture:'',\n        title:'',\n        advantages:'',\n        description:'',\n        status:''\n      },\n      total:0,\n      userlist:[],\n      listQuery:{\n        deptId:'',\n        gender:'',\n        username:'',\n        roleId:'',\n        pageSize:10,\n        pageNum:1\n      },\n      imageUrl: '',\n      dialogType:'',\n      dialogVisible:false,\n      rules:{\n        picture:[\n          {required: true, message: '请上传头像',trigger: 'blur'}\n        ],\n        username:[{required: true, message: '请输入用户名称',trigger: 'blur'}],\n        password:[{required: true, message: '请输入密码',trigger: 'blur'}, { min: 4, max: 16, message: '长度在 4 到 16 个字符', trigger: 'blur' }],\n        name:[{required: true, message: '请输入真实姓名',trigger: 'blur'}],\n        role:[{required: true, message: '请选择角色',trigger: 'blur'}],\n        dept:[{required: true, message: '请选择科室',trigger: 'blur'}],\n        advantages:[{required: true, message: '请输入医生擅长',trigger: 'blur'}],\n        title:[{required: true, message: '请输入备注',trigger: 'blur'}],\n        description:[{required: true, message: '请输入医生介绍',trigger: 'blur'}]\n      }\n    }\n  },\n  watch:{\n    'uploadpatient' : function(newVal, oldVal){\n      this.uploadpatient = newVal\n    },\n  },\n  created(){\n    this.select()\n    this.getAlldep()\n    policy().then(res=>{\n      this.dataObj = res.data\n    })\n  },\n  methods:{\n    async getAlldep(){\n      const res = await getAllDep()\n      this.alldepart=res.data\n    },\n    getRuleList (){\n      if(this.depart!==''){\n        this.ruleList = []\n        this.listQuery.deptId=this.depart\n        getRulelist(this.listQuery).then(res=>{\n          this.ruleList=res.data.list\n          this.ruleList.forEach(item=>{\n            item.operateTime = parseTime(item.operateTime)\n          })\n          this.total=res.data.total\n        })\n      }\n    },\n    confirmUser(user){\n        this.$refs[user].validate((valid)=>{\n          if (valid) {\n          if(this.dialogType === 'add'){\n              this.user.deptId = this.user.dept\n              this.user.roleId = this.user.role\n              this.user.registrationRankId = 1\n              this.user.gender = 0\n              create(this.user).then(res=>{\n                this.$notify({\n                  title: '成功',\n                  message: '成功新增用户',\n                  type: 'success',\n                  duration: 2000\n                })\n                this.select()\n              })\n              this.dialogVisible = false\n          }\n          else{\n            this.user.deptId = this.user.dept\n            this.user.roleId = this.user.role\n            update(this.user).then(res=>{\n              this.$notify({\n                title: '成功',\n                message: '修改成功',\n                type: 'success',\n                duration: 2000\n              })\n              this.select()\n            })\n            this.dialogVisible = false\n          }\n          } else {\n            return;\n          }\n       })\n    },\n    select(){\n      select(this.listQuery).then(res=>{\n        this.userlist = res.data.list\n        this.total = res.data.total\n        console.log(this.userlist)\n        this.userlist.forEach(item=>{\n          item.createTime = parseTime(item.createTime)\n        })\n      })\n    },\n    handleAddRole(){\n      this.user.picture = ''\n      this.user.id = ''\n      this.user.name = ''\n      this.user.role = ''\n      this.user.username = ''\n      this.user.dept = ''\n      this.user.title = ''\n      this.user.advantages = ''\n      this.user.description = ''\n      this.dialogType = 'add'\n      this.dialogVisible = true\n    },\n    handleEdit(row){\n      this.dialogType = 'edit'\n      this.user.id = row.id\n      this.user.username = JSON.parse(JSON.stringify(row.username))\n      this.user.name =JSON.parse(JSON.stringify(row.name))\n      this.user.role = row.role.id\n      this.user.dept = row.dept.id\n      this.user.deptname = row.dept.name\n      this.user.picture = row.picture\n      this.user.title = row.title\n      this.user.advantages = row.advantages\n      this.user.description = row.description\n      this.dialogVisible = true\n      console.log(this.user)\n    },\n    handleDelete(row){\n      this.$confirm('确定为 '+row.dept.name+' 的 '+row.name+' 用户吗?', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(()=>{\n        this.user.id = row.id\n        this.user.status = 0\n        update(this.user).then(res=>{\n          this.$notify({\n            title: '成功',\n            message: '删除成功',\n            type: 'success',\n            duration: 2000\n          })\n          this.select()\n        })\n      })\n    },\n    //头像上传\n    uploadFile(headers){\n       uploadFileAli(headers.file,this.toUrl)\n    },\n    //附件上传回调\n    toUrl(file,url){\n      let urls = {uid:file.uid,url:url,name:file.name}\n      this.user.picture = url;\n    },\n    //删除附件\n    handleRemove(file, fileList) {\n      this.form.fileList.forEach((item, idx) => {\n        if(item.uid == file.uid){\n          this.form.fileList.splice(idx, 1);\n        }\n      })\n    },\n    beforeRemove(file, fileList) {\n      return this.$confirm(`确定移除 ${ file.name }？`);\n    }\n  }\n}\n",null]}