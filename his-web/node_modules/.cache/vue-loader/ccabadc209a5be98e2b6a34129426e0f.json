{"remainingRequest":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\admin\\registLevel.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\admin\\registLevel.vue","mtime":1602056307722},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport path from 'path'\nimport { deepClone } from '@/utils'\nimport {getReglist,getAllReg,createReg,deleteReg,updateReg} from '@/api/admin'\nimport Pagination from '@/components/Pagination' // Secondary package based on el-pagination\nimport { Promise } from 'q';\n\nconst defaultDepart = {\n  id:'',\n  code: '',\n  catId: '',\n  name: '',\n  type: ''\n}\n\nexport default {\n  components: {Pagination},\n  data() {\n    return {\n      regList:[],\n      reg:{},\n      dialogVisible: false,\n      dialogType: 'new',\n      checkStrictly: false,\n      defaultProps: {\n        children: 'children',\n        label: 'title'\n      },\n      total: 0,\n      listLoading: true,\n      listQuery: {\n        code: '',\n        name: '',\n        price: '',\n        seqNo: '',\n        status: '',\n        page: 1,\n        limit: 20\n      },\n      reglistref:[],\n      downloadLoading: false,\n      rules:{\n        code:[\n          {required: true, message: '请输入号别编码',trigger: 'blur'}\n        ],\n        name:[\n          {required: true, message: '请输入号别名称',trigger: 'blur'}\n        ],\n        price:[\n          {required: true, message: '请输入挂号费',trigger: 'blur'}\n        ],\n        seqNo:[\n          {required: true, message: '请选择显示顺序号',trigger: 'blur'}\n        ],\n        status:[\n          {required: true, message: '请设置状态',trigger: 'blur'}\n        ]\n      },\n      allReg:[]\n    }\n  },\n  computed: {\n\n  },\n  created() {\n    this.getReglist()\n  },\n  methods: {\n    async getReglist() {\n      this.listLoading = true\n      const response = await getReglist(this.listQuery)\n      this.regList = response.data.list\n      this.total = response.data.total\n      this.listLoading = false\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getReglist()\n    },\n    handleAdd() {\n      this.resetTemp()\n      this.dialogType = 'new'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.$nextTick(() => {\n        this.$refs['reg'].clearValidate()\n      })\n    },\n    handleEdit(row) {\n      this.resetTemp()\n      this.reg = Object.assign({}, row) // copy obj\n      this.dialogType = 'edit'\n      this.dialogVisible = true\n      this.checkStrictly = true\n      this.$nextTick(() => {\n        this.$refs['reg'].clearValidate()\n      })\n    },\n    resetTemp() {\n      this.reg={}\n    },\n    formatJson(filterVal, jsonData) {\n      return jsonData.map(v => filterVal.map(j => {\n        if (j === 'timestamp') {\n          return parseTime(v[j])\n        } else {\n          return v[j]\n        }\n      }))\n    },\n    changedep(val){\n      this.reglistref=val;\n    },\n    handleClick(){\n      this.$notify({\n        title: '暂无数据',\n        message: '未选择删除的数据！',\n        type: 'warning',\n        duration: 2000\n      })\n      return false;\n    },\n    handleSomeDelete(){\n      this.$confirm('确认删除选中号别?', '警告', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(()=>{\n        let delsom =''\n        for(let i=0;i<this.reglistref.length;i++){\n          if(i!==this.reglistref.length-1)\n            delsom=delsom+(this.reglistref[i].id)+','\n          else\n            delsom=delsom+(this.reglistref[i].id)\n        }\n\n        console.log(delsom)\n        if(delsom != null && delsom!= ''){\n          deleteReg(delsom).then(res=>{\n              this.$notify({\n                title: '成功',\n                message: res.message,\n                type: 'success',\n                duration: 2000\n              })\n              this.getReglist()\n            }\n          )\n        }\n\n      })\n    }\n    ,\n    handleDelete(row) {\n      this.$confirm('确认删除当前号别?', '警告', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(()=>{\n        deleteReg(row.id).then(res=>{\n          this.$notify({\n            title: '成功',\n            message: '已删除该号别',\n            type: 'success',\n            duration: 2000\n          })\n          this.getReglist()\n        })\n      })\n    },\n    handleDownload() {\n\n      this.downloadLoading = true\n      import('@/vendor/Export2Excel').then(excel => {\n        const tHeader = ['号别编码', '号别名称', '挂号费', '显示顺序号']\n        const filterVal = ['code', 'name', 'price', 'seqNo']\n        const data = this.formatJson(filterVal, this.allReg)\n        excel.export_json_to_excel({\n          header: tHeader,\n          data,\n          filename: '号别目录'\n        })\n        this.downloadLoading = false\n      })\n    },\n    confirmDep(formName){\n      this.$refs[formName].validate((valid)=>{\n        if(valid){\n          const isEdit = this.dialogType === 'edit'\n          this.listLoading=true\n          if(isEdit){\n            console.log(this.reg)\n            updateReg(this.reg).then(res=>{\n              this.getReglist()\n              this.$notify({\n                title: '成功',\n                message: '已修改该号别',\n                type: 'success',\n                duration: 2000\n              })\n            })\n            this.dialogVisible=false\n          }else{\n            console.log(this.reg)\n            createReg(this.reg).then(res=>{\n              this.getReglist()\n              this.$notify({\n                title: '成功',\n                message: res.message,\n                type: 'success',\n                duration: 2000\n              })\n              this.dialogVisible=false\n            })\n          }\n        }\n      })\n    },\n  }\n}\n",null]}