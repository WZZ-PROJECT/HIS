{"remainingRequest":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\record.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\record.vue","mtime":1602056307738},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {getDmsDislist,parseList} from '@/api/diagnosis'\nimport {submitPriliminaryDise,selectEndCaseHistoryByReg} from '@/api/outpatient/dmscase'\nimport {getAllStaffModel} from '@/api/outpatient/dmscasemodel'\nimport Pagination from '@/components/Pagination'\nimport {selectByType,addfre,delfre} from '@/api/outpatient/frequentuse'\nimport {parseTime,deepClone} from '@/utils'\nimport {saveCasePage,getCasePage} from '@/api/outpatient/save'\nexport default {\n  props:['patient'],\n  name:'Record',\n  components: {Pagination},\n  data(){\n    return{\n      history:[],\n      historyitem:{},\n      pickerOptions: {\n        disabledDate(time) {\n          return time.getTime() > Date.now();\n        },\n        shortcuts: [{\n          text: '今天',\n          onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n        }, {\n          text: '昨天',\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24);\n            picker.$emit('pick', date);\n          }\n        }, {\n          text: '一周前',\n          onClick(picker) {\n            const date = new Date();\n            date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', date);\n          }\n        }]\n      },\n      dialogTableVisible:false,\n      activeName:'first',\n      isclose:false,\n      record:[],\n      medicineDiseIdList:[],//常用诊断\n      priliminaryDise:{\n        chiefComplaint:'',//主述\n        historyOfPresentIllness:'',//现病史\n        historyOfTreatment:'',//现治疗情况\n        pastHistory:'',//既往史\n        allergies:'',//过敏史\n        healthCheckup:'',//体格检查\n        registrationId:'',//\n        priliminaryDiseStrList:'',\n        priliminaryDiseIdList:'',\n        startDate:'',\n        name:'',\n        gender:'',\n        ageStr:''\n      },\n      mainwidth:\"80%\",\n      activeNames: ['1'],\n      data2:[\n        {\n          date: '0001',\n          name: '王小虎1',\n          address: '38岁'\n        },\n        {\n          date: '0002',\n          name: '王小虎2',\n          address: '39岁'\n        }\n      ],\n      total:0,\n      disQuery: {\n        catId: '',\n        code: '',\n        name: '',\n        icd: '',\n        status: '',\n        pageSize: 8,\n        pageNum: 1\n      },\n      models:[],\n      model:{},\n      disList:[]\n    };\n  },\n  created(){\n    this.getmedicineDiseIdList()\n    this.getAllStaffModel()\n  },\n  watch:{\n    'patient' : function(newVal, oldVal){\n      this.patient = newVal\n      this.selectEndCaseHistoryByReg()\n      this.getCasePage()\n    },\n  },\n  methods:{\n    addmodel(val){\n      this.$confirm('是否加载病历模板 '+val.name+' ?', '加载病历模板', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'success'\n      }).then(()=>{\n        this.priliminaryDise = deepClone(val)\n        let diss = ''\n        this.priliminaryDise.priliminaryDiseIdList.forEach(item=>{\n          diss += (item+',')\n        })\n        diss = diss.substr(0,diss.length-1)\n        parseList(diss).then(res=>{\n          this.record = res.data\n        })\n      })\n    },\n    selectmodel(val){\n      this.model = val\n    },\n    getAllStaffModel(){\n      getAllStaffModel(this.$store.getters.id).then(res=>{\n        this.models = res.data.staffList\n        this.models.forEach(item=>{\n          item.dis = ''\n          item.priliminaryDiseStrList.forEach(dis=>{\n            item.dis+=(dis+',')\n          })\n          item.dis = item.dis.substr(0,item.dis.length-1)\n        })\n      })\n    },\n    saveCasePage(){\n      let data  =this.priliminaryDise\n      data.registrationId = this.patient.registrationId\n      saveCasePage(this.priliminaryDise).then(res=>{\n        this.$notify({\n          title: '成功',\n          message: '已暂存病历首页',\n          type: 'success',\n          duration: 2000\n        })\n      })\n    },\n    getCasePage(){\n      getCasePage(this.patient.registrationId).then(res=>{\n        if(res.data!==null){\n          this.priliminaryDise = res.data\n          this.$notify({\n            title: '成功',\n            message: '已加载暂存病历首页',\n            type: 'success',\n            duration: 2000\n          })\n        }\n      })\n    },\n    selecthistory(val){\n      this.historyitem = val\n    },\n    selectEndCaseHistoryByReg(){\n      selectEndCaseHistoryByReg(this.patient.registrationId).then(res=>{\n        this.history = res.data.dmsCaseHistoryList\n        this.history.forEach(item=>{\n          item.createTime = parseTime(item.createTime)\n          item.startDate = parseTime(item.startDate)\n        })\n      })\n    },\n    getmedicineDiseIdList(){\n      selectByType({staffId:this.$store.getters.id,selectType:2}).then(res=>{\n        this.medicineDiseIdList = res.data.medicineDiseList\n      })\n    },\n    submitPriliminaryDise(){\n      this.priliminaryDise.registrationId = this.patient.registrationId\n      this.record.forEach(item=>{\n        this.priliminaryDise.priliminaryDiseStrList+=(item.name+',')\n        this.priliminaryDise.priliminaryDiseIdList+=(item.id+',')\n      })\n      this.priliminaryDise.priliminaryDiseStrList = this.priliminaryDise.priliminaryDiseStrList.substr(0, this.priliminaryDise.priliminaryDiseStrList.length - 1);\n      this.priliminaryDise.priliminaryDiseIdList = this.priliminaryDise.priliminaryDiseIdList.substr(0, this.priliminaryDise.priliminaryDiseIdList.length - 1);\n      this.priliminaryDise.name = this.patient.patientName\n      this.priliminaryDise.gender = this.patient.patientGender\n      this.priliminaryDise.startDate = parseTime(this.priliminaryDise.startDate).substr(0,10)\n      this.priliminaryDise.ageStr = this.patient.patientAge\n      submitPriliminaryDise(this.priliminaryDise).then(res=>{\n        this.$notify({\n          title: '成功',\n          message: '成功提交初诊病历',\n          type: 'success',\n          duration: 2000\n        })\n        this.$emit('priliminary')\n      })\n    },\n    deleteDis(row){\n      this.record=this.record.filter(item=>{\n        if(item.id===row.id)\n          return false\n        return true\n      })\n    },\n    selectDis(val){\n      this.$confirm('是否添加 '+val.name+' 到该患者?', '添加诊断', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'success'\n      }).then(()=>{\n\n        let flag = 1\n        if(flag)\n          this.record.push(val)\n        else\n          alert('已存在该诊断！')\n        this.dialogTableVisible = false\n      })\n    },\n    async getDis(){\n      const res = await getDmsDislist(this.disQuery)\n      this.disList = res.data.list\n      this.total = res.data.total\n    },\n    loadpatient(){\n    },\n    addDis(){\n      this.dialogTableVisible=true\n      this.getDis()\n    },\n    controlfast(){\n      this.isclose=!this.isclose\n      if(this.mainwidth===\"60%\")\n        this.mainwidth=\"80%\"\n      else\n        this.mainwidth=\"60%\"\n    }\n  }\n}\n",null]}