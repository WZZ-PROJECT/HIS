{"remainingRequest":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\historyInspection.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\historyInspection.vue","mtime":1602056307734},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1600936436646},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {getNondrugList} from '@/api/non_drug'\r\nimport {apply,list,invalid,deleteById} from '@/api/outpatient/nondrugapply'\r\nimport {getNondrugModelList} from '@/api/nondrugmodel'\r\nimport {deepClone} from '@/utils'\r\nimport {selectByType} from '@/api/outpatient/frequentuse'\r\nimport {saveNonDrug,getNonDrug} from '@/api/outpatient/save'\r\nimport { Promise, all } from 'q';\r\nexport default {\r\n  props:['patient'],\r\n  name:'Inspection',\r\n  data(){\r\n    return{\r\n      resultvisible:false,\r\n      checkresult:'',\r\n      checkresultimg:[],\r\n      freqlist:[],\r\n      onemodel:{},\r\n      totalprice:0.000,\r\n      ref:[],\r\n      checkmodels:[],\r\n      check:{},\r\n      demandVisible:false,\r\n      dialogTableVisible:false,\r\n      activeName:'first',\r\n      isclose:true,\r\n      checkList:[],\r\n      mainwidth:\"65%\",\r\n      activeNames: ['1'],\r\n      total:0,\r\n      search:'',\r\n      listQuery: {\r\n        code:null,\r\n        name:null,\r\n        format:null,\r\n        price:null,\r\n        expClassId: null,\r\n        deptId: null,\r\n        mnemonicCode:null,\r\n        recordType: 1,\r\n        createDate: null,\r\n        status:1,\r\n        pageSize:1000,\r\n        pageNum:1\r\n      },\r\n      record:[]\r\n    };\r\n  },\r\n   watch:{\r\n    'patient' : function(newVal, oldVal){\r\n      this.patient = newVal\r\n      this.listRecord()\r\n    },\r\n  },\r\n  created(){\r\n    Promise.all([\r\n      this.getNondrugList().then(()=>{\r\n        this.getmodel()\r\n      })\r\n    ])\r\n    this.getfreqList()\r\n  },\r\n\r\n  methods:{\r\n\r\n    saveNonDrug(){\r\n      let data = {}\r\n      data.dmsNonDrugItemRecordParamList = this.ref\r\n      data.registrationId = this.patient.registrationId\r\n      data.type = 0\r\n      saveNonDrug(data).then(res=>{\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '已暂存选中的检查项',\r\n          type: 'success',\r\n          duration: 2000\r\n        })\r\n      })\r\n    },\r\n    getNonDrug(){\r\n      let data = {}\r\n      data.registrationId = this.patient.registrationId\r\n      data.type = 0\r\n      getNonDrug(data).then(res=>{\r\n        res.data.dmsNonDrugItemRecordParamList.forEach(item=>{\r\n          this.selectCheckred(item)\r\n        })\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '已取出暂存的检查项',\r\n          type: 'success',\r\n          duration: 2000\r\n        })\r\n      })\r\n    },\r\n    showresult(row){\r\n      this.checkresult = row.checkResult\r\n      row.resultImgUrlList.split(',').forEach(item=>{\r\n        this.checkresultimg.push(item)\r\n      })\r\n      this.resultvisible = true\r\n    },\r\n    addfreitem(val){\r\n      this.selectCheck(val)\r\n    },\r\n    getfreqList(){\r\n      let data = {}\r\n      data.staffId = this.$store.getters.id\r\n      data.selectType = 1\r\n      selectByType(data).then(res=>{\r\n        this.freqlist = res.data.checkList\r\n      })\r\n    },\r\n    addModel(val){\r\n     /* console.log(val)\r\n      this.$confirm('是否确定将 模板:'+val.name+' 中的内容导入该患者的检查中', '导入模板', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(()=>{\r\n          val.nondruglist.forEach(item=>{\r\n            item.status = -1\r\n            let flag = 1\r\n            this.record.forEach(com=>{\r\n              if(com.id===item.id){\r\n                flag = 0\r\n              }\r\n            })\r\n            if(flag)\r\n              this.record.push(item)\r\n          })\r\n        })*/\r\n      this.model = deepClone(val)\r\n      this.model.amount = Math.floor((this.model.amount+0.5)*100)/100\r\n      this.modelvisivle = true\r\n    },\r\n    selectModel(val){\r\n      this.onemodel = val\r\n    },\r\n    async getmodel(){\r\n      let data = {}\r\n      data.scope = 0\r\n      data.ownId = this.$store.getters.id\r\n      data.type = 0\r\n      data.pageSize =10000\r\n      data.pageNum = 1\r\n      data.isAdmin = 0\r\n      await getNondrugModelList(data).then(res=>{\r\n        this.checkmodels = res.data.list\r\n        this.checkmodels.forEach(onemodel=>{\r\n          onemodel.nondruglist = []\r\n          onemodel.totalprice =0.00\r\n          this.checkList.filter(item=>{\r\n            if(onemodel.nonDrugIdList.includes(item.id)){\r\n              onemodel.nondruglist.push(item)\r\n              onemodel.totalprice += item.price\r\n            }\r\n          })\r\n        })\r\n      })\r\n    },\r\n    refresh(){\r\n      this.$confirm('未开立的项目都将清除,确认刷新?', '刷新', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(()=>{\r\n          this.listRecord()\r\n        })\r\n    },\r\n    deleteTS(){\r\n      this.$confirm('所选项目都将清除,确认刷新?', '刷新', {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(()=>{\r\n        this.listRecord()\r\n      })\r\n    },\r\n    invalid(){\r\n      let data = ''\r\n      this.ref.forEach(item=>{\r\n        data +=(item.id+',')\r\n      })\r\n      data = data.substr(0,data.length-1)\r\n      invalid(data).then(res=>{\r\n        this.$notify({\r\n          title: '成功',\r\n          message: res.message,\r\n          type: 'success',\r\n          duration: 2000\r\n        })\r\n        this.refresh()\r\n      })\r\n      console.log(data)\r\n    },\r\n    async listRecord(){\r\n      list(this.patient.registrationId,0).then(res=>{\r\n        this.record = res.data\r\n        console.log(this.record)\r\n        this.record.forEach(item=>{\r\n          this.checkList.filter(check=>{\r\n            if(check.id===item.noDrugId){\r\n              item.code = check.code\r\n              item.name = check.name\r\n              item.format = check.format\r\n              item.price = check.price\r\n            }\r\n          })\r\n          item.deptName = item.excuteDeptName\r\n        })\r\n      })\r\n    },\r\n    handleSelectionChange(val){\r\n      this.ref = val\r\n      this.totalprice = 0.00\r\n      this.ref.forEach(item=>{\r\n        this.totalprice+=item.price\r\n      })\r\n      this.totalprice = this.totalprice.toFixed(2)\r\n    },\r\n    handleClick(){\r\n      this.$notify({\r\n        title: '暂无数据',\r\n        message: '您开立的项目中包含已开立的项目，请检查后重新提交！',\r\n        type: 'warning',\r\n        duration: 2000\r\n      })\r\n      return false;\r\n    },\r\n    apply(){\r\n      let flags=0\r\n      this.ref.forEach(item=>{\r\n        if(item.status!=-1){\r\n          this.handleClick()\r\n          flags=1;\r\n        }\r\n      })\r\n      if(flags===0){\r\n        let data = {}\r\n        data.dmsNonDrugItemRecordParamList = this.ref\r\n        data.createStaffId = this.$store.getters.id\r\n        data.registrationId = this.patient.registrationId\r\n        data.dmsNonDrugItemRecordParamList.forEach(item=>{\r\n          item.amount = item.price\r\n          item.excuteDeptId = item.deptId\r\n          item.noDrugId = item.id\r\n        })\r\n        data.type = 0\r\n        apply(data).then(res=>{\r\n          this.$notify({\r\n            title: '成功',\r\n            message: res.message,\r\n            type: 'success',\r\n            duration: 2000\r\n          })\r\n          this.listRecord()\r\n        })\r\n      }\r\n    },\r\n    submitDemand(){\r\n      this.record.forEach(item=>{\r\n        if(item.id===this.check.id){\r\n          item.aim = this.check.aim\r\n          item.demand = this.check.demand\r\n          item.clinicalImpression = this.check.clinicalImpression\r\n          item.clinicalDiagnosis = this.check.clinicalDiagnosis\r\n          item.checkParts = this.check.checkParts\r\n        }\r\n      })\r\n      this.demandVisible = false\r\n    },\r\n    demand(row){\r\n      this.demandVisible = true\r\n      this.check = deepClone(row)\r\n    },\r\n    async getNondrugList() {\r\n      const response = await getNondrugList(this.listQuery)\r\n      console.log(response)\r\n      this.checkList = response.data.list\r\n      this.total = response.data.total\r\n    },\r\n    selectCheckred(val){\r\n      console.log(val)\r\n      let flag = 1\r\n      val.status = -1\r\n      this.record.forEach(item=>{\r\n        if(item.id===val.id){\r\n          flag=0\r\n        }\r\n      })\r\n      if(flag)\r\n        this.record.push(val)\r\n      this.dialogTableVisible = false\r\n    },\r\n   /* selectCheck(val){\r\n      this.$confirm('是否添加 '+val.name+' 到该患者?', '添加检查', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          type: 'success'\r\n        }).then(()=>{\r\n        let flag = true\r\n        if(this.record==null){\r\n          this.record=[]\r\n        }\r\n        if(this.record.length==0){\r\n          this.record.push(val)\r\n        }else {\r\n          this.record.forEach(item=>{\r\n            if(item.icd===val.icd){\r\n              flag=false\r\n            }\r\n          })\r\n          if(flag) {\r\n            this.record.push(val)\r\n          }else {\r\n            alert('已存在该诊断！')\r\n          }\r\n        }\r\n        this.dialogTableVisible = false\r\n      })\r\n    },*/\r\n    selectCheck(val){\r\n      console.log(val)\r\n      val.status=0\r\n      this.$confirm('是否添加 '+val.name+' 到该患者?', '添加检查', {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'success'\r\n      }).then(()=>{\r\n        let flag = 1\r\n        val.status = -1\r\n        this.record.forEach(item=>{\r\n          if(item.id===val.id){\r\n            flag=0\r\n          }\r\n        })\r\n        if(flag)\r\n          this.record.push(val)\r\n        else\r\n          alert('已存在该检验项目！')\r\n        this.dialogTableVisible = false\r\n      })\r\n    },\r\n    addcheck(){\r\n      this.dialogTableVisible = true\r\n    },\r\n    delcheck(){\r\n      let data = ''\r\n      this.ref.forEach(item=>{\r\n        data +=(item.id+',')\r\n      })\r\n      data = data.substr(0,data.length-1)\r\n      deleteById(data).then(res=>{\r\n        this.$notify({\r\n          title: '成功',\r\n          message: res.message,\r\n          type: 'success',\r\n          duration: 2000\r\n        })\r\n        this.deleteTS()\r\n      })\r\n      console.log(data)\r\n    },\r\n    controlfast(){\r\n      this.isclose=!this.isclose\r\n      if(this.mainwidth===\"65%\")\r\n        this.mainwidth=\"80%\"\r\n      else\r\n        this.mainwidth=\"65%\"\r\n    }\r\n  }\r\n}\r\n",null]}