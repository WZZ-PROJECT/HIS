{"remainingRequest":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IdeaProjects\\HIS\\HIS-web\\src\\views\\admin\\non_drug.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\src\\views\\admin\\non_drug.vue","mtime":1596785876390},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport path from 'path'\r\nimport { deepClone,parseTime } from '@/utils'\r\nimport {getNondrugList,getAllNondrug,updateNondrug,createNondrug,deleteNondrug} from '@/api/non_drug'\r\nimport {getAllDep} from '@/api/department'\r\nimport Pagination from '@/components/Pagination' // Secondary package based on el-pagination\r\nimport { Promise } from 'q';\r\n\r\nconst defaultNondrug = {\r\n  code:'',\r\n  name:'',\r\n  format:'',\r\n  price:'',\r\n  expClassId: '',\r\n  deptId: '',\r\n  mnemonicCode:'',\r\n  recordType: '',\r\n  createDate: '',\r\n}\r\n\r\nexport default {\r\n  components: {Pagination},\r\n  data() {\r\n    return {\r\n      nondrug: Object.assign({},defaultNondrug),\r\n      nondrugList: [],\r\n      Alldept:[],\r\n      dialogVisible: false,\r\n      dialogType: 'new',\r\n      checkStrictly: false,\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'title'\r\n      },\r\n      deptype:[1,2,3,4],\r\n      total: 0,\r\n      listLoading: true,\r\n      allCatId:[],\r\n      allNondrug:[],\r\n      allType:[],\r\n      listQuery: {\r\n        code:null,\r\n        name:null,\r\n        format:null,\r\n        price:null,\r\n        expClassId: null,\r\n        deptId: null,\r\n        mnemonicCode:null,\r\n        recordType: null,\r\n        createDate: null,\r\n        status:1,\r\n        pageSize:20,\r\n        pageNum:1\r\n      },\r\n      downloadLoading: false,\r\n      rules:{\r\n        code:[\r\n          {required: true, message: '请输入项目编码',trigger: 'blur'}\r\n        ],\r\n        name:[\r\n          {required: true, message: '请输入项目名称',trigger: 'blur'}\r\n        ],\r\n        format:[\r\n          {required: true, message: '请输入规格',trigger: 'blur'}\r\n        ],\r\n        price:[\r\n          {required: true, message: '请输入价格',trigger: 'blur'}\r\n        ],\r\n        expClassId:[\r\n          {required:true , message:'请输入费用所属科目',trigger:'blur'}\r\n        ],\r\n        recordType:[\r\n          {required:true,message:'请选择项目类型',trigger:'blur'}\r\n        ]\r\n      },\r\n      deplistref:[]\r\n    }\r\n  },\r\n  computed: {\r\n\r\n  },\r\n  created() {\r\n    // Mock: get all routes and roles list from server\r\n    Promise.all([\r\n    this.getAllNondrug(),\r\n    this.getNondrugList()\r\n    ])\r\n    this.getAllDep()\r\n  },\r\n  methods: {\r\n    getAllDep(){\r\n      getAllDep().then(res=>{\r\n        this.Alldept=res.data\r\n      })\r\n    },\r\n    async getAllNondrug(){    \r\n      const response = await getAllNondrug()\r\n      this.allNondrug = response.data\r\n      console.log(this.allNondrug)\r\n    },\r\n    async getNondrugList() {\r\n      this.listLoading = true\r\n      const response = await getNondrugList(this.listQuery)\r\n      this.nondrugList = response.data.list\r\n      this.nondrugList.forEach(item=>{\r\n        item.createDate = item.createDate.substr(0,10)\r\n      })\r\n      this.total = response.data.total\r\n      this.listLoading = false\r\n    },\r\n    handleFilter() {\r\n      this.listQuery.page = 1\r\n      this.getNondrugList()\r\n    },\r\n    handleAdd() {\r\n      this.resetTemp()\r\n      this.dialogType = 'new'\r\n      this.dialogVisible = true\r\n      this.checkStrictly = true\r\n      this.$nextTick(() => {\r\n        this.$refs['depart'].clearValidate()\r\n      })\r\n    },\r\n    handleEdit(row) {\r\n      this.resetTemp()\r\n      this.nondrug = Object.assign({}, row) // copy obj\r\n      this.dialogType = 'edit'\r\n      this.dialogVisible = true\r\n      this.checkStrictly = true\r\n      this.$nextTick(() => {\r\n        this.$refs['depart'].clearValidate()\r\n      })\r\n    },\r\n    resetTemp() {\r\n      this.nondrug = Object.assign({},defaultNondrug)\r\n    },\r\n    formatJson(filterVal, jsonData) {\r\n      return jsonData.map(v => filterVal.map(j => {\r\n        if (j === 'timestamp') {\r\n          return parseTime(v[j])\r\n        } else {\r\n          return v[j]\r\n        }\r\n      }))\r\n    },\r\n    changedep(val){\r\n      this.deplistref=val;\r\n    },\r\n    handleSomeDelete(){\r\n      this.$confirm('确认删除选中项目?', '警告', {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(()=>{\r\n      let delsom =''\r\n      for(let i=0;i<this.deplistref.length;i++){\r\n        if(i!==this.deplistref.length-1)\r\n          delsom=delsom+(this.deplistref[i].id)+','\r\n        else\r\n          delsom=delsom+(this.deplistref[i].id)\r\n      }\r\n      console.log(delsom)\r\n      deleteNondrug(delsom).then(res=>{\r\n      this.$notify({\r\n        title: '成功',\r\n        message: res.message,\r\n        type: 'success',\r\n        duration: 2000\r\n      })\r\n        this.getNondrugList()\r\n      }\r\n      )\r\n      })\r\n    }\r\n    ,\r\n    handleDelete(row) {\r\n      this.$confirm('确认删除当前项目?', '警告', {\r\n        confirmButtonText: '确认',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(()=>{\r\n      deleteNondrug(row.id).then(res=>{\r\n        this.$notify({\r\n        title: '成功',\r\n        message: res.message,\r\n        type: 'success',\r\n        duration: 2000\r\n      })\r\n      this.getNondrugList()\r\n      })\r\n      })\r\n    },\r\n    handleDownload() {\r\n      this.downloadLoading = true\r\n      import('@/vendor/Export2Excel').then(excel => {\r\n        const tHeader = ['项目编码', '项目名称']\r\n        const filterVal = ['code', 'name']\r\n        const data = this.formatJson(filterVal, this.allNondrug)\r\n        excel.export_json_to_excel({\r\n          header: tHeader,\r\n          data,\r\n          filename: '项目目录'\r\n        })\r\n        this.downloadLoading = false\r\n      })\r\n    },\r\n    async confirmDep(formName){\r\n      this.$refs[formName].validate((valid)=>{\r\n        if(valid){\r\n          const isEdit = this.dialogType === 'edit'\r\n          this.listLoading=true\r\n          if(isEdit){\r\n            updateNondrug(this.nondrug).then(res=>{\r\n                this.getNondrugList()\r\n                this.$notify({\r\n                title: '成功',\r\n                message: '已修改该项目',\r\n                type: 'success',\r\n                duration: 2000\r\n              })\r\n            })\r\n            this.dialogVisible=false\r\n          }else{\r\n            this.nondrug.expClassId = 1\r\n            this.nondrug.status = 1\r\n            createNondrug(this.nondrug).then(res=>{\r\n              this.getNondrugList()\r\n              this.$notify({\r\n              title: '成功',\r\n              message: res.message,\r\n              type: 'success',\r\n              duration: 2000\r\n            })\r\n            this.dialogVisible=false\r\n            })\r\n          }\r\n        }\r\n      })\r\n    },\r\n  }\r\n}\r\n",null]}