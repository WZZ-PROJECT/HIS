{"remainingRequest":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\IdeaProjects\\HIS\\HIS-web\\src\\views\\outpatient\\workstation\\record.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\src\\views\\outpatient\\workstation\\record.vue","mtime":1596785876403},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\IdeaProjects\\HIS\\HIS-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n  \r\nimport {getDmsDislist,parseList} from '@/api/diagnosis'\r\nimport {submitPriliminaryDise,selectEndCaseHistoryByReg} from '@/api/outpatient/dmscase'\r\nimport {getAllStaffModel} from '@/api/outpatient/dmscasemodel'\r\nimport Pagination from '@/components/Pagination'\r\nimport {selectByType,addfre,delfre} from '@/api/outpatient/frequentuse'\r\nimport {parseTime,deepClone} from '@/utils'\r\nimport {saveCasePage,getCasePage} from '@/api/outpatient/save'\r\nexport default {\r\n  props:['patient'],\r\n  name:'Record',\r\n  components: {Pagination},\r\n  data(){\r\n    return{\r\n      history:[],\r\n      historyitem:{},\r\n      pickerOptions: {\r\n          disabledDate(time) {\r\n            return time.getTime() > Date.now();\r\n          },\r\n          shortcuts: [{\r\n            text: '今天',\r\n            onClick(picker) {\r\n              picker.$emit('pick', new Date());\r\n            }\r\n          }, {\r\n            text: '昨天',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() - 3600 * 1000 * 24);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }, {\r\n            text: '一周前',\r\n            onClick(picker) {\r\n              const date = new Date();\r\n              date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);\r\n              picker.$emit('pick', date);\r\n            }\r\n          }]\r\n        },\r\n      dialogTableVisible:false,\r\n      activeName:'first',\r\n      isclose:false,\r\n      record:[],\r\n      medicineDiseIdList:[],//常用诊断\r\n      priliminaryDise:{\r\n        chiefComplaint:'',//主述\r\n        historyOfPresentIllness:'',//现病史\r\n        historyOfTreatment:'',//现治疗情况\r\n        pastHistory:'',//既往史\r\n        allergies:'',//过敏史\r\n        healthCheckup:'',//体格检查\r\n        registrationId:'',//\r\n        priliminaryDiseStrList:'',\r\n        priliminaryDiseIdList:'',\r\n        startDate:'',\r\n        name:'',\r\n        gender:'',\r\n        ageStr:''\r\n      },\r\n      mainwidth:\"80%\",\r\n      activeNames: ['1'],\r\n      data2:[\r\n        {\r\n          date: '0001',\r\n          name: '王小虎1',\r\n          address: '38岁'\r\n        },\r\n        {\r\n          date: '0002',\r\n          name: '王小虎2',\r\n          address: '39岁'\r\n        }\r\n      ],\r\n      total:0,\r\n      disQuery: {\r\n        catId: '',\r\n        code: '',\r\n        name: '',\r\n        icd: '',\r\n        status: '',\r\n        pageSize: 8,\r\n        pageNum: 1\r\n      },\r\n      models:[],\r\n      model:{},\r\n      disList:[]\r\n    };\r\n  },\r\n  created(){\r\n    this.getmedicineDiseIdList()\r\n    this.getAllStaffModel()\r\n  },\r\n  watch:{\r\n    'patient' : function(newVal, oldVal){\r\n      this.patient = newVal\r\n      this.selectEndCaseHistoryByReg()\r\n      this.getCasePage()\r\n    },\r\n  },\r\n  methods:{\r\n    addmodel(val){\r\n      this.$confirm('是否加载病历模板 '+val.name+' ?', '加载病历模板', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          type: 'success'\r\n        }).then(()=>{\r\n          this.priliminaryDise = deepClone(val)\r\n          let diss = ''\r\n          this.priliminaryDise.priliminaryDiseIdList.forEach(item=>{\r\n            diss += (item+',')\r\n          })\r\n          diss = diss.substr(0,diss.length-1)\r\n          parseList(diss).then(res=>{\r\n            this.record = res.data\r\n          })\r\n        })\r\n    },\r\n    selectmodel(val){\r\n      this.model = val\r\n    },\r\n    getAllStaffModel(){\r\n      getAllStaffModel(this.$store.getters.id).then(res=>{\r\n        this.models = res.data.staffList\r\n        this.models.forEach(item=>{\r\n          item.dis = ''\r\n          item.priliminaryDiseStrList.forEach(dis=>{\r\n            item.dis+=(dis+',')\r\n          })\r\n          item.dis = item.dis.substr(0,item.dis.length-1)\r\n        })\r\n      })\r\n    },\r\n    saveCasePage(){\r\n      let data  =this.priliminaryDise\r\n      data.registrationId = this.patient.registrationId\r\n      saveCasePage(this.priliminaryDise).then(res=>{\r\n        this.$notify({\r\n          title: '成功',\r\n          message: '已暂存病历首页',\r\n          type: 'success',\r\n          duration: 2000\r\n        })\r\n      })\r\n    },\r\n    getCasePage(){\r\n      getCasePage(this.patient.registrationId).then(res=>{\r\n        if(res.data!==null){\r\n          this.priliminaryDise = res.data\r\n          this.$notify({\r\n            title: '成功',\r\n            message: '已加载暂存病历首页',\r\n            type: 'success',\r\n            duration: 2000\r\n          })\r\n        }\r\n      })\r\n    },\r\n    selecthistory(val){\r\n      this.historyitem = val\r\n    },\r\n    selectEndCaseHistoryByReg(){\r\n      selectEndCaseHistoryByReg(this.patient.registrationId).then(res=>{\r\n        this.history = res.data.dmsCaseHistoryList\r\n        this.history.forEach(item=>{\r\n          item.createTime = parseTime(item.createTime)\r\n          item.startDate = parseTime(item.startDate)\r\n        })\r\n      })\r\n    },\r\n    getmedicineDiseIdList(){\r\n      selectByType({staffId:this.$store.getters.id,selectType:2}).then(res=>{\r\n        this.medicineDiseIdList = res.data.medicineDiseList\r\n      })\r\n    },\r\n    submitPriliminaryDise(){\r\n      this.priliminaryDise.registrationId = this.patient.registrationId\r\n      this.record.forEach(item=>{\r\n        this.priliminaryDise.priliminaryDiseStrList+=(item.name+',')\r\n        this.priliminaryDise.priliminaryDiseIdList+=(item.id+',')\r\n      })\r\n      this.priliminaryDise.priliminaryDiseStrList = this.priliminaryDise.priliminaryDiseStrList.substr(0, this.priliminaryDise.priliminaryDiseStrList.length - 1);\r\n      this.priliminaryDise.priliminaryDiseIdList = this.priliminaryDise.priliminaryDiseIdList.substr(0, this.priliminaryDise.priliminaryDiseIdList.length - 1);\r\n      this.priliminaryDise.name = this.patient.patientName\r\n      this.priliminaryDise.gender = this.patient.patientGender\r\n      this.priliminaryDise.startDate = parseTime(this.priliminaryDise.startDate).substr(0,10)\r\n      this.priliminaryDise.ageStr = this.patient.patientAge\r\n      submitPriliminaryDise(this.priliminaryDise).then(res=>{\r\n          this.$notify({\r\n            title: '成功',\r\n            message: '成功提交初诊病历',\r\n            type: 'success',\r\n            duration: 2000\r\n          })\r\n          this.$emit('priliminary')\r\n        })\r\n    },\r\n    deleteDis(row){\r\n      this.record=this.record.filter(item=>{\r\n        if(item.id===row.id)\r\n          return false\r\n        return true\r\n      })\r\n    },\r\n    selectDis(val){\r\n      this.$confirm('是否添加 '+val.name+' 到该患者?', '添加诊断', {\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消',\r\n          type: 'success'\r\n        }).then(()=>{\r\n          let flag = 1\r\n          this.record.forEach(item=>{\r\n            if(item.icd===val.icd){\r\n              flag=0\r\n            }\r\n          })\r\n          if(flag)\r\n            this.record.push(val)\r\n          else\r\n            alert('已存在该诊断！')\r\n          this.dialogTableVisible = false\r\n        })\r\n    },\r\n    async getDis(){\r\n      const res = await getDmsDislist(this.disQuery)\r\n      this.disList = res.data.list\r\n      this.total = res.data.total\r\n    },\r\n    loadpatient(){\r\n    },\r\n    addDis(){\r\n      this.dialogTableVisible=true\r\n      this.getDis()\r\n    },\r\n    controlfast(){\r\n      this.isclose=!this.isclose\r\n      if(this.mainwidth===\"60%\")\r\n        this.mainwidth=\"80%\"\r\n      else\r\n        this.mainwidth=\"60%\"\r\n    }\r\n  }\r\n}\r\n",null]}