{"remainingRequest":"F:\\XM\\his-web\\node_modules\\thread-loader\\dist\\cjs.js!F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js!F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\admin\\schedule.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\admin\\schedule.vue","mtime":1602343595391},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1600936436646},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["import \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"F:/XM/his-web/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getAllDep, getDeplist as _getDeplist } from '@/api/department';\nimport { getRulelist, generateSkd as _generateSkd, createRule as _createRule, getRuleDetail as _getRuleDetail, updateRule as _updateRule, deleteRule } from '@/api/schedule';\nimport { getUserList } from '@/api/user';\nimport Pagination from '@/components/Pagination';\nimport { getAllReg } from '@/api/admin';\nimport { parseTime, formatTime } from '@/utils';\nexport default {\n  components: {\n    Pagination: Pagination\n  },\n  data: function data() {\n    return {\n      editbutton: false,\n      rulelistid: '',\n      rulecurrent: [],\n      addRule: {},\n      ruleid: '',\n      pickerOptions: {\n        disabledDate: function disabledDate(time) {\n          return time.getTime() <= Date.now() - 3600 * 1000 * 24;\n        },\n        shortcuts: [{\n          text: '今天',\n          onClick: function onClick(picker) {\n            picker.$emit('pick', new Date());\n          }\n        }, {\n          text: '一周后',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', date);\n          }\n        }, {\n          text: '一月后',\n          onClick: function onClick(picker) {\n            var date = new Date();\n            date.setTime(date.getTime() + 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', date);\n          }\n        }]\n      },\n      value1: '',\n      value2: '',\n      allreg: [],\n      dialogVisible: false,\n      listLoading: true,\n      total: 0,\n      depart: '',\n      alldepart: [],\n      listQuery: {\n        deptId: '',\n        pageSize: 10,\n        pageNum: 1\n      },\n      ruleList: [],\n      showdetail: false,\n      schedule: 0,\n      scheduleList: [],\n      rulelistref: []\n    };\n  },\n  created: function created() {\n    this.getAlldep();\n    this.getAllreg();\n    this.getDeplist();\n  },\n  methods: {\n    getDepDoctor: function getDepDoctor() {\n      var _this = this;\n\n      var data = {};\n      this.scheduleList = [];\n      data.deptId = this.addRule.deptId;\n      getUserList(data).then(function (res) {\n        res.data.list.forEach(function (item) {\n          var temp = {};\n          temp.staffName = item.name;\n          temp.id = item.id;\n\n          _this.scheduleList.push(temp);\n        });\n      });\n    },\n    updateRule: function updateRule() {\n      var _this2 = this;\n\n      if (this.addRule.deptId === null || this.addRule.deptId === undefined) {\n        this.$notify({\n          title: '提示',\n          message: \"保存排班规则前请选择对应科室！\",\n          type: 'warning',\n          duration: 2000\n        });\n        return;\n      }\n\n      if (this.rulecurrent.length === 0) {\n        this.$notify({\n          title: '提示',\n          message: \"请选择医生！\",\n          type: 'warning',\n          duration: 2000\n        });\n        return;\n      }\n\n      this.rulecurrent.forEach(function (element) {\n        var daysOfWeek = '';\n\n        if (element.checked1) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked2) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked3) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked4) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked5) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked6) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked7) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked8) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked9) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked10) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked11) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked12) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked13) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked14) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        element.daysOfWeek = daysOfWeek;\n        element.status = 1;\n        element.staffId = element.staffId;\n        element.skLimit = element.limit;\n      });\n      var data = {};\n      data.smsSkdRuleItemParamList = this.rulecurrent;\n      data.deptId = this.addRule.deptId;\n      data.description = this.addRule.description;\n      data.operatorId = this.$store.getters.id;\n      data.status = 1;\n      data.ruleName = this.addRule.ruleName;\n      data.ruleid = this.rulelistid;\n\n      _updateRule(data).then(function (res) {\n        _this2.showdetail = false;\n\n        _this2.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n\n        _this2.getRuleList();\n      });\n    },\n    getRuleDetail: function () {\n      var _getRuleDetail2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(id) {\n        var res, i;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this.rulelistid = id;\n                _context.next = 3;\n                return _getRuleDetail(id);\n\n              case 3:\n                res = _context.sent;\n                this.addRule = res.data;\n                this.scheduleList = res.data.smsSkdRuleItemResultList;\n                i = 0;\n                this.scheduleList.forEach(function (item) {\n                  item.limit = item.skLimit;\n\n                  if (item.daysOfWeek.charAt(0) === '1') {\n                    item.checked1 = true;\n                  } else {\n                    item.checked1 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(1) === '1') {\n                    item.checked2 = true;\n                  } else {\n                    item.checked2 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(2) === '1') {\n                    item.checked3 = true;\n                  } else {\n                    item.checked3 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(3) === '1') {\n                    item.checked4 = true;\n                  } else {\n                    item.checked4 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(4) === '1') {\n                    item.checked5 = true;\n                  } else {\n                    item.checked5 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(5) === '1') {\n                    item.checked6 = true;\n                  } else {\n                    item.checked6 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(6) === '1') {\n                    item.checked7 = true;\n                  } else {\n                    item.checked7 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(7) === '1') {\n                    item.checked8 = true;\n                  } else {\n                    item.checked8 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(8) === '1') {\n                    item.checked9 = true;\n                  } else {\n                    item.checked9 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(9) === '1') {\n                    item.checked10 = true;\n                  } else {\n                    item.checked10 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(10) === '1') {\n                    item.checked11 = true;\n                  } else {\n                    item.checked11 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(11) === '1') {\n                    item.checked12 = true;\n                  } else {\n                    item.checked12 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(12) === '1') {\n                    item.checked13 = true;\n                  } else {\n                    item.checked13 = false;\n                  }\n\n                  if (item.daysOfWeek.charAt(13) === '1') {\n                    item.checked14 = true;\n                  } else {\n                    item.checked14 = false;\n                  }\n                });\n                this.getRuleList();\n                this.showdetail = true;\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getRuleDetail(_x) {\n        return _getRuleDetail2.apply(this, arguments);\n      }\n\n      return getRuleDetail;\n    }(),\n    createRule: function createRule() {\n      var _this3 = this;\n\n      if (this.addRule.deptId === null || this.addRule.deptId === undefined) {\n        this.$notify({\n          title: '提示',\n          message: \"保存排班规则前请选择对应科室！\",\n          type: 'warning',\n          duration: 2000\n        });\n        return;\n      }\n\n      if (this.rulecurrent.length === 0) {\n        this.$notify({\n          title: '提示',\n          message: \"请选择医生！\",\n          type: 'warning',\n          duration: 2000\n        });\n        return;\n      }\n      /*\r\n       console.log(this.rulecurrent.limit)\r\n       if(this.rulecurrent.limit===undefined){\r\n         this.$notify({\r\n           title: '提示',\r\n           message: \"请输入排班限额！\",\r\n           type: 'warning',\r\n           duration: 2000\r\n         })\r\n         return;\r\n       }*/\n\n\n      this.rulecurrent.forEach(function (element) {\n        var daysOfWeek = '';\n\n        if (element.checked1) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked2) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked3) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked4) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked5) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked6) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked7) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked8) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked9) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked10) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked11) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked12) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked13) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        if (element.checked14) {\n          daysOfWeek += '1';\n        } else {\n          daysOfWeek += '0';\n        }\n\n        element.daysOfWeek = daysOfWeek;\n        element.status = 1;\n        element.staffId = element.id;\n        element.skLimit = element.limit;\n      });\n      var data = {};\n      data.smsSkdRuleItemParamList = this.rulecurrent;\n      data.deptId = this.addRule.deptId;\n      data.description = this.addRule.description;\n      data.operatorId = this.$store.getters.id;\n      data.status = 1;\n      data.ruleName = this.addRule.ruleName;\n\n      _createRule(data).then(function (res) {\n        _this3.getRuleList();\n\n        _this3.showdetail = false;\n\n        _this3.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n      });\n    },\n    selectrule: function selectrule(val) {\n      this.rulecurrent = val;\n    },\n    getAllreg: function () {\n      var _getAllreg = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return getAllReg();\n\n              case 2:\n                res = _context2.sent;\n                this.allreg = res.data;\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getAllreg() {\n        return _getAllreg.apply(this, arguments);\n      }\n\n      return getAllreg;\n    }(),\n    generateSkd: function generateSkd() {\n      var _this4 = this;\n\n      var data = {};\n      data.ruleIds = this.ruleid;\n      data.startDate = parseTime(this.value1).substr(0, 10);\n      data.endDate = parseTime(this.value2).substr(0, 10);\n\n      _generateSkd(data).then(function (res) {\n        _this4.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n      });\n\n      this.dialogVisible = false;\n    },\n    changerule: function changerule(val) {\n      this.rulelistref = val;\n    },\n    delrule: function delrule() {\n      var _this5 = this;\n\n      if (this.rulelistref.length === 0) alert('请先选中要删除的规则');\n      this.$confirm('确认删除选中的排班规则?', '警告', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        var data = '';\n\n        _this5.rulelistref.forEach(function (item) {\n          data += item.id + ',';\n        });\n\n        data = data.substr(0, data.length - 1);\n        deleteRule(data).then(function (res) {\n          _this5.$notify({\n            title: '成功',\n            message: res.message,\n            type: 'success',\n            duration: 2000\n          });\n\n          _this5.getRuleList();\n        });\n      });\n    },\n    confirmdate: function confirmdate() {\n      console.log(this.value2);\n    },\n    getAlldep: function () {\n      var _getAlldep = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return getAllDep();\n\n              case 2:\n                res = _context3.sent;\n                this.alldepart = res.data;\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getAlldep() {\n        return _getAlldep.apply(this, arguments);\n      }\n\n      return getAlldep;\n    }(),\n    getDeplist: function () {\n      var _getDeplist2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var response;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                this.listLoading = true;\n                _context4.next = 3;\n                return _getDeplist(this.listQuery);\n\n              case 3:\n                response = _context4.sent;\n                this.depList = response.data.list;\n                this.total = response.data.total;\n                this.listLoading = false;\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getDeplist() {\n        return _getDeplist2.apply(this, arguments);\n      }\n\n      return getDeplist;\n    }(),\n    getRuleList: function getRuleList() {\n      var _this6 = this;\n\n      if (this.depart !== '') {\n        this.ruleList = [];\n        debugger;\n        this.listQuery.deptId = this.depart;\n        getRulelist(this.listQuery).then(function (res) {\n          if (res.data === undefined || res.data === null) {\n            _this6.ruleList = [];\n            return;\n          }\n\n          _this6.ruleList = res.data.list;\n\n          _this6.ruleList.forEach(function (item) {\n            item.operateTime = parseTime(item.operateTime);\n          });\n\n          _this6.total = res.data.total;\n        });\n      }\n    },\n    jumpadd: function jumpadd() {\n      this.showdetail = !this.showdetail;\n      this.addRule = {};\n      /*this.getDepDoctor()*/\n    },\n    showRow: function showRow(row) {\n      //赋值给radio\n      this.radio = this.tableData.indexOf(row);\n    },\n    handleCurrentChange: function handleCurrentChange(val, index) {\n      this.currentRow = val;\n      this.$emit('data', val.pkg);\n    },\n    getCurrentRow: function getCurrentRow(val) {\n      console.log(val);\n    },\n    choose: function choose() {\n      this.schedule = !this.schedule;\n    },\n    jumpback: function jumpback() {\n      this.showdetail = !this.showdetail;\n    },\n    empty: function empty() {\n      this.addRule = {};\n      this.ruleList = [];\n      this.rulecurrent = [];\n      this.rulelistid = '';\n      this.scheduleList = [];\n    }\n  }\n};",null]}