{"remainingRequest":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js!F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\registWork\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\registWork\\index.vue","mtime":1602343595393},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _regist = require(\"@/api/regist\");\n\nvar _department = require(\"@/api/department\");\n\nvar _patient = require(\"@/api/outpatient/patient\");\n\nvar _admin = require(\"@/api/admin\");\n\nvar _utils = require(\"@/utils\");\n\nvar _path = require(\"path\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar defaultpatient = {\n  id: \"\",\n  name: \"\",\n  male: \"\",\n  birth: \"\",\n  card: \"\",\n  fapiao: \"\",\n  type: \"\",\n  type2: \"\",\n  data1: \"\",\n  data2: \"\",\n  isdone: \"\",\n  isget: \"\",\n  status: \"\",\n  money: \"\",\n  kemu: \"\"\n};\nvar _default = {\n  data: function data() {\n    return {\n      isAble: false,\n      rules: {\n        needBook: [{\n          required: true,\n          message: '请选择病历本',\n          trigger: 'blur'\n        }],\n        settlementCatId: [{\n          required: true,\n          message: '请选择支付方式',\n          trigger: 'blur'\n        }],\n        skdId: [{\n          required: true,\n          message: '请输入看诊医生',\n          trigger: 'blur'\n        }],\n        time: [{\n          required: true,\n          message: '请输入预约时间',\n          trigger: 'blur'\n        }],\n        amount: [{\n          required: true,\n          message: '请输入应收金额',\n          trigger: 'blur'\n        }],\n        identificationNo: [{\n          required: true,\n          message: '请输入身份证号',\n          trigger: 'blur'\n        }, {\n          pattern: /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/,\n          message: '请输入正确的身份证号',\n          trigger: 'blur'\n        }],\n        name: [{\n          required: true,\n          message: '请输入姓名',\n          trigger: 'blur'\n        }],\n        dateOfBirth: [{\n          required: true,\n          message: '出生日期必填',\n          trigger: 'blur'\n        }],\n        gender: [{\n          required: true,\n          message: '请输入性别',\n          trigger: 'blur'\n        }],\n        homeAddress: [{\n          required: true,\n          message: '请输入家庭住址',\n          trigger: 'blur'\n        }],\n        phoneNo: [{\n          required: true,\n          message: '请输入联系方式',\n          trigger: 'blur'\n        }],\n        deptId: [{\n          required: true,\n          message: '请输入挂号科室',\n          trigger: 'blur'\n        }],\n        RegisterRnak: [{\n          required: true,\n          message: '请输入挂号级别',\n          trigger: 'blur'\n        }],\n        attendanceDate: [{\n          required: true,\n          message: '请输入挂号日期',\n          trigger: 'blur'\n        }],\n        noon: [{\n          required: true,\n          message: '请输入午别',\n          trigger: 'blur'\n        }]\n      },\n      re1: '',\n      re2: '',\n      xbarCode: '',\n      WXPayState: false,\n      WXPayState1: false,\n      suppregistVisible: false,\n      reprintregistVisible: false,\n      isbin: 0,\n      redinvoiceNo: '',\n      refundregistVisible: false,\n      refundregist: {},\n      refundVisible: false,\n      settlementCatId: '',\n      invoiceNo: '',\n      refs: [],\n      paymoney: 0,\n      totalamount: 0,\n      paylist: [],\n      doctList: [],\n      timeList: [],\n      //预约时间\n      regdisabled: true,\n      regdisabled2: true,\n      alldept: [],\n      dmsRegistrationParam: {\n        attendanceDate: '',\n        deptId: '',\n        noon: '',\n        amount: '',\n        skdId: '',\n        needBook: '',\n        name: '',\n        dateOfBirth: '',\n        age: '',\n        homeAddress: '',\n        gender: '',\n        phoneNo: '',\n        identificationNo: '',\n        barCode: '',\n        time: '',\n        summery: '',\n        //总金额\n        blance: '',\n        //可用金额\n        frozen: '',\n        //冻结金额\n        topUp: '',\n        //充值金额\n        refund: '' //退费金额\n\n      },\n      RegisterList: [],\n      RegisterRnak: [],\n      itemtype: ['检查检验', '处方', '处置'],\n      payT: '',\n      paytype: [{\n        value: '1',\n        label: '现金'\n      }, {\n        value: '2',\n        label: '银行卡'\n      }, {\n        value: '3',\n        label: '医保'\n      }, {\n        value: '4',\n        label: '信用卡'\n      }, {\n        value: '5',\n        label: '支付宝'\n      }, {\n        value: '6',\n        label: '微信'\n      }, {\n        value: '7',\n        label: '其他'\n      }],\n      onepatient: Object.assign({}, defaultpatient),\n      radio: 1,\n      dialogFormVisible: false,\n      isshow: false,\n      list: [],\n      refundRegisterId: '',\n      queryRegister: {\n        medicalRecordNo: null,\n        queryDate: null,\n        pageSize: 1000,\n        pageNum: 1\n      },\n      total: 0\n    };\n  },\n  created: function created() {\n    this.listRegisteredPatient();\n    this.getAllDep();\n    this.getAllReg();\n  },\n  methods: {\n    doChange: function doChange() {\n      this.dmsRegistrationParam.dateOfBirth = this.dmsRegistrationParam.identificationNo.substring(6, 10) + '-' + this.dmsRegistrationParam.identificationNo.substring(10, 12) + '-' + this.dmsRegistrationParam.identificationNo.substring(12, 14);\n    },\n    supprint: function supprint(val) {\n      this.suppregistVisible = true;\n      this.re1 = val.registrationId;\n      this.re2 = '';\n    },\n    supprint2: function supprint2() {\n      var _this = this;\n\n      var data = {};\n      data.newInvoiceNo = this.re2;\n      data.registrationId = this.re1;\n      (0, _regist.supplementPrintInvoice)(data).then(function (res) {\n        _this.$notify({\n          title: '成功',\n          message: '补打发票成功',\n          type: 'success',\n          duration: 2000\n        });\n      });\n      this.suppregistVisible = false;\n    },\n    reprint2: function reprint2() {\n      var _this2 = this;\n\n      var data = {};\n      data.newInvoiceNo = this.re2;\n      data.oldInvoiceNo = this.re1;\n      (0, _regist.reprintInvoice)(data).then(function (res) {\n        _this2.$notify({\n          title: '成功',\n          message: '重打发票成功',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    },\n    reprint: function reprint() {\n      this.re1 = '';\n      this.re2 = '';\n      this.reprintregistVisible = true;\n    },\n    changeradio1: function changeradio1() {\n      if (this.isbin === 0) {\n        this.dmsRegistrationParam.amount += 1;\n        this.isbin = 1;\n      }\n    },\n    changeradio2: function changeradio2() {\n      if (this.isbin === 1) {\n        this.dmsRegistrationParam.amount -= 1;\n        this.isbin = 0;\n      }\n    },\n    refresh: function refresh() {\n      this.listRegisteredPatient();\n    },\n    selectPatientByIdNo: function selectPatientByIdNo() {\n      var _this3 = this;\n\n      this.isshow = true;\n      this.$prompt('身份证号', '读卡(获取用户身份证号)', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消'\n      }).then(function (_ref) {\n        var value = _ref.value;\n        (0, _patient.selectPatientByIdNo)(value).then(function (res) {\n          _this3.dmsRegistrationParam.name = res.data.name;\n          _this3.dmsRegistrationParam.dateOfBirth = res.data.dateOfBirth;\n          _this3.dmsRegistrationParam.age = res.data.age;\n          _this3.dmsRegistrationParam.homeAddress = res.data.homeAddress;\n          _this3.dmsRegistrationParam.gender = res.data.gender;\n          _this3.dmsRegistrationParam.phoneNo = res.data.phoneNo;\n          _this3.dmsRegistrationParam.identificationNo = value;\n          _this3.dmsRegistrationParam.summery = res.data.summery;\n          _this3.dmsRegistrationParam.blance = res.data.blance;\n          _this3.dmsRegistrationParam.frozen = res.data.frozen;\n          console.log(_this3.dmsRegistrationParam);\n\n          _this3.$message({\n            type: 'success',\n            message: '成功读取患者: ' + _this3.dmsRegistrationParam.name\n          });\n        });\n      });\n    },\n    comfirmtuihao: function comfirmtuihao() {\n      var _this4 = this;\n\n      var data = {};\n      data.oldInvoiceNo = this.invoiceNo;\n      data.redInvoiceNo = this.redinvoiceNo;\n      data.registrationId = this.refundRegisterId;\n      data.operatorId = this.$store.getters.id;\n      (0, _regist.refundRegistrationCharge)(data).then(function (res) {\n        _this4.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n\n        _this4.refundregistVisible = false;\n\n        _this4.listRegisteredPatient();\n      });\n    },\n    tuihao: function tuihao(row) {\n      this.refundregistVisible = true;\n      this.refundRegisterId = row.registrationId;\n    },\n    refundmoney: function refundmoney() {\n      var _this5 = this;\n\n      if (this.invoiceNo === '' || this.invoiceNo === undefined) {\n        this.$notify({\n          title: '警告',\n          message: '发票号不能为空！',\n          type: 'warning',\n          duration: 2000\n        });\n        return;\n      }\n\n      var flag = 1;\n      var inv = '';\n      this.refs.forEach(function (item) {\n        item.settlementCatId = 1;\n        item.chargeItemId = item.id;\n        if (inv === '') item.invoiceNo = item.invoiceIdfNo;else {\n          if (item.invoiceIdfNo === inv) {\n            item.invoiceNo = item.invoiceIdfNo;\n          } else flag = 0;\n        }\n\n        if (flag === 0) {\n          _this5.$notify({\n            title: '警告',\n            message: '不能同时退不同发票号的项目！',\n            type: 'warning',\n            duration: 2000\n          });\n\n          return;\n        }\n\n        item.newInvoiceNo = _this5.invoiceNo + 1;\n        item.redInvoiceNo = _this5.invoiceNo;\n        item.operatorId = _this5.$store.getters.id;\n        item.refundAmount = item.amount;\n      });\n      (0, _regist.refundCharge)(this.refs).then(function (res) {\n        _this5.$notify({\n          title: '成功',\n          message: '退费成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this5.refundVisible = false;\n\n        _this5.listRegisteredPatient();\n      });\n      this.refundregistVisible = false;\n      this.listRegisteredPatient();\n    },\n    charge: function charge() {\n      var _this6 = this;\n\n      if (this.invoiceNo === '' || this.invoiceNo === undefined || this.settlementCatId === '' || this.settlementCatId === undefined) {\n        this.$notify({\n          title: '信息不完整',\n          message: '请填写发票号或选择缴费类型！',\n          type: 'danger',\n          duration: 2000\n        });\n        return;\n      }\n\n      var data = this.refs;\n      data.forEach(function (item) {\n        item.chargeItemId = item.id;\n        item.invoiceNo = _this6.invoiceNo;\n        item.opratorId = _this6.$store.getters.id;\n        item.settlementCatId = _this6.settlementCatId;\n        item.xbarCode = _this6.xbarCode;\n      });\n      console.log(data);\n      console.log(data.xbarCode);\n      (0, _regist.charge)(data).then(function (res) {\n        _this6.$notify({\n          title: '成功',\n          message: '缴费成功',\n          type: 'success',\n          duration: 2000\n        });\n\n        _this6.dialogFormVisible = false;\n\n        _this6.listRegisteredPatient();\n      });\n    },\n    handlechange: function handlechange(val) {\n      var _this7 = this;\n\n      this.refs = val;\n      this.totalamount = 0;\n      this.refs.forEach(function (item) {\n        _this7.totalamount += item.amount;\n      });\n      this.totalamount = this.totalamount.toFixed(2);\n    },\n    refundRegistrationCharge: function refundRegistrationCharge(row) {\n      var _this8 = this;\n\n      this.onepatient = (0, _utils.deepClone)(row);\n      (0, _regist.listRefundByRegistrationId)(row.registrationId).then(function (res) {\n        _this8.paylist = res.data;\n\n        _this8.paylist.forEach(function (item) {\n          if (item.createTime !== null) {\n            item.createTime = (0, _utils.parseTime)(item.createTime);\n          }\n        });\n\n        _this8.refundVisible = true;\n      });\n    },\n    createRegistration: function createRegistration(formName) {\n      var _this9 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          if (_this9.dmsRegistrationParam.invoiceNo === '' || _this9.dmsRegistrationParam.invoiceNo === undefined) {\n            _this9.$notify({\n              title: '信息不完整',\n              message: '请输入发票号！',\n              type: 'warning',\n              duration: 2000\n            });\n\n            return;\n          }\n\n          if (_this9.dmsRegistrationParam.settlementCatId === '' || _this9.dmsRegistrationParam.settlementCatId === undefined) {\n            _this9.$notify({\n              title: '信息不完整',\n              message: '请选择支付方式！',\n              type: 'warning',\n              duration: 2000\n            });\n\n            return;\n          }\n\n          _this9.dmsRegistrationParam.attendanceDate = (0, _utils.parseTime)(_this9.dmsRegistrationParam.attendanceDate).substr(0, 10);\n          _this9.dmsRegistrationParam.dateOfBirth = (0, _utils.parseTime)(_this9.dmsRegistrationParam.dateOfBirth).substr(0, 10);\n          _this9.dmsRegistrationParam.opratorId = _this9.$store.getters.id;\n          console.log(_this9.dmsRegistrationParam);\n          (0, _regist.createRegistration)(_this9.dmsRegistrationParam).then(function (res) {\n            _this9.$notify({\n              title: '成功',\n              message: '挂号成功',\n              type: 'success',\n              duration: 2000\n            });\n\n            _this9.isshow = false;\n\n            _this9.listRegisteredPatient();\n\n            _this9.dmsRegistrationParam = {};\n          });\n        }\n      });\n    },\n    recharge: function recharge() {\n      var _this10 = this;\n\n      this.dmsRegistrationParam.opratorId = this.$store.getters.id;\n      console.log(this.dmsRegistrationParam);\n      debugger;\n      (0, _regist.recharge)(this.dmsRegistrationParam).then(function (res) {\n        debugger;\n\n        if (res.data === 1) {\n          _this10.$notify({\n            title: '成功',\n            message: '充值成功',\n            type: 'success',\n            duration: 2000\n          });\n        } else {\n          _this10.$notify({\n            title: '失败',\n            message: '充值失败',\n            type: 'warning',\n            duration: 2000\n          });\n        }\n\n        _this10.isshow = false;\n\n        _this10.listRegisteredPatient();\n\n        _this10.dmsRegistrationParam = {};\n      });\n    },\n    rollback: function rollback() {\n      var _this11 = this;\n\n      this.dmsRegistrationParam.opratorId = this.$store.getters.id;\n      console.log(this.dmsRegistrationParam);\n      (0, _regist.rollback)(this.dmsRegistrationParam).then(function (res) {\n        debugger;\n\n        if (res.data === 1) {\n          _this11.$notify({\n            title: '成功',\n            message: '退费成功',\n            type: 'success',\n            duration: 2000\n          });\n        } else {\n          _this11.$notify({\n            title: '失败',\n            message: '退费失败',\n            type: 'warning',\n            duration: 2000\n          });\n        }\n\n        _this11.isshow = false;\n\n        _this11.listRegisteredPatient();\n\n        _this11.dmsRegistrationParam = {};\n      });\n    },\n    choosenoon: function choosenoon(val) {\n      if (val !== '') this.listDocBySkd();\n    },\n    listDocBySkd: function listDocBySkd() {\n      var _this12 = this;\n\n      var data = {};\n      data.date = (0, _utils.parseTime)(this.dmsRegistrationParam.attendanceDate).substr(0, 10);\n      data.deptId = this.dmsRegistrationParam.deptId;\n      data.noon = this.dmsRegistrationParam.noon;\n      data.registrationRankId = this.dmsRegistrationParam.RegisterRnak;\n      (0, _regist.listDocBySkd)(data).then(function (res) {\n        _this12.doctList = res.data;\n        _this12.regdisabled2 = false;\n      });\n    },\n    listTime: function listTime() {\n      var _this13 = this;\n\n      var data = {};\n      data.skdId = this.dmsRegistrationParam.skdId;\n      var time = this.dmsRegistrationParam.attendanceDate;\n      var year = time.getFullYear();\n      var month = time.getMonth() + 1;\n      var date1 = time.getDate();\n\n      if (month < 10) {\n        month = \"0\" + month;\n      }\n\n      data.ruletime = year + \"-\" + month + '-' + date1;\n      data.noon = this.dmsRegistrationParam.noon;\n      (0, _regist.listTime)(data).then(function (res) {\n        _this13.timeList = res.data;\n      });\n    },\n    chooseRegister: function chooseRegister(val) {\n      var _this14 = this;\n\n      if (this.dmsRegistrationParam.RegisterRnak === 1 && this.dmsRegistrationParam.attendanceDate !== '' && this.dmsRegistrationParam.deptId !== '') {\n        this.regdisabled = false;\n        this.regdisabled2 = false;\n      } else {\n        this.regdisabled = true;\n        this.dmsRegistrationParam.noon = \"\";\n        this.dmsRegistrationParam.skdId = \"\";\n      }\n\n      this.RegisterRank.forEach(function (item) {\n        if (item.id === _this14.dmsRegistrationParam.RegisterRnak) {\n          _this14.dmsRegistrationParam.amount = item.price;\n          if (_this14.dmsRegistrationParam.needBook) _this14.dmsRegistrationParam.amount += 1;\n        }\n      });\n    },\n    getAllReg: function getAllReg() {\n      var _this15 = this;\n\n      (0, _admin.getAllReg)().then(function (res) {\n        _this15.RegisterRank = res.data;\n      });\n    },\n    getAllDep: function getAllDep() {\n      var _this16 = this;\n\n      (0, _department.getAllDep)().then(function (res) {\n        _this16.alldept = res.data;\n      });\n    },\n    listRegisteredPatient: function listRegisteredPatient() {\n      var _this17 = this;\n\n      (0, _regist.listRegisteredPatient)(this.queryRegister).then(function (res) {\n        _this17.RegisterList = res.data.list;\n\n        _this17.RegisterList.forEach(function (item) {\n          item.patientDateOfBirth = item.patientDateOfBirth.substr(0, 10);\n          item.attendanceDate = item.attendanceDate.substr(0, 10);\n        });\n\n        console.log(_this17.RegisterList);\n        _this17.total = res.data.total;\n      });\n    },\n    guahao: function guahao() {\n      this.isshow = !this.isshow;\n    },\n    handlepay: function handlepay(row) {\n      var _this18 = this;\n\n      this.onepatient = (0, _utils.deepClone)(row);\n      console.log(this.onepatient);\n      (0, _regist.listChargeByRegistrationId)(row.registrationId).then(function (res) {\n        _this18.paylist = res.data;\n\n        _this18.paylist.forEach(function (item) {\n          if (item.createTime !== null) {\n            item.createTime = (0, _utils.parseTime)(item.createTime);\n          }\n        });\n      });\n      this.dialogFormVisible = true;\n    },\n    WXpay: function WXpay() {\n      var _this19 = this;\n\n      if (this.dmsRegistrationParam.settlementCatId == 6) {\n        this.WXPayState = true;\n        this.$nextTick(function () {\n          return _this19.$refs.editTask.focus();\n        });\n      } else {\n        this.WXPayState = false;\n      }\n    },\n    WXpay1: function WXpay1() {\n      var _this20 = this;\n\n      if (this.settlementCatId == 6) {\n        this.WXPayState1 = true;\n        this.$nextTick(function () {\n          return _this20.$refs.editTask.focus();\n        });\n      } else {\n        this.WXPayState1 = false;\n      }\n    },\n    searchEnterFun: function searchEnterFun(e) {\n      var keyCode = window.event ? e.keyCode : e.which; //  console.log('回车搜索',keyCode,e);\n\n      if (keyCode == 13) {\n        this.isAble = true;\n      }\n    }\n  }\n};\nexports.default = _default;",null]}