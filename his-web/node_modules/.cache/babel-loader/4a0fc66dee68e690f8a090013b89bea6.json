{"remainingRequest":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js!F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\historyInspection.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\XM\\his-web\\src\\views\\outpatient\\workstation\\historyInspection.vue","mtime":1602056307734},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\babel-loader\\lib\\index.js","mtime":1600936408645},{"path":"F:\\XM\\his-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1600936410370},{"path":"F:\\XM\\his-web\\node_modules\\vue-loader\\lib\\index.js","mtime":1600936442292}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"F:/XM/his-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nrequire(\"regenerator-runtime/runtime\");\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"F:/XM/his-web/node_modules/@babel/runtime/helpers/asyncToGenerator\"));\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.string.iterator\");\n\nvar _non_drug = require(\"@/api/non_drug\");\n\nvar _nondrugapply = require(\"@/api/outpatient/nondrugapply\");\n\nvar _nondrugmodel = require(\"@/api/nondrugmodel\");\n\nvar _utils = require(\"@/utils\");\n\nvar _frequentuse = require(\"@/api/outpatient/frequentuse\");\n\nvar _save = require(\"@/api/outpatient/save\");\n\nvar _q = require(\"q\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  props: ['patient'],\n  name: 'Inspection',\n  data: function data() {\n    return {\n      resultvisible: false,\n      checkresult: '',\n      checkresultimg: [],\n      freqlist: [],\n      onemodel: {},\n      totalprice: 0.000,\n      ref: [],\n      checkmodels: [],\n      check: {},\n      demandVisible: false,\n      dialogTableVisible: false,\n      activeName: 'first',\n      isclose: true,\n      checkList: [],\n      mainwidth: \"65%\",\n      activeNames: ['1'],\n      total: 0,\n      search: '',\n      listQuery: {\n        code: null,\n        name: null,\n        format: null,\n        price: null,\n        expClassId: null,\n        deptId: null,\n        mnemonicCode: null,\n        recordType: 1,\n        createDate: null,\n        status: 1,\n        pageSize: 1000,\n        pageNum: 1\n      },\n      record: []\n    };\n  },\n  watch: {\n    'patient': function patient(newVal, oldVal) {\n      this.patient = newVal;\n      this.listRecord();\n    }\n  },\n  created: function created() {\n    var _this = this;\n\n    _q.Promise.all([this.getNondrugList().then(function () {\n      _this.getmodel();\n    })]);\n\n    this.getfreqList();\n  },\n  methods: {\n    saveNonDrug: function saveNonDrug() {\n      var _this2 = this;\n\n      var data = {};\n      data.dmsNonDrugItemRecordParamList = this.ref;\n      data.registrationId = this.patient.registrationId;\n      data.type = 0;\n      (0, _save.saveNonDrug)(data).then(function (res) {\n        _this2.$notify({\n          title: '成功',\n          message: '已暂存选中的检查项',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    },\n    getNonDrug: function getNonDrug() {\n      var _this3 = this;\n\n      var data = {};\n      data.registrationId = this.patient.registrationId;\n      data.type = 0;\n      (0, _save.getNonDrug)(data).then(function (res) {\n        res.data.dmsNonDrugItemRecordParamList.forEach(function (item) {\n          _this3.selectCheckred(item);\n        });\n\n        _this3.$notify({\n          title: '成功',\n          message: '已取出暂存的检查项',\n          type: 'success',\n          duration: 2000\n        });\n      });\n    },\n    showresult: function showresult(row) {\n      var _this4 = this;\n\n      this.checkresult = row.checkResult;\n      row.resultImgUrlList.split(',').forEach(function (item) {\n        _this4.checkresultimg.push(item);\n      });\n      this.resultvisible = true;\n    },\n    addfreitem: function addfreitem(val) {\n      this.selectCheck(val);\n    },\n    getfreqList: function getfreqList() {\n      var _this5 = this;\n\n      var data = {};\n      data.staffId = this.$store.getters.id;\n      data.selectType = 1;\n      (0, _frequentuse.selectByType)(data).then(function (res) {\n        _this5.freqlist = res.data.checkList;\n      });\n    },\n    addModel: function addModel(val) {\n      /* console.log(val)\r\n       this.$confirm('是否确定将 模板:'+val.name+' 中的内容导入该患者的检查中', '导入模板', {\r\n           confirmButtonText: '确认',\r\n           cancelButtonText: '取消',\r\n           type: 'warning'\r\n         }).then(()=>{\r\n           val.nondruglist.forEach(item=>{\r\n             item.status = -1\r\n             let flag = 1\r\n             this.record.forEach(com=>{\r\n               if(com.id===item.id){\r\n                 flag = 0\r\n               }\r\n             })\r\n             if(flag)\r\n               this.record.push(item)\r\n           })\r\n         })*/\n      this.model = (0, _utils.deepClone)(val);\n      this.model.amount = Math.floor((this.model.amount + 0.5) * 100) / 100;\n      this.modelvisivle = true;\n    },\n    selectModel: function selectModel(val) {\n      this.onemodel = val;\n    },\n    getmodel: function () {\n      var _getmodel = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _this6 = this;\n\n        var data;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {};\n                data.scope = 0;\n                data.ownId = this.$store.getters.id;\n                data.type = 0;\n                data.pageSize = 10000;\n                data.pageNum = 1;\n                data.isAdmin = 0;\n                _context.next = 9;\n                return (0, _nondrugmodel.getNondrugModelList)(data).then(function (res) {\n                  _this6.checkmodels = res.data.list;\n\n                  _this6.checkmodels.forEach(function (onemodel) {\n                    onemodel.nondruglist = [];\n                    onemodel.totalprice = 0.00;\n\n                    _this6.checkList.filter(function (item) {\n                      if (onemodel.nonDrugIdList.includes(item.id)) {\n                        onemodel.nondruglist.push(item);\n                        onemodel.totalprice += item.price;\n                      }\n                    });\n                  });\n                });\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getmodel() {\n        return _getmodel.apply(this, arguments);\n      }\n\n      return getmodel;\n    }(),\n    refresh: function refresh() {\n      var _this7 = this;\n\n      this.$confirm('未开立的项目都将清除,确认刷新?', '刷新', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this7.listRecord();\n      });\n    },\n    deleteTS: function deleteTS() {\n      var _this8 = this;\n\n      this.$confirm('所选项目都将清除,确认刷新?', '刷新', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _this8.listRecord();\n      });\n    },\n    invalid: function invalid() {\n      var _this9 = this;\n\n      var data = '';\n      this.ref.forEach(function (item) {\n        data += item.id + ',';\n      });\n      data = data.substr(0, data.length - 1);\n      (0, _nondrugapply.invalid)(data).then(function (res) {\n        _this9.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n\n        _this9.refresh();\n      });\n      console.log(data);\n    },\n    listRecord: function () {\n      var _listRecord = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _this10 = this;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                (0, _nondrugapply.list)(this.patient.registrationId, 0).then(function (res) {\n                  _this10.record = res.data;\n                  console.log(_this10.record);\n\n                  _this10.record.forEach(function (item) {\n                    _this10.checkList.filter(function (check) {\n                      if (check.id === item.noDrugId) {\n                        item.code = check.code;\n                        item.name = check.name;\n                        item.format = check.format;\n                        item.price = check.price;\n                      }\n                    });\n\n                    item.deptName = item.excuteDeptName;\n                  });\n                });\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function listRecord() {\n        return _listRecord.apply(this, arguments);\n      }\n\n      return listRecord;\n    }(),\n    handleSelectionChange: function handleSelectionChange(val) {\n      var _this11 = this;\n\n      this.ref = val;\n      this.totalprice = 0.00;\n      this.ref.forEach(function (item) {\n        _this11.totalprice += item.price;\n      });\n      this.totalprice = this.totalprice.toFixed(2);\n    },\n    handleClick: function handleClick() {\n      this.$notify({\n        title: '暂无数据',\n        message: '您开立的项目中包含已开立的项目，请检查后重新提交！',\n        type: 'warning',\n        duration: 2000\n      });\n      return false;\n    },\n    apply: function apply() {\n      var _this12 = this;\n\n      var flags = 0;\n      this.ref.forEach(function (item) {\n        if (item.status != -1) {\n          _this12.handleClick();\n\n          flags = 1;\n        }\n      });\n\n      if (flags === 0) {\n        var data = {};\n        data.dmsNonDrugItemRecordParamList = this.ref;\n        data.createStaffId = this.$store.getters.id;\n        data.registrationId = this.patient.registrationId;\n        data.dmsNonDrugItemRecordParamList.forEach(function (item) {\n          item.amount = item.price;\n          item.excuteDeptId = item.deptId;\n          item.noDrugId = item.id;\n        });\n        data.type = 0;\n        (0, _nondrugapply.apply)(data).then(function (res) {\n          _this12.$notify({\n            title: '成功',\n            message: res.message,\n            type: 'success',\n            duration: 2000\n          });\n\n          _this12.listRecord();\n        });\n      }\n    },\n    submitDemand: function submitDemand() {\n      var _this13 = this;\n\n      this.record.forEach(function (item) {\n        if (item.id === _this13.check.id) {\n          item.aim = _this13.check.aim;\n          item.demand = _this13.check.demand;\n          item.clinicalImpression = _this13.check.clinicalImpression;\n          item.clinicalDiagnosis = _this13.check.clinicalDiagnosis;\n          item.checkParts = _this13.check.checkParts;\n        }\n      });\n      this.demandVisible = false;\n    },\n    demand: function demand(row) {\n      this.demandVisible = true;\n      this.check = (0, _utils.deepClone)(row);\n    },\n    getNondrugList: function () {\n      var _getNondrugList2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var response;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return (0, _non_drug.getNondrugList)(this.listQuery);\n\n              case 2:\n                response = _context3.sent;\n                console.log(response);\n                this.checkList = response.data.list;\n                this.total = response.data.total;\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getNondrugList() {\n        return _getNondrugList2.apply(this, arguments);\n      }\n\n      return getNondrugList;\n    }(),\n    selectCheckred: function selectCheckred(val) {\n      console.log(val);\n      var flag = 1;\n      val.status = -1;\n      this.record.forEach(function (item) {\n        if (item.id === val.id) {\n          flag = 0;\n        }\n      });\n      if (flag) this.record.push(val);\n      this.dialogTableVisible = false;\n    },\n\n    /* selectCheck(val){\r\n       this.$confirm('是否添加 '+val.name+' 到该患者?', '添加检查', {\r\n           confirmButtonText: '确认',\r\n           cancelButtonText: '取消',\r\n           type: 'success'\r\n         }).then(()=>{\r\n         let flag = true\r\n         if(this.record==null){\r\n           this.record=[]\r\n         }\r\n         if(this.record.length==0){\r\n           this.record.push(val)\r\n         }else {\r\n           this.record.forEach(item=>{\r\n             if(item.icd===val.icd){\r\n               flag=false\r\n             }\r\n           })\r\n           if(flag) {\r\n             this.record.push(val)\r\n           }else {\r\n             alert('已存在该诊断！')\r\n           }\r\n         }\r\n         this.dialogTableVisible = false\r\n       })\r\n     },*/\n    selectCheck: function selectCheck(val) {\n      var _this14 = this;\n\n      console.log(val);\n      val.status = 0;\n      this.$confirm('是否添加 ' + val.name + ' 到该患者?', '添加检查', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'success'\n      }).then(function () {\n        var flag = 1;\n        val.status = -1;\n\n        _this14.record.forEach(function (item) {\n          if (item.id === val.id) {\n            flag = 0;\n          }\n        });\n\n        if (flag) _this14.record.push(val);else alert('已存在该检验项目！');\n        _this14.dialogTableVisible = false;\n      });\n    },\n    addcheck: function addcheck() {\n      this.dialogTableVisible = true;\n    },\n    delcheck: function delcheck() {\n      var _this15 = this;\n\n      var data = '';\n      this.ref.forEach(function (item) {\n        data += item.id + ',';\n      });\n      data = data.substr(0, data.length - 1);\n      (0, _nondrugapply.deleteById)(data).then(function (res) {\n        _this15.$notify({\n          title: '成功',\n          message: res.message,\n          type: 'success',\n          duration: 2000\n        });\n\n        _this15.deleteTS();\n      });\n      console.log(data);\n    },\n    controlfast: function controlfast() {\n      this.isclose = !this.isclose;\n      if (this.mainwidth === \"65%\") this.mainwidth = \"80%\";else this.mainwidth = \"65%\";\n    }\n  }\n};\nexports.default = _default;",null]}